<%- include('../header') %>
<%- include('../left-sidebar') %>

<div class="page">
  <div class="container-fluid">
    <div class="d-flex justify-content-between">
      <h1 class="commanHeading">Current Tasks</h1>
      <br />
    </div>
    <!-- Is this needed here? -->
    <form method="post" autocomplete="off" id="add_item_excel">
      <div
        class="modal fade"
        id="exampleModal"
        tabindex="-1"
        role="dialog"
        aria-labelledby="exampleModalLabel"
        aria-hidden="true"
      >
        <div class="modal-dialog" role="document">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title" id="exampleModalLabel">
                Select Excel File
              </h5>
              <button
                type="button"
                class="close"
                data-dismiss="modal"
                aria-label="Close"
              >
                <span aria-hidden="true">&times;</span>
              </button>
            </div>
            <div class="modal-body">
              <input type="file" id="input" name="input" />
            </div>

            <div class="px-2 pb-3 d-flex align-items-center">
              <div>
                <label class="switch">
                  <input type="checkbox" name="switch_on" />
                  <span class="slider"></span>
                </label>
              </div>
              <div>
                <h4 class="mb-0 mt-3">Override Existing</h4>
              </div>
            </div>

            <div class="modal-footer">
              <a href="/sample.xlsx" class="btn btn-primary">
                Sample Download
              </a>
              <button
                type="button"
                class="btn btn-secondary"
                data-dismiss="modal"
              >
                Close
              </button>
              <button type="submit" class="btn btn-primary addItemExcel">
                Update
              </button>
            </div>
          </div>
        </div>
      </div>
    </form>

    <div class="card">
      <div class="body table-responsive">
        <h5>Last <b>Regular (In-Progress)</b> Cron Status:</h5>
        <hr />
        <table
          id="example"
          class="table table-striped table-bordered"
          style="width: 100%"
        >
          <thead>
            <tr>
              <th>Sl No.</th>
              <th>Date Time</th>
              <th>Object Id</th>
              <th>Cron Group</th>
              <th>Eligible Products</th>
              <th>Products Completed</th>
              <th>Cron Status</th>
            </tr>
          </thead>
          <% if(cronStatus && cronStatus.length==0) { %>
          <h5 style="color: brown">No Pending Cron found.</h5>

          <% } else if(cronStatus.length>0){
          cronStatus.forEach(function(cron,idx){ %>
          <tbody>
            <td>
              <%= idx+1 %>
            </td>
            <td>
              <%= cron.cronTime %>
            </td>
            <td>
              <%= cron.keyGenId %>
            </td>
            <td>
              <%= cron.cronName %>
            </td>
            <td>
              <%= cron.maximumProductCount %>
            </td>
            <td>
              <%= cron.productsCount %>
            </td>
            <td>
              <% if(cron.status=="Complete" ){ %>
              <span style="color: green"><b> <%=cron.status %> </b></span>
              <% }else{%>
              <span style="color: orangered"><b> <%= cron.status %> </b></span>
              <%}%>
            </td>
          </tbody>
          <%});}%>
        </table>
      </div>
    </div>
  </div>
</div>

<%- include("../footer"); %>

<script src="/javascripts/dashboard.js"></script>
<script>
  // function refresh() {
  //     // make Ajax call here, inside the callback call:
  //     window.location.reload(true);
  //     setTimeout(refresh, 60000);
  //     // ...
  // }

  // // initial call, or just call refresh directly
  // setTimeout(refresh, 60000);
</script>
