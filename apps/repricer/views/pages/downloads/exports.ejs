<%- include('../header') %>
<%- include('../left-sidebar') %>

<body>
  <div class="page">
    <div class="container-fluid">
      <div class="d-flex justify-content-between">
        <% if (files.length > 0) { %> <% // Helper functions for date parsing
        and formatting function parseDate(dateString) { const [day, month, year,
        hour, minute, second] = dateString.split(/[-\s:]+/); const fullYear =
        `20${year}`; return new
        Date(`${fullYear}-${month}-${day}T${hour}:${minute}:${second}`); }
        function formatDate(dateString) { const date = parseDate(dateString);
        return isNaN(date.getTime()) ? "Invalid Date" : date.toLocaleString(); }
        // Sort files by 'updatedOn' date in descending order files.sort((a, b)
        => parseDate(b.updatedOn) - parseDate(a.updatedOn)); %>
        <table class="table table-striped table-bordered">
          <thead>
            <tr>
              <th scope="col">#</th>
              <th scope="col">File Name</th>
              <th scope="col">Requested By</th>
              <th scope="col">Requested On</th>
              <th scope="col">Last Modified On</th>
              <th scope="col">Status</th>
            </tr>
          </thead>
          <tbody>
            <% files.forEach((file, index) => { %>
            <tr>
              <th scope="row"><%= index + 1 %></th>
              <td>
                <a href="/history/download/<%= file.name %>"
                  ><%= file.name %></a
                >
              </td>
              <td>
                <%= file.updatedBy %>
              </td>
              <td><%= formatDate(file.createdOn) %></td>
              <td><%= formatDate(file.updatedOn) %></td>
              <td><%= file.status %></td>
            </tr>
            <% }) %>
          </tbody>
        </table>
        <% } else { %>
        <p>No exports found.</p>
        <% } %>
      </div>
    </div>
  </div>
</body>

<%- include("../footer"); %>
<script src="/javascripts/dashboard.js"></script>
