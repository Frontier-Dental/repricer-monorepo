<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>API-Core User Guide</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            line-height: 1.6;
            color: #333;
            background: #f5f5f5;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            box-shadow: 0 0 20px rgba(0,0,0,0.1);
        }

        header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 3rem 2rem;
            border-bottom: 4px solid #5568d3;
        }

        header h1 {
            font-size: 2.5rem;
            margin-bottom: 0.5rem;
        }

        header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }

        .meta-info {
            background: rgba(255,255,255,0.1);
            padding: 1rem;
            margin-top: 1.5rem;
            border-radius: 8px;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
        }

        .meta-info div {
            display: flex;
            flex-direction: column;
        }

        .meta-info strong {
            font-size: 0.85rem;
            opacity: 0.8;
            margin-bottom: 0.25rem;
        }

        .meta-info span {
            font-size: 1.1rem;
        }

        nav {
            background: #f8f9fa;
            padding: 1.5rem 2rem;
            border-bottom: 2px solid #e9ecef;
            position: sticky;
            top: 0;
            z-index: 100;
        }

        nav h2 {
            font-size: 0.9rem;
            color: #6c757d;
            margin-bottom: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        nav ul {
            list-style: none;
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
        }

        nav a {
            color: #667eea;
            text-decoration: none;
            padding: 0.5rem 1rem;
            background: white;
            border-radius: 6px;
            border: 1px solid #e9ecef;
            transition: all 0.2s;
            font-size: 0.9rem;
        }

        nav a:hover {
            background: #667eea;
            color: white;
            border-color: #667eea;
        }

        .content {
            padding: 2rem;
        }

        section {
            margin-bottom: 3rem;
            scroll-margin-top: 100px;
        }

        h2 {
            color: #667eea;
            font-size: 2rem;
            margin-bottom: 1.5rem;
            padding-bottom: 0.5rem;
            border-bottom: 3px solid #667eea;
        }

        h3 {
            color: #764ba2;
            font-size: 1.5rem;
            margin: 2rem 0 1rem 0;
        }

        h4 {
            color: #495057;
            font-size: 1.2rem;
            margin: 1.5rem 0 0.75rem 0;
        }

        p {
            margin-bottom: 1rem;
            color: #495057;
        }

        .card {
            background: #f8f9fa;
            padding: 1.5rem;
            border-radius: 8px;
            margin-bottom: 1.5rem;
            border-left: 4px solid #667eea;
        }

        .card h4 {
            margin-top: 0;
            color: #667eea;
        }

        ul, ol {
            margin-left: 2rem;
            margin-bottom: 1rem;
        }

        li {
            margin-bottom: 0.5rem;
            color: #495057;
        }

        code {
            background: #f1f3f5;
            padding: 0.2rem 0.4rem;
            border-radius: 3px;
            font-family: 'Consolas', 'Monaco', monospace;
            font-size: 0.9em;
            color: #e83e8c;
        }

        pre {
            background: #2d2d2d;
            color: #f8f8f2;
            padding: 1.5rem;
            border-radius: 8px;
            overflow-x: auto;
            margin-bottom: 1.5rem;
            border-left: 4px solid #667eea;
        }

        pre code {
            background: none;
            color: inherit;
            padding: 0;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 1.5rem;
            background: white;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }

        th {
            background: #667eea;
            color: white;
            padding: 1rem;
            text-align: left;
            font-weight: 600;
        }

        td {
            padding: 1rem;
            border-bottom: 1px solid #e9ecef;
        }

        tr:hover {
            background: #f8f9fa;
        }

        .badge {
            display: inline-block;
            padding: 0.25rem 0.6rem;
            border-radius: 4px;
            font-size: 0.8rem;
            font-weight: 600;
            margin-right: 0.5rem;
        }

        .badge-get { background: #28a745; color: white; }
        .badge-post { background: #007bff; color: white; }
        .badge-put { background: #ffc107; color: #212529; }
        .badge-delete { background: #dc3545; color: white; }
        .badge-required { background: #dc3545; color: white; }
        .badge-optional { background: #6c757d; color: white; }
        .badge-cron { background: #6f42c1; color: white; }

        .highlight-box {
            background: #fff3cd;
            border-left: 4px solid #ffc107;
            padding: 1rem;
            margin-bottom: 1.5rem;
            border-radius: 4px;
        }

        .info-box {
            background: #d1ecf1;
            border-left: 4px solid #17a2b8;
            padding: 1rem;
            margin-bottom: 1.5rem;
            border-radius: 4px;
        }

        .warning-box {
            background: #f8d7da;
            border-left: 4px solid #dc3545;
            padding: 1rem;
            margin-bottom: 1.5rem;
            border-radius: 4px;
        }

        .success-box {
            background: #d4edda;
            border-left: 4px solid #28a745;
            padding: 1rem;
            margin-bottom: 1.5rem;
            border-radius: 4px;
        }

        .grid-2 {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1.5rem;
            margin-bottom: 1.5rem;
        }

        .step {
            background: #f8f9fa;
            padding: 1.5rem;
            border-radius: 8px;
            margin-bottom: 1rem;
            border-left: 4px solid #667eea;
        }

        .step-number {
            display: inline-block;
            width: 30px;
            height: 30px;
            background: #667eea;
            color: white;
            border-radius: 50%;
            text-align: center;
            line-height: 30px;
            font-weight: bold;
            margin-right: 0.5rem;
        }

        footer {
            background: #2d3748;
            color: white;
            padding: 2rem;
            text-align: center;
            margin-top: 3rem;
        }

        footer p {
            color: #cbd5e0;
        }

        .architecture-diagram {
            background: white;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            padding: 2rem;
            margin: 2rem 0;
            text-align: center;
        }

        .flow-box {
            display: inline-block;
            background: #667eea;
            color: white;
            padding: 1rem 1.5rem;
            border-radius: 8px;
            margin: 0.5rem;
            font-weight: 600;
        }

        .flow-arrow {
            display: inline-block;
            font-size: 1.5rem;
            color: #667eea;
            margin: 0 0.5rem;
        }

        .endpoint-card {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 8px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
        }

        .endpoint-card h4 {
            margin-top: 0;
            color: #667eea;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .faq-item {
            margin-bottom: 2rem;
            padding-bottom: 2rem;
            border-bottom: 1px solid #e9ecef;
        }

        .faq-question {
            font-size: 1.2rem;
            font-weight: 600;
            color: #667eea;
            margin-bottom: 0.5rem;
        }

        .faq-answer {
            color: #495057;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>API-Core User Guide</h1>
            <p>Complete guide for using the Repricer API-Core application - REST API gateway for cron management and repricing operations</p>
            <div class="meta-info">
                <div>
                    <strong>Version</strong>
                    <span>1.0.2</span>
                </div>
                <div>
                    <strong>Last Updated</strong>
                    <span>2025-11-18</span>
                </div>
                <div>
                    <strong>Default Port</strong>
                    <span>5001</span>
                </div>
                <div>
                    <strong>Contact</strong>
                    <span>pranoyg52@gmail.com</span>
                </div>
            </div>
        </header>

        <nav>
            <h2>Quick Navigation</h2>
            <ul>
                <li><a href="#getting-started">Getting Started</a></li>
                <li><a href="#core-concepts">Core Concepts</a></li>
                <li><a href="#tutorials">Step-by-Step Tutorials</a></li>
                <li><a href="#configuration">Configuration Guide</a></li>
                <li><a href="#api-usage">API Usage Examples</a></li>
                <li><a href="#cron-management">Cron Job Management</a></li>
                <li><a href="#troubleshooting">Troubleshooting</a></li>
                <li><a href="#best-practices">Best Practices</a></li>
                <li><a href="#faq">FAQ</a></li>
            </ul>
        </nav>

        <div class="content">
            <!-- GETTING STARTED -->
            <section id="getting-started">
                <h2>Getting Started</h2>

                <h3>What is API-Core?</h3>
                <p>API-Core is the REST API gateway for the dental supply repricing system. It orchestrates automated repricing operations across 6 dental supply vendors by managing cron jobs, processing feeds, and coordinating price updates.</p>

                <div class="info-box">
                    <strong>Key Responsibilities:</strong>
                    <ul>
                        <li>Managing 30+ automated repricing cron jobs</li>
                        <li>Processing vendor feeds and product data</li>
                        <li>Handling error recovery with automatic retries (422 errors)</li>
                        <li>Coordinating proxy rotation for web scraping</li>
                        <li>Providing manual repricing endpoints</li>
                    </ul>
                </div>

                <h3>Prerequisites</h3>

                <div class="step">
                    <span class="step-number">1</span>
                    <strong>System Requirements</strong>
                    <ul>
                        <li>Node.js 16.x or higher</li>
                        <li>npm 8.x or higher</li>
                        <li>Access to MySQL database</li>
                        <li>Access to MongoDB database</li>
                        <li>Access to Redis cache server</li>
                    </ul>
                </div>

                <div class="step">
                    <span class="step-number">2</span>
                    <strong>Required Access</strong>
                    <ul>
                        <li>Database credentials (MySQL, MongoDB, Redis)</li>
                        <li>API keys for proxy services (ScrapingBee, ScrapFly, BrightData)</li>
                        <li>Network access to Net32.com API endpoints</li>
                        <li>Environment configuration file (.env)</li>
                    </ul>
                </div>

                <h3>Installation</h3>

                <div class="step">
                    <span class="step-number">1</span>
                    <strong>Clone the Repository</strong>
                    <pre><code>git clone &lt;repository-url&gt;
cd repricer-monorepo</code></pre>
                </div>

                <div class="step">
                    <span class="step-number">2</span>
                    <strong>Install Dependencies</strong>
                    <pre><code># From repository root
npm install

# Or navigate to api-core directory
cd apps/api-core
npm install</code></pre>
                </div>

                <div class="step">
                    <span class="step-number">3</span>
                    <strong>Configure Environment</strong>
                    <p>Create a <code>.env</code> file in <code>apps/api-core/</code> directory with required variables (see Configuration Guide section).</p>
                </div>

                <div class="step">
                    <span class="step-number">4</span>
                    <strong>Run Database Migrations</strong>
                    <pre><code>cd apps/db-migrations
npm run migrate:dev</code></pre>
                </div>

                <h3>First Run</h3>

                <div class="card">
                    <h4>Development Mode</h4>
                    <pre><code># From monorepo root
npx turbo run dev --filter=api-core

# Or from api-core directory
cd apps/api-core
npm run dev</code></pre>
                    <p>The server will start on port 5001 (default) with hot-reload enabled.</p>
                </div>

                <div class="card">
                    <h4>Production Mode</h4>
                    <pre><code># Build the application
npm run build

# Start the server
npm start</code></pre>
                </div>

                <div class="success-box">
                    <strong>✓ Verification:</strong> Visit <code>http://localhost:5001/health</code> to confirm the server is running. You should receive: <code>{"status": "ok"}</code>
                </div>
            </section>

            <!-- CORE CONCEPTS -->
            <section id="core-concepts">
                <h2>Core Concepts</h2>

                <h3>What is API-Core and Why Does it Exist?</h3>
                <p>API-Core serves as the central orchestration layer for the repricing system. It exists to separate concerns between:</p>

                <div class="grid-2">
                    <div class="card">
                        <h4>Business Logic (Repricer App)</h4>
                        <p>Contains the actual repricing algorithms, vendor integrations, and pricing rules.</p>
                    </div>
                    <div class="card">
                        <h4>Orchestration (API-Core)</h4>
                        <p>Manages scheduling, feed processing, and coordinates when and how repricing operations execute.</p>
                    </div>
                </div>

                <h3>System Architecture</h3>

                <div class="architecture-diagram">
                    <div class="flow-box">User/UI</div>
                    <div class="flow-arrow">→</div>
                    <div class="flow-box">API-Core<br/>(Port 5001)</div>
                    <div class="flow-arrow">→</div>
                    <div class="flow-box">Repricer App<br/>(Port 3000)</div>
                    <br/><br/>
                    <div class="flow-arrow">↓</div>
                    <br/>
                    <div class="flow-box">MySQL</div>
                    <div class="flow-box">MongoDB</div>
                    <div class="flow-box">Redis</div>
                    <br/><br/>
                    <div class="flow-arrow">↓</div>
                    <br/>
                    <div class="flow-box">Net32 Marketplace</div>
                </div>

                <h3>Database Strategy</h3>

                <table>
                    <thead>
                        <tr>
                            <th>Database</th>
                            <th>Purpose</th>
                            <th>Data Stored</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><strong>MySQL</strong></td>
                            <td>Structured data with relational integrity</td>
                            <td>Algorithm settings, vendor thresholds, user accounts, channel IDs</td>
                        </tr>
                        <tr>
                            <td><strong>MongoDB</strong></td>
                            <td>Flexible schema for evolving data</td>
                            <td>Cron logs, product details, execution history, error items</td>
                        </tr>
                        <tr>
                            <td><strong>Redis</strong></td>
                            <td>High-speed caching and sessions</td>
                            <td>Session data, temporary cache, rate limiting</td>
                        </tr>
                    </tbody>
                </table>

                <h3>Cron Job Types</h3>

                <div class="card">
                    <h4>1. Regular Crons</h4>
                    <p>Standard repricing schedules that run at defined intervals to update product prices based on competition.</p>
                    <p><strong>Typical Schedule:</strong> Every 2-4 hours</p>
                </div>

                <div class="card">
                    <h4>2. Slow Crons</h4>
                    <p>Longer-running batch operations for products that don't need frequent updates.</p>
                    <p><strong>Typical Schedule:</strong> Once or twice daily</p>
                </div>

                <div class="card">
                    <h4>3. Scrape Crons</h4>
                    <p>Data collection jobs that scrape Net32 marketplace and competitor information.</p>
                    <p><strong>Typical Schedule:</strong> Every 4-6 hours</p>
                </div>

                <div class="card">
                    <h4>4. Filter Crons</h4>
                    <p>Conditional repricing based on specific product filters (e.g., category, vendor, price range).</p>
                    <p><strong>Typical Schedule:</strong> Custom based on business rules</p>
                </div>

                <div class="card">
                    <h4>5. 422 Error Crons</h4>
                    <p>Automatic error recovery jobs that retry failed price updates due to HTTP 422 errors.</p>
                    <p><strong>Typical Schedule:</strong> Every 30-60 minutes</p>
                </div>

                <div class="card">
                    <h4>6. Proxy Switch Crons</h4>
                    <p>Manage rotation between different proxy providers (BrightData, ScrapFly, ScrapingBee) when failures occur.</p>
                    <p><strong>Typical Schedule:</strong> Event-driven (triggered by proxy failures)</p>
                </div>

                <h3>How API-Core Fits in the System</h3>

                <div class="info-box">
                    <p><strong>Request Flow Example:</strong></p>
                    <ol>
                        <li>User triggers a cron job via API-Core endpoint: <code>GET /schedule/StartCronV3</code></li>
                        <li>API-Core validates the request and checks cron configuration in MongoDB</li>
                        <li>API-Core makes HTTP requests to Repricer app with product lists</li>
                        <li>Repricer app executes pricing algorithms and returns results</li>
                        <li>API-Core logs results to MongoDB and updates MySQL tables</li>
                        <li>If errors occur, API-Core schedules retry via 422 cron</li>
                    </ol>
                </div>
            </section>

            <!-- TUTORIALS -->
            <section id="tutorials">
                <h2>Step-by-Step Tutorials</h2>

                <h3>Tutorial 1: Starting Your First Cron Job</h3>

                <div class="step">
                    <span class="step-number">1</span>
                    <strong>Verify Server is Running</strong>
                    <pre><code>curl http://localhost:5001/health</code></pre>
                    <p><strong>Expected Response:</strong> <code>{"status": "ok"}</code></p>
                </div>

                <div class="step">
                    <span class="step-number">2</span>
                    <strong>Start All Enabled Crons</strong>
                    <pre><code>curl http://localhost:5001/schedule/StartCronV3</code></pre>
                    <p>This endpoint starts all cron jobs that are marked as enabled in the database.</p>
                </div>

                <div class="step">
                    <span class="step-number">3</span>
                    <strong>Monitor Execution</strong>
                    <p>Check MongoDB collection <code>cronLogs</code> to see execution logs:</p>
                    <pre><code>// MongoDB Query
db.cronLogs.find().sort({_id: -1}).limit(10)</code></pre>
                </div>

                <div class="step">
                    <span class="step-number">4</span>
                    <strong>Stop Specific Cron</strong>
                    <pre><code>curl -X POST http://localhost:5001/schedule/StopCron \
  -H "Content-Type: application/json" \
  -d '{"key": "cron-name-here"}'</code></pre>
                </div>

                <h3>Tutorial 2: Manual Product Repricing</h3>

                <div class="step">
                    <span class="step-number">1</span>
                    <strong>Identify Product ID</strong>
                    <p>Get the Net32 marketplace product ID (mpId) you want to reprice. Example: <code>12345</code></p>
                </div>

                <div class="step">
                    <span class="step-number">2</span>
                    <strong>Trigger Manual Reprice</strong>
                    <pre><code>curl -X POST http://localhost:5001/search/RepriceProductToMax/12345 \
  -H "Content-Type: application/json" \
  -d '{
    "productName": "Dental Product Name",
    "unitPrice": 99.99,
    "channelName": "TRADENT"
  }'</code></pre>
                </div>

                <div class="step">
                    <span class="step-number">3</span>
                    <strong>Review Response</strong>
                    <p>The response will include:</p>
                    <ul>
                        <li><code>cronResponse</code>: Repricing decision and new price</li>
                        <li><code>priceUpdateResponse</code>: Result from Net32 price update</li>
                    </ul>
                </div>

                <h3>Tutorial 3: Setting Up Filter Crons</h3>

                <div class="step">
                    <span class="step-number">1</span>
                    <strong>Create Filter Configuration</strong>
                    <p>Add filter criteria to MongoDB collection <code>filterCronSettings</code>:</p>
                    <pre><code>{
  "key": "high-value-products",
  "enabled": true,
  "schedule": "0 */6 * * *",
  "filters": {
    "minPrice": 100,
    "maxPrice": 1000,
    "vendor": "TRADENT",
    "category": "Instruments"
  }
}</code></pre>
                </div>

                <div class="step">
                    <span class="step-number">2</span>
                    <strong>Recreate Filter Cron</strong>
                    <pre><code>curl -X POST http://localhost:5001/filter/RecreateFilterCron \
  -H "Content-Type: application/json" \
  -d '{"key": "high-value-products"}'</code></pre>
                </div>

                <div class="step">
                    <span class="step-number">3</span>
                    <strong>Start Filter Cron</strong>
                    <pre><code>curl http://localhost:5001/filter/StartFilterCron</code></pre>
                </div>

                <h3>Tutorial 4: Handling 422 Errors</h3>

                <div class="info-box">
                    <strong>What are 422 Errors?</strong>
                    <p>HTTP 422 (Unprocessable Entity) errors occur when Net32 API rejects a price update request, typically due to rate limiting or validation issues.</p>
                </div>

                <div class="step">
                    <span class="step-number">1</span>
                    <strong>Enable 422 Automatic Recovery</strong>
                    <p>Ensure environment variable is set:</p>
                    <pre><code>SCHEDULE_CRONS_ON_STARTUP=true</code></pre>
                    <p>This will automatically start the 422 error recovery cron on application startup.</p>
                </div>

                <div class="step">
                    <span class="step-number">2</span>
                    <strong>Monitor 422 Logs</strong>
                    <p>Check MongoDB collection <code>422cronLogs</code>:</p>
                    <pre><code>db["422cronLogs"].find().sort({_id: -1}).limit(20)</code></pre>
                </div>

                <div class="step">
                    <span class="step-number">3</span>
                    <strong>Manual 422 Recovery Trigger</strong>
                    <pre><code>curl http://localhost:5001/schedule/start422</code></pre>
                </div>

                <h3>Tutorial 5: Proxy Switching</h3>

                <div class="step">
                    <span class="step-number">1</span>
                    <strong>Understanding Proxy Providers</strong>
                    <p>The system uses three proxy providers with automatic failover:</p>
                    <ul>
                        <li><strong>BrightData:</strong> Primary proxy service</li>
                        <li><strong>ScrapFly:</strong> Secondary failover</li>
                        <li><strong>ScrapingBee:</strong> Tertiary fallback</li>
                    </ul>
                </div>

                <div class="step">
                    <span class="step-number">2</span>
                    <strong>Monitor Proxy Failures</strong>
                    <p>Check MongoDB collection <code>proxyFailureDetails</code>:</p>
                    <pre><code>db.proxyFailureDetails.find().sort({_id: -1}).limit(10)</code></pre>
                </div>

                <div class="step">
                    <span class="step-number">3</span>
                    <strong>Configure Thresholds</strong>
                    <p>Set environment variables to control when proxy switching occurs:</p>
                    <pre><code>PROXYSWITCH_COUNTER_MAXLIMIT=200  # Switch after 200 failures
PROXYSWITCH_TIMER=3600000         # Reset counter every hour</code></pre>
                </div>
            </section>

            <!-- CONFIGURATION GUIDE -->
            <section id="configuration">
                <h2>Configuration Guide</h2>

                <h3>Environment Variables Overview</h3>

                <div class="warning-box">
                    <strong>⚠ Important:</strong> Never commit <code>.env</code> files to version control. Keep all credentials and API keys secure.
                </div>

                <h3>Required Variables</h3>

                <table>
                    <thead>
                        <tr>
                            <th>Variable</th>
                            <th>Description</th>
                            <th>Example</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><code>MANAGED_MONGO_URL</code><br/><span class="badge badge-required">REQUIRED</span></td>
                            <td>MongoDB connection string</td>
                            <td><code>mongodb://user:pass@host:27017</code></td>
                        </tr>
                        <tr>
                            <td><code>SQL_HOSTNAME</code><br/><span class="badge badge-required">REQUIRED</span></td>
                            <td>MySQL database host</td>
                            <td><code>localhost</code></td>
                        </tr>
                        <tr>
                            <td><code>SQL_USERNAME</code><br/><span class="badge badge-required">REQUIRED</span></td>
                            <td>MySQL username</td>
                            <td><code>root</code></td>
                        </tr>
                        <tr>
                            <td><code>SQL_PASSWORD</code><br/><span class="badge badge-required">REQUIRED</span></td>
                            <td>MySQL password</td>
                            <td><code>your_password</code></td>
                        </tr>
                        <tr>
                            <td><code>SQL_DATABASE</code><br/><span class="badge badge-required">REQUIRED</span></td>
                            <td>MySQL database name</td>
                            <td><code>repricer_db</code></td>
                        </tr>
                        <tr>
                            <td><code>CACHE_HOST_URL</code><br/><span class="badge badge-required">REQUIRED</span></td>
                            <td>Redis cache server URL</td>
                            <td><code>redis://localhost</code></td>
                        </tr>
                        <tr>
                            <td><code>CACHE_PORT</code><br/><span class="badge badge-required">REQUIRED</span></td>
                            <td>Redis port number</td>
                            <td><code>6379</code></td>
                        </tr>
                    </tbody>
                </table>

                <h3>Application Configuration</h3>

                <table>
                    <thead>
                        <tr>
                            <th>Variable</th>
                            <th>Description</th>
                            <th>Default</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><code>PORT</code></td>
                            <td>API server port</td>
                            <td><code>5001</code></td>
                        </tr>
                        <tr>
                            <td><code>SCHEDULE_CRONS_ON_STARTUP</code></td>
                            <td>Auto-start crons when server starts</td>
                            <td><code>false</code></td>
                        </tr>
                        <tr>
                            <td><code>IS_DEV</code></td>
                            <td>Development mode (toggles Net32 endpoints)</td>
                            <td><code>false</code></td>
                        </tr>
                        <tr>
                            <td><code>REQUEST_LOGGING</code></td>
                            <td>Enable HTTP request logging</td>
                            <td><code>false</code></td>
                        </tr>
                        <tr>
                            <td><code>IS_DEBUG</code></td>
                            <td>Enable debug mode</td>
                            <td><code>false</code></td>
                        </tr>
                    </tbody>
                </table>

                <h3>Cron Schedule Variables</h3>

                <table>
                    <thead>
                        <tr>
                            <th>Variable</th>
                            <th>Description</th>
                            <th>Default (Cron Expression)</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><code>FEED_CRON_EXP</code></td>
                            <td>Feed processing schedule</td>
                            <td><code>15 */4 * * *</code> (Every 4 hours at 15 min)</td>
                        </tr>
                        <tr>
                            <td><code>PRODUCT_CRON_EXP</code></td>
                            <td>Product update schedule</td>
                            <td><code>0 */4 * * *</code> (Every 4 hours)</td>
                        </tr>
                        <tr>
                            <td><code>MANAGED_CRON_EXP</code></td>
                            <td>Managed service schedule</td>
                            <td><code>0 */2 * * *</code> (Every 2 hours)</td>
                        </tr>
                    </tbody>
                </table>

                <h3>Proxy Configuration</h3>

                <table>
                    <thead>
                        <tr>
                            <th>Variable</th>
                            <th>Description</th>
                            <th>Default</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><code>PROXYSWITCH_COUNTER_MAXLIMIT</code></td>
                            <td>Max failures before switching proxy</td>
                            <td><code>200</code></td>
                        </tr>
                        <tr>
                            <td><code>PROXYSWITCH_TIMER</code></td>
                            <td>Timer to reset failure counter (ms)</td>
                            <td><code>3600000</code> (1 hour)</td>
                        </tr>
                        <tr>
                            <td><code>SCRAPINGBEE_TIMEOUT_VALUE</code></td>
                            <td>ScrapingBee request timeout</td>
                            <td><code>15000</code> (15 seconds)</td>
                        </tr>
                        <tr>
                            <td><code>SCRAPFLY_TIMEOUT_VALUE</code></td>
                            <td>ScrapFly request timeout</td>
                            <td><code>15000</code> (15 seconds)</td>
                        </tr>
                    </tbody>
                </table>

                <h3>Complete .env Template</h3>

                <pre><code># Database Configuration
MANAGED_MONGO_URL=mongodb://username:password@host:27017/database
MANAGED_MONGO_PASSWORD=your_mongo_password
SQL_HOSTNAME=localhost
SQL_PORT=3306
SQL_USERNAME=root
SQL_PASSWORD=your_mysql_password
SQL_DATABASE=repricer_db

# Redis Cache
CACHE_HOST_URL=redis://localhost
CACHE_USERNAME=default
CACHE_PASSWORD=your_redis_password
CACHE_PORT=6379

# Application Settings
PORT=5001
IS_DEV=false
IS_DEBUG=false
REQUEST_LOGGING=false
SCHEDULE_CRONS_ON_STARTUP=false

# Cron Configuration
FEED_CRON_EXP=15 */4 * * *
PRODUCT_CRON_EXP=0 */4 * * *
MANAGED_CRON_EXP=0 */2 * * *

# Proxy Settings
PROXYSWITCH_COUNTER_MAXLIMIT=200
PROXYSWITCH_TIMER=3600000
SCRAPINGBEE_TIMEOUT_VALUE=15000
SCRAPFLY_TIMEOUT_VALUE=15000

# API Keys (required for proxy services)
SHIPPING_DATA_PROXY_SCRAPE_API_KEY=your_scrapfly_key

# Encryption
REPRICER_ENCRYPTION_KEY=your_encryption_key_here

# Feature Flags
ENABLE_SLOW_CRON_FEATURE=true
WRITE_HISTORY_SQL=true
IGNORE_CACHE=true
RUN_SHIPPING_THRESHOLD_SCRAPE_ON_STARTUP=false</code></pre>

                <h3>Environment-Specific Settings</h3>

                <div class="grid-2">
                    <div class="card">
                        <h4>Development</h4>
                        <pre><code>IS_DEV=true
IS_DEBUG=true
REQUEST_LOGGING=true
SCHEDULE_CRONS_ON_STARTUP=false</code></pre>
                    </div>
                    <div class="card">
                        <h4>Production</h4>
                        <pre><code>IS_DEV=false
IS_DEBUG=false
REQUEST_LOGGING=false
SCHEDULE_CRONS_ON_STARTUP=true</code></pre>
                    </div>
                </div>
            </section>

            <!-- API USAGE EXAMPLES -->
            <section id="api-usage">
                <h2>API Usage Examples</h2>

                <h3>Health Check</h3>
                <div class="endpoint-card">
                    <h4><span class="badge badge-get">GET</span> /health</h4>
                    <p>Verify the API server is running and responsive.</p>

                    <strong>Request:</strong>
                    <pre><code>curl http://localhost:5001/health</code></pre>

                    <strong>Response:</strong>
                    <pre><code>{
  "status": "ok"
}</code></pre>
                </div>

                <h3>Cron Management APIs</h3>

                <div class="endpoint-card">
                    <h4><span class="badge badge-get">GET</span> /schedule/StartCronV3</h4>
                    <p>Start all enabled regular cron jobs.</p>

                    <strong>Request:</strong>
                    <pre><code>curl http://localhost:5001/schedule/StartCronV3</code></pre>

                    <strong>Response:</strong>
                    <pre><code>{
  "message": "All enabled crons started successfully",
  "count": 15
}</code></pre>
                </div>

                <div class="endpoint-card">
                    <h4><span class="badge badge-post">POST</span> /schedule/StartCron</h4>
                    <p>Start a specific cron job by key.</p>

                    <strong>Request:</strong>
                    <pre><code>curl -X POST http://localhost:5001/schedule/StartCron \
  -H "Content-Type: application/json" \
  -d '{
    "key": "tradent-main-cron"
  }'</code></pre>

                    <strong>Response:</strong>
                    <pre><code>{
  "success": true,
  "message": "Cron 'tradent-main-cron' started",
  "nextRun": "2025-11-18T14:00:00.000Z"
}</code></pre>
                </div>

                <div class="endpoint-card">
                    <h4><span class="badge badge-post">POST</span> /schedule/StopCron</h4>
                    <p>Stop a running cron job.</p>

                    <strong>Request:</strong>
                    <pre><code>curl -X POST http://localhost:5001/schedule/StopCron \
  -H "Content-Type: application/json" \
  -d '{
    "key": "tradent-main-cron"
  }'</code></pre>

                    <strong>Response:</strong>
                    <pre><code>{
  "success": true,
  "message": "Cron 'tradent-main-cron' stopped"
}</code></pre>
                </div>

                <div class="endpoint-card">
                    <h4><span class="badge badge-get">GET</span> /schedule/StopAll</h4>
                    <p>Stop all running cron jobs.</p>

                    <strong>Request:</strong>
                    <pre><code>curl http://localhost:5001/schedule/StopAll</code></pre>

                    <strong>Response:</strong>
                    <pre><code>{
  "message": "All crons stopped",
  "count": 15
}</code></pre>
                </div>

                <h3>Filter Cron APIs</h3>

                <div class="endpoint-card">
                    <h4><span class="badge badge-get">GET</span> /filter/StartFilterCron</h4>
                    <p>Start all enabled filter crons.</p>

                    <strong>Request:</strong>
                    <pre><code>curl http://localhost:5001/filter/StartFilterCron</code></pre>
                </div>

                <div class="endpoint-card">
                    <h4><span class="badge badge-post">POST</span> /filter/toggleCronStatus</h4>
                    <p>Enable or disable a filter cron.</p>

                    <strong>Request:</strong>
                    <pre><code>curl -X POST http://localhost:5001/filter/toggleCronStatus \
  -H "Content-Type: application/json" \
  -d '{
    "key": "high-value-products",
    "enabled": true
  }'</code></pre>
                </div>

                <div class="endpoint-card">
                    <h4><span class="badge badge-post">POST</span> /filter/RecreateFilterCron</h4>
                    <p>Recreate a filter cron with new configuration.</p>

                    <strong>Request:</strong>
                    <pre><code>curl -X POST http://localhost:5001/filter/RecreateFilterCron \
  -H "Content-Type: application/json" \
  -d '{
    "key": "high-value-products"
  }'</code></pre>
                </div>

                <h3>Slow Cron APIs</h3>

                <div class="endpoint-card">
                    <h4><span class="badge badge-get">GET</span> /slow_cron/start_cron</h4>
                    <p>Start all enabled slow cron jobs.</p>

                    <strong>Request:</strong>
                    <pre><code>curl http://localhost:5001/slow_cron/start_cron</code></pre>
                </div>

                <div class="endpoint-card">
                    <h4><span class="badge badge-get">GET</span> /slow_cron/start_specific_cron/:key</h4>
                    <p>Start a specific slow cron by key.</p>

                    <strong>Request:</strong>
                    <pre><code>curl http://localhost:5001/slow_cron/start_specific_cron/nightly-batch</code></pre>
                </div>

                <h3>Scrape Cron APIs</h3>

                <div class="endpoint-card">
                    <h4><span class="badge badge-get">GET</span> /scrape/GetScrapeCron</h4>
                    <p>Get all scrape cron configurations.</p>

                    <strong>Request:</strong>
                    <pre><code>curl http://localhost:5001/scrape/GetScrapeCron</code></pre>
                </div>

                <div class="endpoint-card">
                    <h4><span class="badge badge-get">GET</span> /scrape/run_soc/:cronName</h4>
                    <p>Manually trigger a scrape cron execution.</p>

                    <strong>Request:</strong>
                    <pre><code>curl http://localhost:5001/scrape/run_soc/competitor-scrape</code></pre>
                </div>

                <h3>Manual Repricing APIs</h3>

                <div class="endpoint-card">
                    <h4><span class="badge badge-post">POST</span> /search/RepriceProductToMax/:id</h4>
                    <p>Reprice a specific product to maximum competitive price.</p>

                    <strong>Request:</strong>
                    <pre><code>curl -X POST http://localhost:5001/search/RepriceProductToMax/12345 \
  -H "Content-Type: application/json" \
  -d '{
    "productName": "Dental Mirror #5",
    "unitPrice": 45.99,
    "channelName": "TRADENT",
    "floorPrice": 30.00,
    "activated": true,
    "allowReprice": true,
    "competeAll": false
  }'</code></pre>

                    <strong>Response:</strong>
                    <pre><code>{
  "cronResponse": {
    "mpId": "12345",
    "productName": "Dental Mirror #5",
    "repriceDetails": {
      "oldPrice": 45.99,
      "newPrice": 42.50,
      "isRepriced": true,
      "explained": "Repriced to compete with lowest badge 0 seller"
    },
    "inStock": true
  },
  "priceUpdateResponse": {
    "success": true,
    "message": "Price updated successfully"
  }
}</code></pre>
                </div>

                <div class="endpoint-card">
                    <h4><span class="badge badge-post">POST</span> /feed/RepriceProduct/:id</h4>
                    <p>Reprice a product based on feed data.</p>

                    <strong>Request:</strong>
                    <pre><code>curl -X POST http://localhost:5001/feed/RepriceProduct/12345 \
  -H "Content-Type: application/json" \
  -d '{
    "productName": "Dental Product",
    "unitPrice": 99.99,
    "channelName": "TRADENT",
    "activated": true,
    "allowReprice": true,
    "secretKey": "your-vendor-secret-key"
  }'</code></pre>
                </div>

                <h3>Product Data APIs</h3>

                <div class="endpoint-card">
                    <h4><span class="badge badge-post">POST</span> /product/updateManualProd/:id</h4>
                    <p>Manually update a product configuration.</p>

                    <strong>Request:</strong>
                    <pre><code>curl -X POST http://localhost:5001/product/updateManualProd/12345 \
  -H "Content-Type: application/json" \
  -d '{
    "floorPrice": 35.00,
    "activated": true,
    "allowReprice": true
  }'</code></pre>
                </div>

                <h3>Error Handling</h3>

                <div class="info-box">
                    <strong>Common HTTP Status Codes:</strong>
                    <ul>
                        <li><code>200 OK</code> - Request successful</li>
                        <li><code>400 Bad Request</code> - Invalid request parameters</li>
                        <li><code>404 Not Found</code> - Endpoint or resource not found</li>
                        <li><code>418 I'm a Teapot</code> - Invalid product or business logic rejection</li>
                        <li><code>422 Unprocessable Entity</code> - Net32 API rejected the request</li>
                        <li><code>500 Internal Server Error</code> - Server-side error</li>
                    </ul>
                </div>

                <div class="endpoint-card">
                    <h4>Error Response Format</h4>
                    <pre><code>{
  "error": true,
  "message": "Descriptive error message",
  "code": "ERROR_CODE",
  "details": {
    "field": "Additional context"
  }
}</code></pre>
                </div>
            </section>

            <!-- CRON MANAGEMENT -->
            <section id="cron-management">
                <h2>Cron Job Management</h2>

                <h3>Understanding Cron Status</h3>

                <table>
                    <thead>
                        <tr>
                            <th>Status</th>
                            <th>Description</th>
                            <th>Action</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><strong>Enabled</strong></td>
                            <td>Cron is configured and ready to run</td>
                            <td>Can be started with StartCron endpoint</td>
                        </tr>
                        <tr>
                            <td><strong>Running</strong></td>
                            <td>Cron is actively executing on schedule</td>
                            <td>Will execute at next scheduled time</td>
                        </tr>
                        <tr>
                            <td><strong>Stopped</strong></td>
                            <td>Cron was running but has been stopped</td>
                            <td>Restart with StartCron endpoint</td>
                        </tr>
                        <tr>
                            <td><strong>Disabled</strong></td>
                            <td>Cron is turned off in configuration</td>
                            <td>Enable via toggleCronStatus endpoint</td>
                        </tr>
                    </tbody>
                </table>

                <h3>How to Enable/Disable Crons</h3>

                <div class="step">
                    <span class="step-number">1</span>
                    <strong>Toggle Regular Cron Status</strong>
                    <p>Regular crons don't have a dedicated toggle endpoint. Enable/disable in MongoDB:</p>
                    <pre><code>// MongoDB Query
db.cronSettings.updateOne(
  { key: "tradent-main-cron" },
  { $set: { enabled: true } }
)</code></pre>
                </div>

                <div class="step">
                    <span class="step-number">2</span>
                    <strong>Toggle Filter Cron</strong>
                    <pre><code>curl -X POST http://localhost:5001/filter/toggleCronStatus \
  -H "Content-Type: application/json" \
  -d '{
    "key": "high-value-products",
    "enabled": false
  }'</code></pre>
                </div>

                <div class="step">
                    <span class="step-number">3</span>
                    <strong>Toggle Slow Cron</strong>
                    <pre><code>curl -X POST http://localhost:5001/slow_cron/ToggleCronStatus \
  -H "Content-Type: application/json" \
  -d '{
    "key": "nightly-batch",
    "enabled": true
  }'</code></pre>
                </div>

                <h3>Monitoring Cron Execution</h3>

                <div class="card">
                    <h4>MongoDB Collections for Monitoring</h4>
                    <ul>
                        <li><code>cronLogs</code> - Regular cron execution logs</li>
                        <li><code>cronStatusLogs</code> - Cron status change history</li>
                        <li><code>filterCronLogs</code> - Filter cron execution logs</li>
                        <li><code>scrapeCronLogs</code> - Scrape cron execution logs</li>
                        <li><code>422cronLogs</code> - 422 error recovery logs</li>
                    </ul>
                </div>

                <div class="step">
                    <span class="step-number">1</span>
                    <strong>Check Recent Cron Executions</strong>
                    <pre><code>// MongoDB Query - Last 20 executions
db.cronLogs.find().sort({_id: -1}).limit(20)</code></pre>
                </div>

                <div class="step">
                    <span class="step-number">2</span>
                    <strong>Check Specific Cron History</strong>
                    <pre><code>// MongoDB Query - Filter by cron key
db.cronLogs.find({
  cronKey: "tradent-main-cron"
}).sort({_id: -1}).limit(10)</code></pre>
                </div>

                <div class="step">
                    <span class="step-number">3</span>
                    <strong>Check for Errors</strong>
                    <pre><code>// MongoDB Query - Find failed executions
db.cronLogs.find({
  status: "error"
}).sort({_id: -1}).limit(20)</code></pre>
                </div>

                <h3>Cron Schedule Format (Cron Expression)</h3>

                <div class="info-box">
                    <strong>Cron Expression Format:</strong>
                    <pre><code>* * * * *
│ │ │ │ │
│ │ │ │ └─── Day of week (0-7, 0 and 7 are Sunday)
│ │ │ └───── Month (1-12)
│ │ └─────── Day of month (1-31)
│ └───────── Hour (0-23)
└─────────── Minute (0-59)</code></pre>
                </div>

                <table>
                    <thead>
                        <tr>
                            <th>Expression</th>
                            <th>Description</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><code>0 */4 * * *</code></td>
                            <td>Every 4 hours at minute 0</td>
                        </tr>
                        <tr>
                            <td><code>15 */4 * * *</code></td>
                            <td>Every 4 hours at minute 15</td>
                        </tr>
                        <tr>
                            <td><code>0 */2 * * *</code></td>
                            <td>Every 2 hours</td>
                        </tr>
                        <tr>
                            <td><code>0 8 * * *</code></td>
                            <td>Daily at 8:00 AM</td>
                        </tr>
                        <tr>
                            <td><code>0 0 * * 0</code></td>
                            <td>Weekly on Sunday at midnight</td>
                        </tr>
                        <tr>
                            <td><code>*/30 * * * *</code></td>
                            <td>Every 30 minutes</td>
                        </tr>
                    </tbody>
                </table>

                <h3>Best Practices for Cron Scheduling</h3>

                <div class="card">
                    <h4>1. Avoid Overlap</h4>
                    <p>Ensure crons don't run at the exact same time to prevent resource contention:</p>
                    <ul>
                        <li>Feed Cron: <code>15 */4 * * *</code> (runs at :15)</li>
                        <li>Product Cron: <code>0 */4 * * *</code> (runs at :00)</li>
                        <li>Managed Cron: <code>30 */2 * * *</code> (runs at :30)</li>
                    </ul>
                </div>

                <div class="card">
                    <h4>2. Monitor Resource Usage</h4>
                    <p>High-frequency crons can overwhelm the system. Monitor:</p>
                    <ul>
                        <li>Database connection pool usage</li>
                        <li>Memory consumption during execution</li>
                        <li>API rate limits for Net32 and proxy services</li>
                    </ul>
                </div>

                <div class="card">
                    <h4>3. Test Before Production</h4>
                    <p>Always test new cron schedules in development:</p>
                    <pre><code># Set IS_DEV=true in .env
# Test manually first:
curl http://localhost:5001/schedule/start_specific_cron/test-cron

# Monitor logs for 24 hours before enabling in production</code></pre>
                </div>
            </section>

            <!-- TROUBLESHOOTING -->
            <section id="troubleshooting">
                <h2>Troubleshooting</h2>

                <h3>Common Issues and Solutions</h3>

                <div class="faq-item">
                    <div class="faq-question">❌ Server won't start - "Invalid or missing environment variables"</div>
                    <div class="faq-answer">
                        <p><strong>Cause:</strong> Required environment variables are missing or invalid in your <code>.env</code> file.</p>
                        <p><strong>Solution:</strong></p>
                        <ol>
                            <li>Check the error message for which specific variables are missing</li>
                            <li>Compare your <code>.env</code> file with the template in Configuration Guide</li>
                            <li>Ensure all <span class="badge badge-required">REQUIRED</span> variables are set</li>
                            <li>Verify connection strings are correctly formatted</li>
                        </ol>
                        <pre><code># Example error:
# Error: "SQL_HOSTNAME" is required
# Solution: Add to .env
SQL_HOSTNAME=localhost</code></pre>
                    </div>
                </div>

                <div class="faq-item">
                    <div class="faq-question">❌ Crons start but don't execute</div>
                    <div class="faq-answer">
                        <p><strong>Possible Causes:</strong></p>
                        <ul>
                            <li>Cron is disabled in MongoDB configuration</li>
                            <li>Schedule expression is invalid</li>
                            <li>Product list is empty for the cron</li>
                            <li>Database connection issues</li>
                        </ul>
                        <p><strong>Solution:</strong></p>
                        <pre><code># Check cron configuration
db.cronSettings.find({ key: "problematic-cron" })

# Verify enabled status
# If enabled: false, update:
db.cronSettings.updateOne(
  { key: "problematic-cron" },
  { $set: { enabled: true } }
)

# Check cron logs for errors
db.cronLogs.find({
  cronKey: "problematic-cron"
}).sort({_id: -1}).limit(5)</code></pre>
                    </div>
                </div>

                <div class="faq-item">
                    <div class="faq-question">❌ 422 Errors not being recovered</div>
                    <div class="faq-answer">
                        <p><strong>Cause:</strong> 422 error recovery cron is not running or failing.</p>
                        <p><strong>Solution:</strong></p>
                        <ol>
                            <li>Verify 422 cron is started:
                                <pre><code>curl http://localhost:5001/schedule/start422</code></pre>
                            </li>
                            <li>Check 422 logs for execution:
                                <pre><code>db["422cronLogs"].find().sort({_id: -1}).limit(10)</code></pre>
                            </li>
                            <li>Verify cache is accessible (422 errors are cached in Redis)</li>
                            <li>Check <code>_422_CACHE_VALID_PERIOD</code> environment variable (default: 120 minutes)</li>
                        </ol>
                    </div>
                </div>

                <div class="faq-item">
                    <div class="faq-question">❌ Database connection errors</div>
                    <div class="faq-answer">
                        <p><strong>MySQL Connection Error:</strong></p>
                        <pre><code># Check connection details
SQL_HOSTNAME=localhost
SQL_PORT=3306
SQL_USERNAME=root
SQL_PASSWORD=correct_password
SQL_DATABASE=repricer_db

# Test connection manually
mysql -h localhost -u root -p repricer_db</code></pre>

                        <p><strong>MongoDB Connection Error:</strong></p>
                        <pre><code># Verify connection string format
MANAGED_MONGO_URL=mongodb://user:pass@host:27017/database

# Test connection
mongosh "mongodb://user:pass@host:27017/database"</code></pre>

                        <p><strong>Redis Connection Error:</strong></p>
                        <pre><code># Check Redis configuration
CACHE_HOST_URL=redis://localhost
CACHE_PORT=6379
CACHE_PASSWORD=your_password

# Test connection
redis-cli -h localhost -p 6379 -a your_password ping</code></pre>
                    </div>
                </div>

                <div class="faq-item">
                    <div class="faq-question">❌ Proxy switching not working</div>
                    <div class="faq-answer">
                        <p><strong>Cause:</strong> Proxy failure threshold not reached or proxy switch cron not running.</p>
                        <p><strong>Solution:</strong></p>
                        <ol>
                            <li>Check proxy failure count:
                                <pre><code>db.proxyFailureDetails.countDocuments({})</code></pre>
                            </li>
                            <li>Verify threshold setting:
                                <pre><code>PROXYSWITCH_COUNTER_MAXLIMIT=200</code></pre>
                            </li>
                            <li>Check if proxy switch cron is running (should auto-start if <code>SCHEDULE_CRONS_ON_STARTUP=true</code>)</li>
                            <li>Review proxy switch logs in MongoDB</li>
                        </ol>
                    </div>
                </div>

                <div class="faq-item">
                    <div class="faq-question">❌ High memory usage</div>
                    <div class="faq-answer">
                        <p><strong>Possible Causes:</strong></p>
                        <ul>
                            <li>Too many crons running simultaneously</li>
                            <li>Large batch sizes processing too many products at once</li>
                            <li>Memory leak in long-running cron jobs</li>
                        </ul>
                        <p><strong>Solution:</strong></p>
                        <ol>
                            <li>Adjust batch size:
                                <pre><code>BATCH_SIZE=500  # Reduce from default 700</code></pre>
                            </li>
                            <li>Stagger cron schedules to avoid overlap</li>
                            <li>Monitor with:
                                <pre><code># Check Node.js memory usage
node --max-old-space-size=4096 dist/main.js</code></pre>
                            </li>
                            <li>Restart service regularly in production (recommended: daily)</li>
                        </ol>
                    </div>
                </div>

                <div class="faq-item">
                    <div class="faq-question">❌ Repricing not updating Net32 prices</div>
                    <div class="faq-answer">
                        <p><strong>Checklist:</strong></p>
                        <ol>
                            <li>Verify <code>IS_DEV=false</code> in production (dev mode skips actual price updates)</li>
                            <li>Check product's <code>allowReprice</code> flag is <code>true</code></li>
                            <li>Verify product is <code>activated: true</code></li>
                            <li>Check vendor secret key is valid</li>
                            <li>Review response for 422 errors or API rejection messages</li>
                            <li>Verify Net32 API endpoint is accessible:
                                <pre><code>NET32_UPDATE_QUANTITY_URL=https://api.net32.com/inventory/products/update</code></pre>
                            </li>
                        </ol>
                    </div>
                </div>

                <h3>Debugging Steps</h3>

                <div class="step">
                    <span class="step-number">1</span>
                    <strong>Enable Debug Mode</strong>
                    <pre><code># Add to .env
IS_DEBUG=true
REQUEST_LOGGING=true

# Restart server
npm run dev</code></pre>
                </div>

                <div class="step">
                    <span class="step-number">2</span>
                    <strong>Check Application Logs</strong>
                    <pre><code># View logs in real-time
tail -f logs/app.log

# Search for errors
grep "ERROR" logs/app.log | tail -20</code></pre>
                </div>

                <div class="step">
                    <span class="step-number">3</span>
                    <strong>Test Database Connectivity</strong>
                    <pre><code># Create test script: test-db.js
const knex = require('knex')({
  client: 'mysql2',
  connection: {
    host: process.env.SQL_HOSTNAME,
    user: process.env.SQL_USERNAME,
    password: process.env.SQL_PASSWORD,
    database: process.env.SQL_DATABASE
  }
});

knex.raw('SELECT 1')
  .then(() => console.log('MySQL Connected'))
  .catch(err => console.error('MySQL Error:', err));

# Run test
node test-db.js</code></pre>
                </div>

                <div class="step">
                    <span class="step-number">4</span>
                    <strong>Verify API Endpoints</strong>
                    <pre><code># Test all critical endpoints
curl http://localhost:5001/health
curl http://localhost:5001/api/GetStatus

# Test with verbose output
curl -v http://localhost:5001/schedule/StartCronV3</code></pre>
                </div>

                <h3>Getting Help</h3>

                <div class="card">
                    <h4>When reporting issues, include:</h4>
                    <ul>
                        <li>API-Core version (from <code>package.json</code>)</li>
                        <li>Node.js version: <code>node --version</code></li>
                        <li>Error messages from logs</li>
                        <li>Environment configuration (sanitize credentials)</li>
                        <li>Steps to reproduce the issue</li>
                        <li>Expected vs actual behavior</li>
                    </ul>
                </div>

                <div class="info-box">
                    <strong>Contact:</strong> pranoyg52@gmail.com
                </div>
            </section>

            <!-- BEST PRACTICES -->
            <section id="best-practices">
                <h2>Best Practices</h2>

                <h3>Production Deployment</h3>

                <div class="card">
                    <h4>1. Environment Configuration</h4>
                    <ul>
                        <li>Always use environment variables, never hardcode credentials</li>
                        <li>Use different <code>.env</code> files for dev/staging/production</li>
                        <li>Set <code>IS_DEV=false</code> in production to enable actual Net32 updates</li>
                        <li>Enable <code>SCHEDULE_CRONS_ON_STARTUP=true</code> for automatic cron initialization</li>
                        <li>Disable debug logging in production: <code>IS_DEBUG=false</code>, <code>REQUEST_LOGGING=false</code></li>
                    </ul>
                </div>

                <div class="card">
                    <h4>2. Database Optimization</h4>
                    <ul>
                        <li>Index frequently queried MongoDB collections (cronLogs, cronSettings)</li>
                        <li>Set up TTL indexes on log collections to auto-expire old data</li>
                        <li>Monitor MySQL connection pool usage and adjust if needed</li>
                        <li>Use read replicas for heavy read operations</li>
                        <li>Regularly backup databases before major changes</li>
                    </ul>
                </div>

                <div class="card">
                    <h4>3. Cron Job Management</h4>
                    <ul>
                        <li>Stagger cron schedules to prevent simultaneous execution</li>
                        <li>Start with conservative schedules and increase frequency gradually</li>
                        <li>Monitor resource usage during peak cron execution times</li>
                        <li>Use slow crons for non-urgent, resource-intensive operations</li>
                        <li>Keep cron execution logs for at least 30 days</li>
                    </ul>
                </div>

                <div class="card">
                    <h4>4. Error Handling</h4>
                    <ul>
                        <li>Enable 422 error recovery cron for automatic retry</li>
                        <li>Set up monitoring alerts for repeated failures</li>
                        <li>Review error logs daily during initial deployment</li>
                        <li>Implement exponential backoff for proxy retries</li>
                        <li>Log all exceptions with context for debugging</li>
                    </ul>
                </div>

                <h3>Security Best Practices</h3>

                <div class="card">
                    <h4>1. API Keys and Credentials</h4>
                    <ul>
                        <li>Rotate API keys for proxy services quarterly</li>
                        <li>Use separate credentials for dev/staging/production</li>
                        <li>Never commit <code>.env</code> files to version control</li>
                        <li>Use strong passwords for database accounts</li>
                        <li>Limit database user permissions to minimum required</li>
                    </ul>
                </div>

                <div class="card">
                    <h4>2. Network Security</h4>
                    <ul>
                        <li>Run API-Core behind a reverse proxy (nginx)</li>
                        <li>Use HTTPS in production with valid SSL certificates</li>
                        <li>Restrict database access to specific IP addresses</li>
                        <li>Implement rate limiting for public endpoints</li>
                        <li>Use firewall rules to block unauthorized access</li>
                    </ul>
                </div>

                <h3>Performance Optimization</h3>

                <div class="card">
                    <h4>1. Batch Processing</h4>
                    <ul>
                        <li>Adjust <code>BATCH_SIZE</code> based on available memory (default: 700)</li>
                        <li>Process products in batches to prevent memory overflow</li>
                        <li>Use parallel processing for independent operations</li>
                        <li>Monitor batch processing time and adjust size accordingly</li>
                    </ul>
                </div>

                <div class="card">
                    <h4>2. Caching Strategy</h4>
                    <ul>
                        <li>Use Redis for session storage and temporary data</li>
                        <li>Cache frequently accessed product details</li>
                        <li>Set appropriate TTL for cached data (default: 2 hours for 422 cache)</li>
                        <li>Clear cache when configuration changes</li>
                        <li>Monitor cache hit rates</li>
                    </ul>
                </div>

                <div class="card">
                    <h4>3. Proxy Management</h4>
                    <ul>
                        <li>Distribute load across multiple proxy providers</li>
                        <li>Set reasonable timeout values (15 seconds default)</li>
                        <li>Monitor proxy failure rates and adjust thresholds</li>
                        <li>Use proxy rotation to avoid rate limiting</li>
                        <li>Keep proxy credentials secure and rotate regularly</li>
                    </ul>
                </div>

                <h3>Monitoring and Maintenance</h3>

                <div class="card">
                    <h4>1. Regular Monitoring</h4>
                    <ul>
                        <li>Set up health check monitoring (endpoint: <code>/health</code>)</li>
                        <li>Monitor cron execution success rates</li>
                        <li>Track 422 error recovery effectiveness</li>
                        <li>Review proxy failure logs weekly</li>
                        <li>Monitor database query performance</li>
                    </ul>
                </div>

                <div class="card">
                    <h4>2. Scheduled Maintenance</h4>
                    <ul>
                        <li>Archive old logs monthly (MongoDB log collections)</li>
                        <li>Review and optimize slow database queries quarterly</li>
                        <li>Update dependencies and security patches monthly</li>
                        <li>Perform database backups before deployments</li>
                        <li>Test disaster recovery procedures quarterly</li>
                    </ul>
                </div>

                <div class="card">
                    <h4>3. Documentation</h4>
                    <ul>
                        <li>Document all custom cron configurations</li>
                        <li>Maintain runbooks for common issues</li>
                        <li>Keep environment variable documentation up-to-date</li>
                        <li>Document any changes to default settings</li>
                        <li>Share tribal knowledge with team members</li>
                    </ul>
                </div>

                <h3>Development Workflow</h3>

                <div class="card">
                    <h4>1. Local Development</h4>
                    <ul>
                        <li>Always use <code>IS_DEV=true</code> to prevent accidental production updates</li>
                        <li>Use <code>npm run dev</code> for hot-reload during development</li>
                        <li>Test crons manually before scheduling them</li>
                        <li>Keep local database separate from production</li>
                        <li>Use mock data for testing when possible</li>
                    </ul>
                </div>

                <div class="card">
                    <h4>2. Testing</h4>
                    <ul>
                        <li>Write unit tests for business logic</li>
                        <li>Test API endpoints with different scenarios</li>
                        <li>Verify cron execution in staging before production</li>
                        <li>Test error handling and edge cases</li>
                        <li>Run integration tests before major releases</li>
                    </ul>
                </div>

                <div class="card">
                    <h4>3. Deployment</h4>
                    <ul>
                        <li>Use CI/CD pipeline for automated deployments</li>
                        <li>Run database migrations before deploying code changes</li>
                        <li>Deploy during low-traffic periods</li>
                        <li>Have rollback plan ready before deployment</li>
                        <li>Monitor application closely after deployment</li>
                    </ul>
                </div>
            </section>

            <!-- FAQ -->
            <section id="faq">
                <h2>Frequently Asked Questions</h2>

                <div class="faq-item">
                    <div class="faq-question">Q: What's the difference between API-Core and Repricer app?</div>
                    <div class="faq-answer">
                        <p><strong>API-Core</strong> is the orchestration layer that manages when and how repricing happens (cron scheduling, feed processing, coordination).</p>
                        <p><strong>Repricer</strong> contains the actual business logic for pricing algorithms, vendor integrations, and price calculations.</p>
                        <p>Think of API-Core as the conductor and Repricer as the orchestra.</p>
                    </div>
                </div>

                <div class="faq-item">
                    <div class="faq-question">Q: How often should crons run?</div>
                    <div class="faq-answer">
                        <p>It depends on your business needs and system capacity:</p>
                        <ul>
                            <li><strong>High-priority products:</strong> Every 2-4 hours (regular crons)</li>
                            <li><strong>Standard products:</strong> Every 4-6 hours</li>
                            <li><strong>Low-priority products:</strong> Once or twice daily (slow crons)</li>
                            <li><strong>Scraping operations:</strong> Every 4-6 hours to stay current</li>
                        </ul>
                        <p>Monitor system resources and adjust frequencies accordingly.</p>
                    </div>
                </div>

                <div class="faq-item">
                    <div class="faq-question">Q: What happens if a cron fails mid-execution?</div>
                    <div class="faq-answer">
                        <p>The system has several safety mechanisms:</p>
                        <ol>
                            <li>Failed products are logged to <code>errorItems</code> collection</li>
                            <li>422 errors are cached and retried automatically by the 422 recovery cron</li>
                            <li>The cron will resume at the next scheduled time</li>
                            <li>Partial progress is saved (processed products won't be reprocessed)</li>
                        </ol>
                        <p>Always check error logs after failures to identify systemic issues.</p>
                    </div>
                </div>

                <div class="faq-item">
                    <div class="faq-question">Q: Can I run multiple instances of API-Core?</div>
                    <div class="faq-answer">
                        <p>Running multiple instances simultaneously is <strong>not recommended</strong> because:</p>
                        <ul>
                            <li>Cron jobs would execute multiple times</li>
                            <li>Race conditions could occur in database writes</li>
                            <li>Resource usage would multiply unnecessarily</li>
                        </ul>
                        <p>If you need high availability, use a load balancer with health checks but ensure only one instance runs crons (others handle API requests only).</p>
                    </div>
                </div>

                <div class="faq-item">
                    <div class="faq-question">Q: How do I migrate from V1 to V2 algorithm?</div>
                    <div class="faq-answer">
                        <p>The V2 algorithm migration is handled by the <code>db-migrations</code> app:</p>
                        <pre><code>cd apps/db-migrations
npm run migrate-settings</code></pre>
                        <p>This script:</p>
                        <ul>
                            <li>Reads V1 algorithm settings from legacy tables</li>
                            <li>Transforms data to V2 format (27 columns)</li>
                            <li>Populates <code>v2_algo_settings</code> table</li>
                            <li>Preserves business logic and pricing rules</li>
                        </ul>
                        <p>Always test in development environment first before production migration.</p>
                    </div>
                </div>

                <div class="faq-item">
                    <div class="faq-question">Q: What's the purpose of the activeProducts.json file?</div>
                    <div class="faq-answer">
                        <p><code>activeProducts.json</code> is a temporary file that tracks products currently being processed. It's created automatically on server startup and reset on application restart.</p>
                        <p>Purpose: Prevents duplicate processing of the same product by multiple concurrent operations.</p>
                        <p>Location: Root of api-core directory</p>
                        <p>Note: This file is auto-managed and should not be manually edited.</p>
                    </div>
                </div>

                <div class="faq-item">
                    <div class="faq-question">Q: How do I add support for a new vendor?</div>
                    <div class="faq-answer">
                        <p>Adding a new vendor requires changes across multiple applications:</p>
                        <ol>
                            <li>Update <code>packages/shared</code> with new vendor enum</li>
                            <li>Add vendor configuration to MySQL tables (channel_ids, vendor_thresholds)</li>
                            <li>Update Repricer app with vendor-specific logic</li>
                            <li>Add vendor mapping to <code>resources/api-mapping.ts</code> in API-Core</li>
                            <li>Test thoroughly in development environment</li>
                        </ol>
                        <p>This is a complex operation - consult with the development team before proceeding.</p>
                    </div>
                </div>

                <div class="faq-item">
                    <div class="faq-question">Q: Why am I getting "ECONNREFUSED" errors?</div>
                    <div class="faq-answer">
                        <p>Connection refused errors typically mean:</p>
                        <ul>
                            <li><strong>Database not running:</strong> Start MySQL, MongoDB, or Redis service</li>
                            <li><strong>Wrong hostname/port:</strong> Verify <code>.env</code> configuration</li>
                            <li><strong>Firewall blocking:</strong> Check firewall rules allow connections</li>
                            <li><strong>Repricer app not running:</strong> API-Core needs Repricer app on port 3000</li>
                        </ul>
                        <p>Test connectivity with <code>telnet hostname port</code> or <code>nc -zv hostname port</code></p>
                    </div>
                </div>

                <div class="faq-item">
                    <div class="faq-question">Q: How long are logs retained?</div>
                    <div class="faq-answer">
                        <p>Log retention is not automatically configured. Recommended retention:</p>
                        <ul>
                            <li><strong>cronLogs:</strong> 30 days</li>
                            <li><strong>errorItems:</strong> 90 days (for analysis)</li>
                            <li><strong>422cronLogs:</strong> 60 days</li>
                            <li><strong>proxyFailureDetails:</strong> 30 days</li>
                        </ul>
                        <p>Set up MongoDB TTL indexes for automatic expiration:</p>
                        <pre><code>db.cronLogs.createIndex(
  { "createdAt": 1 },
  { expireAfterSeconds: 2592000 }  // 30 days
)</code></pre>
                    </div>
                </div>

                <div class="faq-item">
                    <div class="faq-question">Q: What's the recommended server specifications?</div>
                    <div class="faq-answer">
                        <p><strong>Minimum Requirements:</strong></p>
                        <ul>
                            <li>2 CPU cores</li>
                            <li>4 GB RAM</li>
                            <li>20 GB storage</li>
                        </ul>
                        <p><strong>Recommended for Production:</strong></p>
                        <ul>
                            <li>4 CPU cores</li>
                            <li>8 GB RAM</li>
                            <li>50 GB SSD storage</li>
                            <li>Separate database servers (MySQL, MongoDB, Redis)</li>
                        </ul>
                        <p>Scale up based on product count and cron frequency.</p>
                    </div>
                </div>
            </section>
        </div>

        <footer>
            <p><strong>API-Core User Guide</strong> | Version 1.0.2 | Last Updated: 2025-11-18</p>
            <p>For technical support, contact: pranoyg52@gmail.com</p>
            <p>Part of the Dental Supply Repricer Monorepo System</p>
        </footer>
    </div>
</body>
</html>