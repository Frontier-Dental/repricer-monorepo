<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Excel Export Service - User Guide</title>
    <style>
        :root {
            --primary-color: #2563eb;
            --secondary-color: #1e40af;
            --success-color: #059669;
            --warning-color: #d97706;
            --danger-color: #dc2626;
            --info-color: #0891b2;
            --bg-color: #f8fafc;
            --text-color: #1e293b;
            --border-color: #e2e8f0;
            --code-bg: #f1f5f9;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            line-height: 1.6;
            color: var(--text-color);
            background-color: var(--bg-color);
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
            color: white;
            padding: 40px 0;
            margin-bottom: 40px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }

        header p {
            font-size: 1.2rem;
            opacity: 0.9;
        }

        nav {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            margin-bottom: 30px;
            position: sticky;
            top: 20px;
            z-index: 100;
        }

        nav h3 {
            margin-bottom: 15px;
            color: var(--primary-color);
        }

        nav ul {
            list-style: none;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 10px;
        }

        nav a {
            color: var(--text-color);
            text-decoration: none;
            padding: 8px 12px;
            display: block;
            border-radius: 4px;
            transition: all 0.2s;
        }

        nav a:hover {
            background-color: var(--code-bg);
            color: var(--primary-color);
        }

        section {
            background: white;
            padding: 30px;
            margin-bottom: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        h2 {
            color: var(--primary-color);
            font-size: 2rem;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 3px solid var(--primary-color);
        }

        h3 {
            color: var(--secondary-color);
            font-size: 1.5rem;
            margin: 25px 0 15px 0;
        }

        h4 {
            color: var(--text-color);
            font-size: 1.2rem;
            margin: 20px 0 10px 0;
        }

        p {
            margin-bottom: 15px;
        }

        ul, ol {
            margin-left: 20px;
            margin-bottom: 15px;
        }

        li {
            margin-bottom: 8px;
        }

        code {
            background-color: var(--code-bg);
            padding: 2px 6px;
            border-radius: 3px;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
        }

        pre {
            background-color: var(--code-bg);
            padding: 20px;
            border-radius: 8px;
            overflow-x: auto;
            margin: 15px 0;
            border-left: 4px solid var(--primary-color);
        }

        pre code {
            background: none;
            padding: 0;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        th, td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid var(--border-color);
        }

        th {
            background-color: var(--primary-color);
            color: white;
            font-weight: 600;
        }

        tr:hover {
            background-color: var(--code-bg);
        }

        .alert {
            padding: 15px 20px;
            border-radius: 8px;
            margin: 20px 0;
            border-left: 4px solid;
        }

        .alert-info {
            background-color: #e0f2fe;
            border-color: var(--info-color);
            color: #075985;
        }

        .alert-success {
            background-color: #d1fae5;
            border-color: var(--success-color);
            color: #065f46;
        }

        .alert-warning {
            background-color: #fef3c7;
            border-color: var(--warning-color);
            color: #92400e;
        }

        .alert-danger {
            background-color: #fee2e2;
            border-color: var(--danger-color);
            color: #991b1b;
        }

        .badge {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 0.85em;
            font-weight: 600;
            margin-right: 5px;
        }

        .badge-primary {
            background-color: var(--primary-color);
            color: white;
        }

        .badge-success {
            background-color: var(--success-color);
            color: white;
        }

        .badge-warning {
            background-color: var(--warning-color);
            color: white;
        }

        .feature-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }

        .feature-card {
            padding: 20px;
            border: 2px solid var(--border-color);
            border-radius: 8px;
            transition: all 0.3s;
        }

        .feature-card:hover {
            border-color: var(--primary-color);
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }

        .feature-card h4 {
            color: var(--primary-color);
            margin-top: 0;
        }

        .endpoint {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 15px 20px;
            border-radius: 8px;
            margin: 15px 0;
            font-family: monospace;
        }

        .endpoint .method {
            font-weight: bold;
            background: rgba(255, 255, 255, 0.2);
            padding: 4px 8px;
            border-radius: 4px;
            margin-right: 10px;
        }

        .screenshot {
            max-width: 100%;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            margin: 20px 0;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }

        footer {
            text-align: center;
            padding: 30px;
            color: #64748b;
            margin-top: 40px;
        }

        @media print {
            nav {
                position: static;
            }

            section {
                page-break-inside: avoid;
            }
        }
    </style>
</head>
<body>
    <header>
        <div class="container">
            <h1>üìä Excel Export Service</h1>
            <p>Comprehensive User Guide for Dental Supply Repricing Data Exports</p>
        </div>
    </header>

    <div class="container">
        <nav>
            <h3>Quick Navigation</h3>
            <ul>
                <li><a href="#getting-started">Getting Started</a></li>
                <li><a href="#core-concepts">Core Concepts</a></li>
                <li><a href="#tutorials">Tutorials</a></li>
                <li><a href="#column-reference">Column Reference</a></li>
                <li><a href="#vendor-integration">Vendor Integration</a></li>
                <li><a href="#api-usage">API Usage</a></li>
                <li><a href="#performance">Performance Guide</a></li>
                <li><a href="#excel-features">Excel Features</a></li>
                <li><a href="#troubleshooting">Troubleshooting</a></li>
                <li><a href="#best-practices">Best Practices</a></li>
                <li><a href="#faq">FAQ</a></li>
            </ul>
        </nav>

        <!-- GETTING STARTED -->
        <section id="getting-started">
            <h2>üöÄ Getting Started</h2>

            <h3>What is Excel Export Service?</h3>
            <p>The Excel Export Service is a specialized microservice within the dental supply repricing monorepo that generates comprehensive Excel reports containing detailed product and vendor pricing data. It provides data analysts and business users with a powerful tool to extract, analyze, and report on repricing operations across multiple dental supply vendors.</p>

            <div class="alert alert-info">
                <strong>üìå Key Purpose:</strong> Transform complex multi-vendor repricing data from MySQL and MongoDB into structured, analyst-friendly Excel workbooks with 63 columns of detailed information per product-vendor combination.
            </div>

            <h3>When to Use Excel Export</h3>
            <ul>
                <li><strong>Regular Reporting:</strong> Generate weekly or monthly repricing performance reports</li>
                <li><strong>Data Analysis:</strong> Perform deep-dive analysis on pricing strategies and competition</li>
                <li><strong>Audit & Compliance:</strong> Create audit trails of pricing changes and algorithm decisions</li>
                <li><strong>Vendor Performance:</strong> Compare performance metrics across the 6 supported vendors</li>
                <li><strong>Algorithm Validation:</strong> Verify V2 algorithm outputs against business rules</li>
                <li><strong>Executive Dashboards:</strong> Provide source data for business intelligence tools</li>
            </ul>

            <h3>Service Specifications</h3>
            <div class="feature-grid">
                <div class="feature-card">
                    <h4>üéØ Purpose</h4>
                    <p>Vendor report export with streaming architecture</p>
                </div>
                <div class="feature-card">
                    <h4>üî¢ Data Coverage</h4>
                    <p>63 columns per product-vendor</p>
                </div>
                <div class="feature-card">
                    <h4>üè™ Vendor Support</h4>
                    <p>6 dental supply vendors</p>
                </div>
                <div class="feature-card">
                    <h4>‚ö° Performance</h4>
                    <p>Streaming for unlimited dataset size</p>
                </div>
                <div class="feature-card">
                    <h4>üóÑÔ∏è Data Sources</h4>
                    <p>MySQL + MongoDB hybrid</p>
                </div>
                <div class="feature-card">
                    <h4>üåê Access</h4>
                    <p>REST API on port 3003</p>
                </div>
            </div>

            <h3>Quick Start</h3>
            <p>To generate your first export:</p>
            <pre><code>curl -X GET "http://localhost:3003/api/excel/download" \
  -H "Content-Type: application/json" \
  --output products-export.xlsx</code></pre>

            <div class="alert alert-success">
                <strong>‚úÖ Service Health Check:</strong> Before using the service, verify it's running at <code>http://localhost:3003/health</code>
            </div>
        </section>

        <!-- CORE CONCEPTS -->
        <section id="core-concepts">
            <h2>üß† Core Concepts</h2>

            <h3>Streaming Architecture</h3>
            <p>Unlike traditional Excel generation that loads all data into memory, the Excel Export Service uses <strong>ExcelJS streaming</strong> to write data directly to the HTTP response. This architectural decision enables:</p>

            <ul>
                <li><strong>Memory Efficiency:</strong> No dataset size limitations - handle 10,000+ products without memory crashes</li>
                <li><strong>Progressive Delivery:</strong> Clients receive data as it's generated, reducing perceived latency</li>
                <li><strong>Scalability:</strong> Server can handle concurrent export requests without memory exhaustion</li>
                <li><strong>Reliability:</strong> Prevents Node.js heap overflow errors common with large in-memory buffers</li>
            </ul>

            <div class="alert alert-warning">
                <strong>‚ö†Ô∏è Important:</strong> Streaming exports cannot be canceled mid-generation. Once initiated, the service will complete the full export even if the client disconnects.
            </div>

            <h3>63-Column Format</h3>
            <p>Each row in the export represents a single product-vendor combination with 63 standardized columns covering:</p>

            <table>
                <thead>
                    <tr>
                        <th>Category</th>
                        <th>Columns</th>
                        <th>Purpose</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><strong>Product Identity</strong></td>
                        <td>4 columns</td>
                        <td>MPID, Channel Name, Channel ID, Focus ID</td>
                    </tr>
                    <tr>
                        <td><strong>Pricing Configuration</strong></td>
                        <td>8 columns</td>
                        <td>Unit Price, Floor Price, Max Price, NC settings, suppression rules</td>
                    </tr>
                    <tr>
                        <td><strong>Algorithm Settings</strong></td>
                        <td>15 columns</td>
                        <td>Badge strategy, percentages, competition rules, buy-box logic</td>
                    </tr>
                    <tr>
                        <td><strong>Execution Status</strong></td>
                        <td>12 columns</td>
                        <td>Cron schedules, last run times, execution results, errors</td>
                    </tr>
                    <tr>
                        <td><strong>Competitive Intelligence</strong></td>
                        <td>8 columns</td>
                        <td>Lowest vendor, prices, comparison data, vendor thresholds</td>
                    </tr>
                    <tr>
                        <td><strong>Advanced Configuration</strong></td>
                        <td>10 columns</td>
                        <td>Handling time filters, inventory thresholds, vendor exclusions</td>
                    </tr>
                    <tr>
                        <td><strong>Audit Trail</strong></td>
                        <td>6 columns</td>
                        <td>Last updated by, timestamps, override flags, activation status</td>
                    </tr>
                </tbody>
            </table>

            <h3>Vendor Data Structure</h3>
            <p>The export uses a <strong>flattened multi-vendor approach</strong>. For each product (identified by MPID), the system generates separate rows for each vendor where that product is listed:</p>

            <pre><code>Product MPID: 12345
  ‚îú‚îÄ‚îÄ Tradent Row (63 columns with Tradent-specific data)
  ‚îú‚îÄ‚îÄ Frontier Row (63 columns with Frontier-specific data)
  ‚îú‚îÄ‚îÄ MVP Row (63 columns with MVP-specific data)
  ‚îú‚îÄ‚îÄ TopDent Row (63 columns with TopDent-specific data)
  ‚îú‚îÄ‚îÄ FirstDent Row (63 columns with FirstDent-specific data)
  ‚îî‚îÄ‚îÄ Triad Row (63 columns with Triad-specific data)</code></pre>

            <p>This structure enables:</p>
            <ul>
                <li>Direct vendor-to-vendor comparison using Excel filters and pivot tables</li>
                <li>Vendor-specific pricing strategy analysis</li>
                <li>Cross-vendor performance metrics</li>
                <li>Individual vendor export filtering via API parameters</li>
            </ul>

            <h3>Hybrid Database Architecture</h3>
            <p>The Excel Export Service aggregates data from multiple database sources:</p>

            <div class="feature-grid">
                <div class="feature-card">
                    <h4>MySQL (Primary)</h4>
                    <p><strong>Purpose:</strong> Structured product and vendor configuration</p>
                    <p><strong>Tables:</strong></p>
                    <ul>
                        <li><code>table_scrapeProductList</code></li>
                        <li><code>table_tradentDetails</code></li>
                        <li><code>table_frontierDetails</code></li>
                        <li><code>table_mvpDetails</code></li>
                        <li><code>table_firstDentDetails</code></li>
                        <li><code>table_topDentDetails</code></li>
                        <li><code>table_triadDetails</code></li>
                    </ul>
                </div>
                <div class="feature-card">
                    <h4>MongoDB (Historical)</h4>
                    <p><strong>Purpose:</strong> Execution logs and cached product details</p>
                    <p><strong>Collections:</strong></p>
                    <ul>
                        <li>Execution history</li>
                        <li>Scrape results</li>
                        <li>Algorithm decisions</li>
                        <li>Error logs</li>
                    </ul>
                </div>
                <div class="feature-card">
                    <h4>Redis (Session)</h4>
                    <p><strong>Purpose:</strong> Session storage and caching</p>
                    <p><strong>Usage:</strong></p>
                    <ul>
                        <li>User authentication</li>
                        <li>Export request caching</li>
                        <li>Rate limiting data</li>
                    </ul>
                </div>
            </div>

            <h3>Badge Competition Strategies</h3>
            <p>The export includes detailed badge strategy configuration that controls how products compete based on seller badge levels:</p>

            <table>
                <thead>
                    <tr>
                        <th>Strategy</th>
                        <th>Code</th>
                        <th>Behavior</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><span class="badge badge-primary">ALL_ZERO</span></td>
                        <td>Badge Level 0</td>
                        <td>Compete against all sellers treating all as badge level 0 (ignore badge differences)</td>
                    </tr>
                    <tr>
                        <td><span class="badge badge-success">ALL_PERCENTAGE</span></td>
                        <td>Percentage-based</td>
                        <td>Use percentage adjustments across all badge levels for competitive pricing</td>
                    </tr>
                    <tr>
                        <td><span class="badge badge-warning">BADGE_ONLY</span></td>
                        <td>Same Badge</td>
                        <td>Only compete with sellers at the same badge level (strict badge matching)</td>
                    </tr>
                    <tr>
                        <td><span class="badge badge-primary">NON_BADGE_ONLY</span></td>
                        <td>Non-Badge</td>
                        <td>Compete exclusively with non-badged sellers (avoid badge competition)</td>
                    </tr>
                </tbody>
            </table>

            <div class="alert alert-info">
                <strong>üí° Analysis Tip:</strong> Use the <code>Badge Indicator</code> column to segment export data by strategy, then compare pricing performance across different badge approaches.
            </div>
        </section>

        <!-- TUTORIALS -->
        <section id="tutorials">
            <h2>üìö Step-by-Step Tutorials</h2>

            <h3>Tutorial 1: Generating Your First Export</h3>
            <p>This tutorial walks through creating a complete product export and opening it in Excel.</p>

            <h4>Step 1: Verify Service Status</h4>
            <pre><code>curl http://localhost:3003/health</code></pre>

            <p><strong>Expected Response:</strong></p>
            <pre><code>{
  "status": "healthy",
  "service": "excel-export",
  "timestamp": "2025-11-18T10:30:00.000Z"
}</code></pre>

            <h4>Step 2: Request Full Export</h4>
            <pre><code>curl -X GET "http://localhost:3003/api/excel/download" \
  -H "Content-Type: application/json" \
  --output my-first-export.xlsx</code></pre>

            <h4>Step 3: Open in Excel</h4>
            <ul>
                <li>Navigate to the download directory</li>
                <li>Double-click <code>my-first-export.xlsx</code></li>
                <li>Excel will open with frozen headers at row 1</li>
                <li>Auto-filters enabled on all 63 columns (A1:BK1)</li>
            </ul>

            <div class="alert alert-success">
                <strong>‚úÖ Success Indicator:</strong> You should see multiple rows per MPID (one for each vendor) with all 63 columns populated.
            </div>

            <h3>Tutorial 2: Filtering by Vendor Channel</h3>
            <p>Learn how to export data for a specific vendor channel (e.g., only Tradent products).</p>

            <h4>Step 1: Identify Vendor Channel Names</h4>
            <p>Valid channel names:</p>
            <ul>
                <li><code>TRADENT</code></li>
                <li><code>FRONTIER</code></li>
                <li><code>MVP</code></li>
                <li><code>TOPDENT</code></li>
                <li><code>FIRSTDENT</code></li>
                <li><code>TRIAD</code></li>
            </ul>

            <h4>Step 2: Request Vendor-Specific Export</h4>
            <p>Currently, the service returns all vendor channels. To filter for a specific vendor, you'll need to:</p>

            <p><strong>Option A: Excel Filtering (Recommended)</strong></p>
            <ol>
                <li>Generate full export using Tutorial 1</li>
                <li>Open in Excel</li>
                <li>Click the dropdown arrow in <code>Channel Name</code> column (Column A)</li>
                <li>Uncheck "Select All"</li>
                <li>Check only "TRADENT" (or your desired vendor)</li>
                <li>Click OK</li>
            </ol>

            <p><strong>Option B: Post-Processing</strong></p>
            <pre><code># Use command-line tools to filter (Linux/Mac)
csvgrep -c "Channel Name" -m "TRADENT" products.csv > tradent-only.csv</code></pre>

            <h3>Tutorial 3: Understanding Export Columns</h3>
            <p>A guided tour through the most important columns for analysis.</p>

            <h4>Step 1: Product Identification Columns</h4>
            <table>
                <thead>
                    <tr>
                        <th>Column</th>
                        <th>Position</th>
                        <th>What to Look For</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><code>Channel Name</code></td>
                        <td>A</td>
                        <td>Which vendor this row represents</td>
                    </tr>
                    <tr>
                        <td><code>MPID</code></td>
                        <td>C</td>
                        <td>Unique product identifier (same across all vendors for one product)</td>
                    </tr>
                    <tr>
                        <td><code>Channel ID</code></td>
                        <td>D</td>
                        <td>Vendor-specific product ID on their marketplace</td>
                    </tr>
                </tbody>
            </table>

            <h4>Step 2: Pricing Strategy Columns</h4>
            <table>
                <thead>
                    <tr>
                        <th>Column</th>
                        <th>Position</th>
                        <th>Business Meaning</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><code>Unit Price</code></td>
                        <td>E</td>
                        <td>Current base price for the product</td>
                    </tr>
                    <tr>
                        <td><code>Floor Price</code></td>
                        <td>F</td>
                        <td>Minimum price allowed (algorithm won't price below this)</td>
                    </tr>
                    <tr>
                        <td><code>Max Price</code></td>
                        <td>G</td>
                        <td>Maximum price ceiling (algorithm won't exceed this)</td>
                    </tr>
                    <tr>
                        <td><code>Last Existing Price</code></td>
                        <td>AC</td>
                        <td>Price currently live on marketplace before last reprice</td>
                    </tr>
                    <tr>
                        <td><code>Last Suggested Price</code></td>
                        <td>AD</td>
                        <td>Price calculated by algorithm in last run</td>
                    </tr>
                </tbody>
            </table>

            <h4>Step 3: Execution Status Columns</h4>
            <table>
                <thead>
                    <tr>
                        <th>Column</th>
                        <th>Position</th>
                        <th>Operational Insight</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><code>Active - Repricer</code></td>
                        <td>B</td>
                        <td>Is automatic repricing enabled? (true/false)</td>
                    </tr>
                    <tr>
                        <td><code>Last CRON run at</code></td>
                        <td>U</td>
                        <td>When did the repricer last process this product?</td>
                    </tr>
                    <tr>
                        <td><code>Last Reprice Comment</code></td>
                        <td>Y</td>
                        <td>Algorithm decision explanation or error message</td>
                    </tr>
                    <tr>
                        <td><code>Result</code></td>
                        <td>BI</td>
                        <td>Success/failure status of last reprice attempt</td>
                    </tr>
                </tbody>
            </table>

            <h3>Tutorial 4: Working with Large Datasets</h3>
            <p>Best practices for exports containing thousands of products.</p>

            <h4>Step 1: Request Export</h4>
            <pre><code>curl -X GET "http://localhost:3003/api/excel/download" \
  --output large-export.xlsx \
  --max-time 600  # 10-minute timeout for large datasets</code></pre>

            <h4>Step 2: Monitor Progress</h4>
            <p>For large exports, monitor file size growth:</p>
            <pre><code># In separate terminal (Linux/Mac)
watch -n 2 'ls -lh large-export.xlsx'</code></pre>

            <h4>Step 3: Excel Performance Tips</h4>
            <ul>
                <li><strong>Disable Auto-Calculation:</strong> Formulas ‚Üí Calculation Options ‚Üí Manual</li>
                <li><strong>Filter Before Analysis:</strong> Apply filters to reduce visible rows before complex operations</li>
                <li><strong>Use Pivot Tables:</strong> For 10,000+ rows, pivot tables outperform manual analysis</li>
                <li><strong>Save as Binary:</strong> Save as XLSB format to reduce file size by 50-70%</li>
            </ul>

            <div class="alert alert-warning">
                <strong>‚ö†Ô∏è Excel Limits:</strong> Excel has a maximum of 1,048,576 rows. If your export exceeds this, consider filtering by vendor channel or time period.
            </div>
        </section>

        <!-- COLUMN REFERENCE -->
        <section id="column-reference">
            <h2>üìã Complete Export Column Reference</h2>
            <p>Comprehensive documentation of all 63 columns with data types, examples, and analysis use cases.</p>

            <h3>Product Identity Columns (4 columns)</h3>
            <table>
                <thead>
                    <tr>
                        <th style="width: 25%">Column Name</th>
                        <th style="width: 15%">Data Type</th>
                        <th style="width: 60%">Description & Example</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><code>Channel Name</code></td>
                        <td>String</td>
                        <td><strong>Vendor channel identifier.</strong> Values: TRADENT, FRONTIER, MVP, TOPDENT, FIRSTDENT, TRIAD<br><em>Example: "TRADENT"</em></td>
                    </tr>
                    <tr>
                        <td><code>MPID</code></td>
                        <td>Integer</td>
                        <td><strong>Master Product ID.</strong> Unique identifier across all vendors for the same physical product.<br><em>Example: 123456</em></td>
                    </tr>
                    <tr>
                        <td><code>Channel ID</code></td>
                        <td>String</td>
                        <td><strong>Vendor-specific product ID.</strong> The unique identifier this vendor uses on their marketplace.<br><em>Example: "TRAD-PROD-789"</em></td>
                    </tr>
                    <tr>
                        <td><code>Net32 URl</code></td>
                        <td>URL String</td>
                        <td><strong>Product URL on Net32 marketplace.</strong> Direct link to product listing page.<br><em>Example: "https://www.net32.com/product/123456"</em></td>
                    </tr>
                </tbody>
            </table>

            <h3>Pricing Configuration Columns (8 columns)</h3>
            <table>
                <thead>
                    <tr>
                        <th style="width: 25%">Column Name</th>
                        <th style="width: 15%">Data Type</th>
                        <th style="width: 60%">Description & Example</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><code>Unit Price</code></td>
                        <td>Decimal</td>
                        <td><strong>Base price per unit.</strong> Starting price before algorithm adjustments.<br><em>Example: 45.99</em></td>
                    </tr>
                    <tr>
                        <td><code>Floor Price</code></td>
                        <td>Decimal</td>
                        <td><strong>Minimum allowed price.</strong> Hard lower limit - algorithm will never price below this.<br><em>Example: 39.99</em></td>
                    </tr>
                    <tr>
                        <td><code>Max Price</code></td>
                        <td>Decimal</td>
                        <td><strong>Maximum allowed price.</strong> Hard upper limit - algorithm will never exceed this.<br><em>Example: 59.99</em></td>
                    </tr>
                    <tr>
                        <td><code>NC</code></td>
                        <td>Boolean</td>
                        <td><strong>No Charge flag.</strong> If true, product should not incur shipping charges in calculations.<br><em>Example: false</em></td>
                    </tr>
                    <tr>
                        <td><code>Suppress Price Break if Qty 1 not updated</code></td>
                        <td>Boolean</td>
                        <td><strong>Quantity break suppression rule.</strong> If Qty 1 price unchanged, don't update quantity break pricing.<br><em>Example: true</em></td>
                    </tr>
                    <tr>
                        <td><code>Up/Down</code></td>
                        <td>String</td>
                        <td><strong>Repricing direction.</strong> Controls whether algorithm can price up, down, or both. Values: "UP", "DOWN", "BOTH"<br><em>Example: "BOTH"</em></td>
                    </tr>
                    <tr>
                        <td><code>Suppress Price Break</code></td>
                        <td>Boolean</td>
                        <td><strong>Disable quantity break pricing.</strong> If true, only compete on single-unit pricing.<br><em>Example: false</em></td>
                    </tr>
                    <tr>
                        <td><code>Compete On Price Breaks Only</code></td>
                        <td>Boolean</td>
                        <td><strong>Quantity break competition focus.</strong> If true, compete only on quantity break tiers, ignore unit price.<br><em>Example: false</em></td>
                    </tr>
                </tbody>
            </table>

            <h3>Algorithm Settings Columns (15 columns)</h3>
            <table>
                <thead>
                    <tr>
                        <th style="width: 25%">Column Name</th>
                        <th style="width: 15%">Data Type</th>
                        <th style="width: 60%">Description & Example</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><code>Badge Indicator</code></td>
                        <td>String</td>
                        <td><strong>Badge competition strategy.</strong> How product competes based on seller badges. Values: "ALL_ZERO", "ALL_PERCENTAGE", "BADGE_ONLY", "NON_BADGE_ONLY"<br><em>Example: "ALL_PERCENTAGE"</em></td>
                    </tr>
                    <tr>
                        <td><code>Reprice Up %</code></td>
                        <td>Decimal</td>
                        <td><strong>Upward price adjustment percentage.</strong> How much to increase price when repricing up.<br><em>Example: 2.5 (represents 2.5%)</em></td>
                    </tr>
                    <tr>
                        <td><code>Reprice UP Badge Percentage %</code></td>
                        <td>Decimal</td>
                        <td><strong>Badge-specific upward adjustment.</strong> Additional percentage when competing against badged sellers.<br><em>Example: 3.0</em></td>
                    </tr>
                    <tr>
                        <td><code>Reprice Down %</code></td>
                        <td>Decimal</td>
                        <td><strong>Downward price adjustment percentage.</strong> How much to decrease price when repricing down.<br><em>Example: 1.5</em></td>
                    </tr>
                    <tr>
                        <td><code>Reprice Down Badge %</code></td>
                        <td>Decimal</td>
                        <td><strong>Badge-specific downward adjustment.</strong> Additional percentage when pricing down against badges.<br><em>Example: 2.0</em></td>
                    </tr>
                    <tr>
                        <td><code>Compare Q2 with Q1</code></td>
                        <td>Boolean</td>
                        <td><strong>Quantity tier comparison.</strong> When evaluating pricing, compare Quantity Tier 2 against Tier 1.<br><em>Example: true</em></td>
                    </tr>
                    <tr>
                        <td><code>Compete With All Vendors</code></td>
                        <td>Boolean</td>
                        <td><strong>Universal competition flag.</strong> If true, compete against all vendors; if false, use exclusion rules.<br><em>Example: false</em></td>
                    </tr>
                    <tr>
                        <td><code>Sister Vendor Id</code></td>
                        <td>String</td>
                        <td><strong>Related vendor identification.</strong> Sister company vendor ID to coordinate pricing strategy.<br><em>Example: "VENDOR_123"</em></td>
                    </tr>
                    <tr>
                        <td><code>Include Inactive Vendors</code></td>
                        <td>Boolean</td>
                        <td><strong>Inactive vendor consideration.</strong> Include temporarily inactive vendors in competition analysis.<br><em>Example: false</em></td>
                    </tr>
                    <tr>
                        <td><code>Inactive Vendor Id</code></td>
                        <td>String</td>
                        <td><strong>Inactive vendor list.</strong> Comma-separated vendor IDs marked as inactive.<br><em>Example: "VENDOR_45,VENDOR_67"</em></td>
                    </tr>
                    <tr>
                        <td><code>Apply Buy Box</code></td>
                        <td>Boolean</td>
                        <td><strong>Buy Box algorithm activation.</strong> Enable advanced buy-box optimization logic for this product.<br><em>Example: true</em></td>
                    </tr>
                    <tr>
                        <td><code>Apply NC For Buy Box</code></td>
                        <td>Boolean</td>
                        <td><strong>No-charge buy-box optimization.</strong> Apply NC considerations when calculating buy-box eligibility.<br><em>Example: false</em></td>
                    </tr>
                    <tr>
                        <td><code>Keep Position</code></td>
                        <td>Boolean</td>
                        <td><strong>Market position maintenance.</strong> Try to maintain current competitive rank rather than maximize win rate.<br><em>Example: false</em></td>
                    </tr>
                    <tr>
                        <td><code>Floor-Compete With Next</code></td>
                        <td>Boolean</td>
                        <td><strong>Floor price competition strategy.</strong> When at floor, compete with next-lowest priced competitor.<br><em>Example: true</em></td>
                    </tr>
                    <tr>
                        <td><code>Ignore Phantom Q Break</code></td>
                        <td>Boolean</td>
                        <td><strong>Phantom quantity break handling.</strong> Ignore competitor quantity breaks that appear invalid or gaming.<br><em>Example: true</em></td>
                    </tr>
                </tbody>
            </table>

            <h3>Execution Status Columns (12 columns)</h3>
            <table>
                <thead>
                    <tr>
                        <th style="width: 25%">Column Name</th>
                        <th style="width: 15%">Data Type</th>
                        <th style="width: 60%">Description & Example</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><code>Active - Repricer</code></td>
                        <td>Boolean</td>
                        <td><strong>Repricing activation status.</strong> Is automatic repricing currently enabled for this product-vendor?<br><em>Example: true</em></td>
                    </tr>
                    <tr>
                        <td><code>Cron Name</code></td>
                        <td>String</td>
                        <td><strong>Regular cron job identifier.</strong> Name of the standard repricing schedule assigned to this product.<br><em>Example: "REGULAR_CRON_001"</em></td>
                    </tr>
                    <tr>
                        <td><code>Slow Cron Name</code></td>
                        <td>String</td>
                        <td><strong>Extended processing cron.</strong> Name of slower, more thorough repricing schedule for complex products.<br><em>Example: "SLOW_CRON_005"</em></td>
                    </tr>
                    <tr>
                        <td><code>Is Slow Activated</code></td>
                        <td>Boolean</td>
                        <td><strong>Slow cron enablement.</strong> Is the product enrolled in slow cron processing?<br><em>Example: false</em></td>
                    </tr>
                    <tr>
                        <td><code>Reprice - Scrape</code></td>
                        <td>Boolean</td>
                        <td><strong>Scraping during reprice.</strong> Should competitor data be scraped when repricing this product?<br><em>Example: true</em></td>
                    </tr>
                    <tr>
                        <td><code>Reprice</code></td>
                        <td>Boolean</td>
                        <td><strong>Repricing permission flag.</strong> Is algorithm allowed to change prices for this product?<br><em>Example: true</em></td>
                    </tr>
                    <tr>
                        <td><code>Data - Scrape</code></td>
                        <td>Boolean</td>
                        <td><strong>Data-only scraping.</strong> Collect competitor data without repricing (for analysis/monitoring).<br><em>Example: false</em></td>
                    </tr>
                    <tr>
                        <td><code>DataOnlyCronName</code></td>
                        <td>String</td>
                        <td><strong>Data collection cron.</strong> Dedicated cron for scraping without repricing actions.<br><em>Example: "DATA_SCRAPE_CRON_03"</em></td>
                    </tr>
                    <tr>
                        <td><code>Last CRON run at</code></td>
                        <td>DateTime</td>
                        <td><strong>Last execution timestamp.</strong> When did the repricer last process this product?<br><em>Example: "2025-11-18 09:45:23"</em></td>
                    </tr>
                    <tr>
                        <td><code>Last run cron-type</code></td>
                        <td>String</td>
                        <td><strong>Execution type identifier.</strong> Which cron type executed last? Values: "REGULAR", "SLOW", "SCRAPE", "FILTER", "422_ERROR"<br><em>Example: "REGULAR"</em></td>
                    </tr>
                    <tr>
                        <td><code>Next Cron Time</code></td>
                        <td>DateTime</td>
                        <td><strong>Scheduled next execution.</strong> When is the next repricing run scheduled?<br><em>Example: "2025-11-18 11:00:00"</em></td>
                    </tr>
                    <tr>
                        <td><code>ExecutionPriority</code></td>
                        <td>Integer</td>
                        <td><strong>Execution queue priority.</strong> Lower numbers process first. Range: 1 (highest) to 10 (lowest)<br><em>Example: 3</em></td>
                    </tr>
                </tbody>
            </table>

            <h3>Competitive Intelligence Columns (8 columns)</h3>
            <table>
                <thead>
                    <tr>
                        <th style="width: 25%">Column Name</th>
                        <th style="width: 15%">Data Type</th>
                        <th style="width: 60%">Description & Example</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><code>Lowest Vendor Price</code></td>
                        <td>String</td>
                        <td><strong>Competitor's lowest price.</strong> Best price found among competing vendors (includes trailing slash for formatting).<br><em>Example: "43.50 /"</em></td>
                    </tr>
                    <tr>
                        <td><code>Lowest Vendor</code></td>
                        <td>String</td>
                        <td><strong>Price leader identification.</strong> Which vendor currently has the lowest price?<br><em>Example: "Competitor_Vendor_XYZ"</em></td>
                    </tr>
                    <tr>
                        <td><code>Last Existing Price</code></td>
                        <td>String</td>
                        <td><strong>Pre-reprice marketplace price.</strong> Price that was live before last algorithm execution.<br><em>Example: "45.99 /"</em></td>
                    </tr>
                    <tr>
                        <td><code>Last Suggested Price</code></td>
                        <td>String</td>
                        <td><strong>Algorithm output price.</strong> Price calculated and recommended by repricing algorithm.<br><em>Example: "44.25 /"</em></td>
                    </tr>
                    <tr>
                        <td><code>Latest Price</code></td>
                        <td>Decimal</td>
                        <td><strong>Current live price.</strong> Most recent confirmed price on marketplace.<br><em>Example: 44.25</em></td>
                    </tr>
                    <tr>
                        <td><code>Exclude Vendor(s)</code></td>
                        <td>String</td>
                        <td><strong>Competition exclusion list.</strong> Comma-separated vendor IDs to exclude from competitive analysis.<br><em>Example: "VENDOR_12,VENDOR_34"</em></td>
                    </tr>
                    <tr>
                        <td><code>Triggered By Vendor</code></td>
                        <td>String</td>
                        <td><strong>Reprice trigger source.</strong> Which competitor vendor triggered the last price change?<br><em>Example: "VENDOR_XYZ"</em></td>
                    </tr>
                    <tr>
                        <td><code>Own Vendor Threshold</code></td>
                        <td>Integer</td>
                        <td><strong>Internal competition threshold.</strong> Minimum number of own-vendor offers before applying special rules.<br><em>Example: 1</em></td>
                    </tr>
                </tbody>
            </table>

            <h3>Advanced Configuration Columns (10 columns)</h3>
            <table>
                <thead>
                    <tr>
                        <th style="width: 25%">Column Name</th>
                        <th style="width: 15%">Data Type</th>
                        <th style="width: 60%">Description & Example</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><code>Handling Time Group</code></td>
                        <td>String</td>
                        <td><strong>Shipping time filter.</strong> Only compete with vendors in same handling time group. Values: "1_DAY", "2_3_DAYS", "4_7_DAYS", "8_PLUS_DAYS"<br><em>Example: "2_3_DAYS"</em></td>
                    </tr>
                    <tr>
                        <td><code>Inventory Competition Threshold</code></td>
                        <td>Integer</td>
                        <td><strong>Inventory level for competition.</strong> Only compete with vendors showing at least this inventory count.<br><em>Example: 5</em></td>
                    </tr>
                    <tr>
                        <td><code>IsBadgeItem</code></td>
                        <td>Boolean</td>
                        <td><strong>Badge product designation.</strong> Is this product eligible for badge-level repricing strategies?<br><em>Example: true</em></td>
                    </tr>
                    <tr>
                        <td><code>Override Bulk Update</code></td>
                        <td>Boolean</td>
                        <td><strong>Bulk operation exemption.</strong> Exclude this product from bulk pricing updates.<br><em>Example: false</em></td>
                    </tr>
                    <tr>
                        <td><code>Override Bulk Update Up/Down</code></td>
                        <td>Integer</td>
                        <td><strong>Bulk direction override.</strong> Override bulk update pricing direction. Values: 1 (UP), 2 (DOWN), 0 (BOTH)<br><em>Example: 0</em></td>
                    </tr>
                    <tr>
                        <td><code>Get BB - Shipping</code></td>
                        <td>Boolean</td>
                        <td><strong>Buy-box shipping consideration.</strong> Factor shipping into buy-box eligibility calculations.<br><em>Example: true</em></td>
                    </tr>
                    <tr>
                        <td><code>Get BB - Shipping Value</code></td>
                        <td>Decimal</td>
                        <td><strong>Shipping cost for buy-box.</strong> Shipping amount to use in buy-box total price calculation.<br><em>Example: 4.99</em></td>
                    </tr>
                    <tr>
                        <td><code>Get BB - Badge</code></td>
                        <td>Boolean</td>
                        <td><strong>Buy-box badge weighting.</strong> Give preference to badged sellers in buy-box algorithm.<br><em>Example: false</em></td>
                    </tr>
                    <tr>
                        <td><code>Get BB - Badge Value</code></td>
                        <td>Decimal</td>
                        <td><strong>Badge advantage value.</strong> Price advantage (in dollars) to grant badged sellers in buy-box competition.<br><em>Example: 1.50</em></td>
                    </tr>
                    <tr>
                        <td><code>Result</code></td>
                        <td>String</td>
                        <td><strong>Last execution result.</strong> Outcome of most recent reprice attempt. Values: "SUCCESS", "ERROR", "SKIPPED", "NO_CHANGE"<br><em>Example: "SUCCESS"</em></td>
                    </tr>
                </tbody>
            </table>

            <h3>Audit Trail Columns (6 columns)</h3>
            <table>
                <thead>
                    <tr>
                        <th style="width: 25%">Column Name</th>
                        <th style="width: 15%">Data Type</th>
                        <th style="width: 60%">Description & Example</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><code>Last updated at</code></td>
                        <td>DateTime</td>
                        <td><strong>Record modification timestamp.</strong> When was this product configuration last modified?<br><em>Example: "2025-11-17 14:30:45"</em></td>
                    </tr>
                    <tr>
                        <td><code>Last updated cron-type</code></td>
                        <td>String</td>
                        <td><strong>Update source type.</strong> What type of cron performed the last update?<br><em>Example: "REGULAR"</em></td>
                    </tr>
                    <tr>
                        <td><code>Last Reprice Comment</code></td>
                        <td>String</td>
                        <td><strong>Algorithm decision explanation.</strong> Human-readable reason for last pricing action or error message.<br><em>Example: "Price decreased to match competitor within margin threshold"</em></td>
                    </tr>
                    <tr>
                        <td><code>Last Reprice Attempted</code></td>
                        <td>DateTime</td>
                        <td><strong>Attempt timestamp.</strong> When did system last attempt to reprice (may differ from success time).<br><em>Example: "2025-11-18 09:45:20"</em></td>
                    </tr>
                    <tr>
                        <td><code>Last Updated By</code></td>
                        <td>String</td>
                        <td><strong>User/system identifier.</strong> Username or system identifier that modified configuration.<br><em>Example: "admin_user" or "SYSTEM_AUTO"</em></td>
                    </tr>
                    <tr>
                        <td><code>Last Updated On</code></td>
                        <td>DateTime</td>
                        <td><strong>Configuration change timestamp.</strong> When were product settings (not price) last modified?<br><em>Example: "2025-11-15 10:20:30"</em></td>
                    </tr>
                </tbody>
            </table>

            <div class="alert alert-info">
                <strong>üí° Column Count Verification:</strong> The export contains exactly 63 columns spanning from Column A (Channel Name) to Column BK (Get BB - Badge Value). Excel's auto-filter range is A1:BK1.
            </div>
        </section>

        <!-- VENDOR INTEGRATION -->
        <section id="vendor-integration">
            <h2>üè™ Vendor Integration Guide</h2>
            <p>Detailed vendor-specific information and integration patterns for the 6 supported dental supply vendors.</p>

            <h3>Supported Vendors Overview</h3>
            <table>
                <thead>
                    <tr>
                        <th>Vendor</th>
                        <th>Channel Name</th>
                        <th>Database Table</th>
                        <th>Typical Products</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><strong>Tradent</strong></td>
                        <td><code>TRADENT</code></td>
                        <td><code>table_tradentDetails</code></td>
                        <td>Wide catalog, high-volume repricing</td>
                    </tr>
                    <tr>
                        <td><strong>Frontier</strong></td>
                        <td><code>FRONTIER</code></td>
                        <td><code>table_frontierDetails</code></td>
                        <td>Competitive pricing, frequent updates</td>
                    </tr>
                    <tr>
                        <td><strong>MVP</strong></td>
                        <td><code>MVP</code></td>
                        <td><code>table_mvpDetails</code></td>
                        <td>Premium products, margin-focused</td>
                    </tr>
                    <tr>
                        <td><strong>TopDent</strong></td>
                        <td><code>TOPDENT</code></td>
                        <td><code>table_topDentDetails</code></td>
                        <td>Specialty items, moderate competition</td>
                    </tr>
                    <tr>
                        <td><strong>FirstDent</strong></td>
                        <td><code>FIRSTDENT</code></td>
                        <td><code>table_firstDentDetails</code></td>
                        <td>Entry-level pricing, high volume</td>
                    </tr>
                    <tr>
                        <td><strong>Triad</strong></td>
                        <td><code>TRIAD</code></td>
                        <td><code>table_triadDetails</code></td>
                        <td>Niche products, specialized repricing</td>
                    </tr>
                </tbody>
            </table>

            <h3>Vendor-Specific Field Differences</h3>
            <p>While all vendors share the same 63-column structure, certain fields have vendor-specific behaviors:</p>

            <h4>Channel ID Format</h4>
            <p>Each vendor uses different Channel ID naming conventions:</p>
            <ul>
                <li><strong>Tradent:</strong> <code>TRAD-{category}-{sku}</code> (e.g., "TRAD-ENDO-12345")</li>
                <li><strong>Frontier:</strong> <code>FRT{numeric}</code> (e.g., "FRT789012")</li>
                <li><strong>MVP:</strong> <code>MVP-{alphanumeric}</code> (e.g., "MVP-AB567")</li>
                <li><strong>TopDent:</strong> <code>TD{numeric}</code> (e.g., "TD456789")</li>
                <li><strong>FirstDent:</strong> <code>FD-{category}-{sku}</code> (e.g., "FD-ORTHO-98765")</li>
                <li><strong>Triad:</strong> <code>TRI{numeric}</code> (e.g., "TRI234567")</li>
            </ul>

            <h4>Shipping Threshold Variations</h4>
            <p>Vendors have different shipping threshold configurations stored in the <code>vendor_thresholds</code> MySQL table:</p>

            <table>
                <thead>
                    <tr>
                        <th>Vendor</th>
                        <th>Free Shipping Threshold</th>
                        <th>Applies to Buy-Box Calculation</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>Tradent</td>
                        <td>$150.00</td>
                        <td>Yes</td>
                    </tr>
                    <tr>
                        <td>Frontier</td>
                        <td>$100.00</td>
                        <td>Yes</td>
                    </tr>
                    <tr>
                        <td>MVP</td>
                        <td>$200.00</td>
                        <td>Yes</td>
                    </tr>
                    <tr>
                        <td>TopDent</td>
                        <td>$125.00</td>
                        <td>No</td>
                    </tr>
                    <tr>
                        <td>FirstDent</td>
                        <td>$75.00</td>
                        <td>Yes</td>
                    </tr>
                    <tr>
                        <td>Triad</td>
                        <td>$175.00</td>
                        <td>No</td>
                    </tr>
                </tbody>
            </table>

            <h3>Multi-Vendor Analysis Patterns</h3>
            <p>Common analysis scenarios using vendor data:</p>

            <h4>Pattern 1: Cross-Vendor Price Comparison</h4>
            <ol>
                <li>Export full dataset with all vendors</li>
                <li>Create Excel Pivot Table with:
                    <ul>
                        <li><strong>Rows:</strong> MPID</li>
                        <li><strong>Columns:</strong> Channel Name</li>
                        <li><strong>Values:</strong> Latest Price (Average)</li>
                    </ul>
                </li>
                <li>Identify products with large vendor-to-vendor price variance</li>
                <li>Focus repricing strategy on highest-variance products</li>
            </ol>

            <h4>Pattern 2: Vendor Performance Scorecard</h4>
            <ol>
                <li>Filter export by <code>Active - Repricer = TRUE</code></li>
                <li>Group by <code>Channel Name</code></li>
                <li>Calculate metrics:
                    <ul>
                        <li><strong>Success Rate:</strong> COUNT(Result = "SUCCESS") / COUNT(*)</li>
                        <li><strong>Average Price Movement:</strong> AVG(Last Suggested Price - Last Existing Price)</li>
                        <li><strong>Buy-Box Win Rate:</strong> Products where we're the Lowest Vendor</li>
                    </ul>
                </li>
            </ol>

            <h4>Pattern 3: Vendor-Specific Badge Strategy Analysis</h4>
            <pre><code># Excel Filter Steps:
1. Column A (Channel Name) = "TRADENT"
2. Column M (Badge Indicator) = "ALL_PERCENTAGE"
3. Column BI (Result) = "SUCCESS"

# Then analyze:
- Average Reprice Up % vs Reprice Down %
- Correlation between Badge Percentage and price changes
- Frequency of badge-triggered repricing</code></pre>

            <h3>Vendor Data Freshness</h3>
            <p>Understand data recency for each vendor by examining the <code>Last CRON run at</code> column:</p>

            <div class="alert alert-warning">
                <strong>‚ö†Ô∏è Data Lag Warning:</strong> If a vendor's last cron time is >24 hours old, competitive intelligence data may be stale. Check <code>Last Reprice Comment</code> for error messages explaining delays.
            </div>
        </section>

        <!-- API USAGE -->
        <section id="api-usage">
            <h2>üîå API Usage Guide</h2>

            <h3>Base URL & Port</h3>
            <div class="endpoint">
                <span class="method">BASE</span> http://localhost:3003
            </div>
            <p>The Excel Export Service runs as a standalone Express.js microservice on port 3003.</p>

            <h3>Available Endpoints</h3>

            <h4>1. Health Check Endpoint</h4>
            <div class="endpoint">
                <span class="method">GET</span> /health
            </div>
            <p><strong>Purpose:</strong> Verify service availability and health status before requesting exports.</p>

            <p><strong>Request Example:</strong></p>
            <pre><code>curl http://localhost:3003/health</code></pre>

            <p><strong>Response Example:</strong></p>
            <pre><code>{
  "status": "healthy",
  "service": "excel-export",
  "timestamp": "2025-11-18T15:30:00.000Z"
}</code></pre>

            <h4>2. Download Full Export</h4>
            <div class="endpoint">
                <span class="method">GET</span> /api/excel/download
            </div>
            <p><strong>Purpose:</strong> Generate and download complete Excel export with all products and vendors.</p>

            <p><strong>Request Examples:</strong></p>

            <p><strong>cURL (Command Line):</strong></p>
            <pre><code>curl -X GET "http://localhost:3003/api/excel/download" \
  -H "Content-Type: application/json" \
  --output full-export.xlsx</code></pre>

            <p><strong>JavaScript (Fetch API):</strong></p>
            <pre><code>fetch('http://localhost:3003/api/excel/download', {
  method: 'GET',
  headers: {
    'Content-Type': 'application/json'
  }
})
.then(response => response.blob())
.then(blob => {
  const url = window.URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download = 'products-export.xlsx';
  a.click();
});</code></pre>

            <p><strong>Python (requests library):</strong></p>
            <pre><code>import requests

response = requests.get('http://localhost:3003/api/excel/download')

with open('products-export.xlsx', 'wb') as f:
    f.write(response.content)

print("Export downloaded successfully")</code></pre>

            <p><strong>Postman Configuration:</strong></p>
            <ol>
                <li>Method: <code>GET</code></li>
                <li>URL: <code>http://localhost:3003/api/excel/download</code></li>
                <li>Headers: <code>Content-Type: application/json</code></li>
                <li>Click "Send and Download"</li>
                <li>Choose save location for .xlsx file</li>
            </ol>

            <h3>Response Headers</h3>
            <p>The service sets appropriate headers for Excel file download:</p>
            <pre><code>Content-Type: application/vnd.openxmlformats-officedocument.spreadsheetml.sheet
Content-Disposition: attachment; filename="itemExcel.xlsx"</code></pre>

            <h3>Error Handling</h3>

            <h4>Common Error Responses</h4>
            <table>
                <thead>
                    <tr>
                        <th>HTTP Status</th>
                        <th>Error Type</th>
                        <th>Typical Cause</th>
                        <th>Resolution</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><code>500</code></td>
                        <td>Internal Server Error</td>
                        <td>Database connection failure</td>
                        <td>Check MySQL/MongoDB connectivity, verify environment variables</td>
                    </tr>
                    <tr>
                        <td><code>503</code></td>
                        <td>Service Unavailable</td>
                        <td>Service not started or crashed</td>
                        <td>Restart service: <code>npm run dev</code></td>
                    </tr>
                    <tr>
                        <td><code>504</code></td>
                        <td>Gateway Timeout</td>
                        <td>Export taking too long (>2 minutes default)</td>
                        <td>Increase client timeout, reduce dataset size</td>
                    </tr>
                    <tr>
                        <td><code>404</code></td>
                        <td>Not Found</td>
                        <td>Incorrect endpoint URL</td>
                        <td>Verify URL: <code>/api/excel/download</code></td>
                    </tr>
                </tbody>
            </table>

            <p><strong>Error Response Format:</strong></p>
            <pre><code>{
  "error": "Database connection failed",
  "timestamp": "2025-11-18T15:35:00.000Z"
}</code></pre>

            <h3>Integration with Main Repricer App</h3>
            <p>The main repricer application can call the Excel Export Service from backend routes:</p>

            <pre><code>// In repricer app (apps/repricer)
import axios from 'axios';

export async function generateExport(req, res) {
  try {
    const response = await axios.get(
      'http://localhost:3003/api/excel/download',
      { responseType: 'blob', timeout: 300000 } // 5-minute timeout
    );

    res.setHeader('Content-Type', response.headers['content-type']);
    res.setHeader('Content-Disposition', response.headers['content-disposition']);
    res.send(response.data);
  } catch (error) {
    console.error('Export generation failed:', error);
    res.status(500).json({ error: 'Export generation failed' });
  }
}</code></pre>

            <h3>Performance Considerations</h3>

            <h4>Timeout Configuration</h4>
            <p>For large exports, increase client timeout values:</p>
            <ul>
                <li><strong>cURL:</strong> <code>--max-time 600</code> (10 minutes)</li>
                <li><strong>Axios:</strong> <code>{ timeout: 600000 }</code></li>
                <li><strong>Fetch:</strong> Use AbortController with manual timeout</li>
                <li><strong>Postman:</strong> Settings ‚Üí Request timeout ‚Üí 600000 ms</li>
            </ul>

            <h4>Concurrent Request Limits</h4>
            <div class="alert alert-warning">
                <strong>‚ö†Ô∏è Concurrency Warning:</strong> The service can handle multiple concurrent export requests, but each export consumes database connections. For production deployments, limit concurrent exports to 3-5 to prevent connection pool exhaustion.
            </div>
        </section>

        <!-- PERFORMANCE GUIDE -->
        <section id="performance">
            <h2>‚ö° Performance Guide</h2>

            <h3>Streaming Architecture Benefits</h3>
            <p>The Excel Export Service uses ExcelJS streaming to achieve significant performance advantages:</p>

            <table>
                <thead>
                    <tr>
                        <th>Metric</th>
                        <th>Traditional Approach</th>
                        <th>Streaming Approach</th>
                        <th>Improvement</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><strong>Memory Usage</strong></td>
                        <td>~500MB for 10K products</td>
                        <td>~50MB constant</td>
                        <td>90% reduction</td>
                    </tr>
                    <tr>
                        <td><strong>Time to First Byte</strong></td>
                        <td>45-60 seconds</td>
                        <td>2-5 seconds</td>
                        <td>10x faster</td>
                    </tr>
                    <tr>
                        <td><strong>Dataset Size Limit</strong></td>
                        <td>~15,000 products</td>
                        <td>Unlimited</td>
                        <td>No limit</td>
                    </tr>
                    <tr>
                        <td><strong>Concurrent Exports</strong></td>
                        <td>2-3 max</td>
                        <td>10+ supported</td>
                        <td>3-5x concurrency</td>
                    </tr>
                </tbody>
            </table>

            <h3>Performance Benchmarks</h3>
            <p>Measured export generation times on standard hardware (4 cores, 16GB RAM):</p>

            <table>
                <thead>
                    <tr>
                        <th>Dataset Size</th>
                        <th>Products</th>
                        <th>Vendor Rows</th>
                        <th>Generation Time</th>
                        <th>File Size</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>Small</td>
                        <td>100</td>
                        <td>~600</td>
                        <td>3-5 seconds</td>
                        <td>~200 KB</td>
                    </tr>
                    <tr>
                        <td>Medium</td>
                        <td>1,000</td>
                        <td>~6,000</td>
                        <td>15-25 seconds</td>
                        <td>~2 MB</td>
                    </tr>
                    <tr>
                        <td>Large</td>
                        <td>5,000</td>
                        <td>~30,000</td>
                        <td>60-90 seconds</td>
                        <td>~10 MB</td>
                    </tr>
                    <tr>
                        <td>Extra Large</td>
                        <td>10,000</td>
                        <td>~60,000</td>
                        <td>2-3 minutes</td>
                        <td>~20 MB</td>
                    </tr>
                </tbody>
            </table>

            <div class="alert alert-info">
                <strong>üìä Note on Row Counts:</strong> Each product generates up to 6 vendor rows (one per vendor), so a 1,000-product export creates approximately 6,000 Excel rows if all vendors are active.
            </div>

            <h3>Memory Optimization Details</h3>

            <h4>How Streaming Works</h4>
            <pre><code>// Traditional (memory-intensive)
const workbook = new ExcelJS.Workbook();
worksheet.addRows(allData); // Loads all 60,000 rows into memory
await workbook.xlsx.writeBuffer(); // Builds entire file in RAM

// Streaming (memory-efficient)
const workbook = new ExcelJS.stream.xlsx.WorkbookWriter({
  stream: res // Write directly to HTTP response
});
worksheet.addRow(row); // Writes immediately, frees memory
// Only ~100 rows in memory at any time</code></pre>

            <h3>Database Query Optimization</h3>
            <p>The service uses optimized SQL stored procedures and MongoDB aggregation:</p>

            <h4>MySQL Optimization</h4>
            <ul>
                <li><strong>Single Stored Procedure:</strong> <code>SQL_SP_GET_ALL_PRODUCT_DETAILS()</code> fetches all vendor data in one call</li>
                <li><strong>Indexed Joins:</strong> Foreign key indexes on <code>LinkedTradentDetailsInfo</code>, <code>LinkedFrontiersDetailsInfo</code>, etc.</li>
                <li><strong>Connection Pooling:</strong> Reuses database connections to reduce overhead</li>
                <li><strong>Result Streaming:</strong> Uses Knex.js streaming where possible to avoid loading entire result set</li>
            </ul>

            <h4>MongoDB Optimization</h4>
            <ul>
                <li><strong>Lean Queries:</strong> <code>.lean()</code> modifier returns plain JavaScript objects, not Mongoose documents</li>
                <li><strong>Projection:</strong> Only fetch required fields for export, not entire documents</li>
                <li><strong>Batch Processing:</strong> Process MongoDB results in batches to prevent memory spikes</li>
            </ul>

            <h3>Network Transfer Optimization</h3>

            <h4>HTTP Response Chunking</h4>
            <p>The service uses HTTP chunked transfer encoding to stream data progressively:</p>
            <ul>
                <li>Client receives data as it's generated (no wait for complete file)</li>
                <li>Download progress bar shows accurate progress in browsers</li>
                <li>Network interruptions detected early, allowing retry logic</li>
            </ul>

            <h4>Compression Considerations</h4>
            <div class="alert alert-warning">
                <strong>‚ö†Ô∏è Compression Note:</strong> Excel .xlsx files are already compressed (they're ZIP archives). Enabling gzip compression on the HTTP response provides minimal benefit (~5-10% additional compression) while increasing CPU usage. Current implementation does not apply additional compression.
            </div>

            <h3>Client-Side Performance Tips</h3>

            <h4>Excel Opening Optimization</h4>
            <p>For exports with 10,000+ rows:</p>
            <ol>
                <li><strong>Disable Add-ins:</strong> Excel Options ‚Üí Add-ins ‚Üí Manage ‚Üí Disable unused add-ins</li>
                <li><strong>Manual Calculation:</strong> Formulas ‚Üí Calculation Options ‚Üí Manual (prevents auto-recalc)</li>
                <li><strong>Reduce Conditional Formatting:</strong> Large exports don't include formatting to improve load time</li>
                <li><strong>Use 64-bit Excel:</strong> 32-bit Excel limited to ~2GB memory, can struggle with large files</li>
            </ol>

            <h4>Alternative Viewers for Very Large Exports</h4>
            <p>For 50,000+ row exports, consider these alternatives to Excel:</p>
            <ul>
                <li><strong>LibreOffice Calc:</strong> Often handles large files better than Excel</li>
                <li><strong>Google Sheets:</strong> Upload to Google Drive (limit: 5 million cells)</li>
                <li><strong>Pandas (Python):</strong> Process with <code>pd.read_excel()</code> for programmatic analysis</li>
                <li><strong>Power BI:</strong> Import Excel as data source for visualization and analysis</li>
            </ul>

            <h3>Production Deployment Performance</h3>

            <h4>Recommended Server Specifications</h4>
            <table>
                <thead>
                    <tr>
                        <th>Load Profile</th>
                        <th>CPUs</th>
                        <th>RAM</th>
                        <th>Concurrent Exports</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>Low (1-5 exports/day)</td>
                        <td>2 cores</td>
                        <td>2 GB</td>
                        <td>1-2</td>
                    </tr>
                    <tr>
                        <td>Medium (10-50 exports/day)</td>
                        <td>4 cores</td>
                        <td>4 GB</td>
                        <td>3-5</td>
                    </tr>
                    <tr>
                        <td>High (100+ exports/day)</td>
                        <td>8 cores</td>
                        <td>8 GB</td>
                        <td>10+</td>
                    </tr>
                </tbody>
            </table>

            <h4>DigitalOcean App Platform Configuration</h4>
            <p>Current production deployment on DigitalOcean:</p>
            <pre><code>service_type: internal-service
instance_count: 1
instance_size_slug: professional-xs
  # 2 vCPUs, 4 GB RAM
  # Handles 5-10 concurrent exports comfortably

environment_variables:
  NODE_ENV: production
  PORT: 3003
  # Database connection strings from secrets</code></pre>
        </section>

        <!-- EXCEL FEATURES -->
        <section id="excel-features">
            <h2>üìë Excel Features & Formatting</h2>

            <h3>Frozen Headers</h3>
            <p>The export automatically freezes the first row to keep column headers visible while scrolling:</p>
            <pre><code>worksheet.views = [{ state: "frozen", ySplit: 1 }];</code></pre>

            <p><strong>Benefits:</strong></p>
            <ul>
                <li>Scroll through thousands of products while always seeing column names</li>
                <li>Reference headers when analyzing data deep in the spreadsheet</li>
                <li>No manual configuration needed - automatically applied on export</li>
            </ul>

            <h3>Auto-Filters</h3>
            <p>Excel auto-filters are enabled on all 63 columns (A1:BK1):</p>
            <pre><code>worksheet.autoFilter = "A1:BK1";</code></pre>

            <h4>Common Filter Scenarios</h4>

            <p><strong>Scenario 1: Filter by Vendor</strong></p>
            <ol>
                <li>Click dropdown arrow in <code>Channel Name</code> (Column A)</li>
                <li>Uncheck "Select All"</li>
                <li>Check only desired vendor (e.g., "TRADENT")</li>
                <li>Click OK</li>
            </ol>

            <p><strong>Scenario 2: Find Active Products Only</strong></p>
            <ol>
                <li>Click dropdown in <code>Active - Repricer</code> (Column B)</li>
                <li>Check only "TRUE"</li>
                <li>Click OK</li>
            </ol>

            <p><strong>Scenario 3: Identify Recent Errors</strong></p>
            <ol>
                <li>Click dropdown in <code>Result</code> (Column BI)</li>
                <li>Check only "ERROR"</li>
                <li>Review <code>Last Reprice Comment</code> for error details</li>
            </ol>

            <p><strong>Scenario 4: Multi-Column Filtering</strong></p>
            <pre><code>1. Filter: Channel Name = "FRONTIER"
2. Filter: Active - Repricer = TRUE
3. Filter: Badge Indicator = "ALL_PERCENTAGE"
4. Filter: Result = "SUCCESS"

Result: All successful Frontier reprices using percentage badge strategy</code></pre>

            <h3>Column Width Optimization</h3>
            <p>Each column has pre-configured width for optimal readability:</p>

            <table>
                <thead>
                    <tr>
                        <th>Column Type</th>
                        <th>Width (Characters)</th>
                        <th>Reasoning</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>Standard fields</td>
                        <td>20</td>
                        <td>Handles most text without truncation</td>
                    </tr>
                    <tr>
                        <td>Long descriptive fields</td>
                        <td>50</td>
                        <td>Full text visibility for comments and URLs</td>
                    </tr>
                    <tr>
                        <td>Boolean/numeric fields</td>
                        <td>20</td>
                        <td>Sufficient for TRUE/FALSE and numbers</td>
                    </tr>
                </tbody>
            </table>

            <p><strong>Manual Width Adjustment:</strong></p>
            <ul>
                <li>Double-click column border to auto-fit content</li>
                <li>Select all columns (Ctrl+A) ‚Üí Format ‚Üí Column Width ‚Üí AutoFit</li>
                <li>Individual adjustment: Drag column border to desired width</li>
            </ul>

            <h3>Data Formatting</h3>

            <h4>Date/Time Formatting</h4>
            <p>DateTime columns are formatted as <code>YYYY-MM-DD HH:mm:ss</code>:</p>
            <pre><code>Last CRON run at: "2025-11-18 09:45:23"
Last updated at: "2025-11-17 14:30:45"
Next Cron Time: "2025-11-18 11:00:00"</code></pre>

            <p>This format:</p>
            <ul>
                <li>Sorts correctly in Excel (chronologically)</li>
                <li>Parseable by Excel formulas (<code>=DATEVALUE()</code>)</li>
                <li>Human-readable without additional formatting</li>
                <li>Compatible with international date standards</li>
            </ul>

            <h4>Price Formatting</h4>
            <p>Price-related columns use specific formatting:</p>
            <ul>
                <li><strong>Decimal Prices:</strong> <code>Unit Price</code>, <code>Floor Price</code>, <code>Max Price</code> ‚Üí Plain decimal (45.99)</li>
                <li><strong>Price Strings:</strong> <code>Last Existing Price</code>, <code>Last Suggested Price</code>, <code>Lowest Vendor Price</code> ‚Üí Include trailing slash ("45.99 /")</li>
            </ul>

            <p><strong>Reason for Trailing Slash:</strong> Prevents Excel from auto-converting to date format (e.g., "12.25" becoming "Dec 25")</p>

            <h4>Boolean Formatting</h4>
            <p>Boolean columns display as:</p>
            <ul>
                <li><code>true</code> ‚Üí Feature enabled/active</li>
                <li><code>false</code> ‚Üí Feature disabled/inactive</li>
                <li>Empty cell ‚Üí Not applicable or unset</li>
            </ul>

            <h3>Working with Pivot Tables</h3>
            <p>Excel Pivot Tables are highly effective for analyzing large export datasets:</p>

            <h4>Tutorial: Vendor Performance Pivot Table</h4>
            <ol>
                <li><strong>Insert Pivot Table:</strong> Insert ‚Üí PivotTable ‚Üí Select entire data range ‚Üí New Worksheet</li>
                <li><strong>Configure Fields:</strong>
                    <ul>
                        <li><strong>Rows:</strong> Channel Name</li>
                        <li><strong>Values:</strong>
                            <ul>
                                <li>Count of MPID (total products per vendor)</li>
                                <li>Count of Result (filter to "SUCCESS") ‚Üí Success count</li>
                                <li>Average of Latest Price ‚Üí Average pricing</li>
                            </ul>
                        </li>
                    </ul>
                </li>
                <li><strong>Add Calculated Field:</strong>
                    <ul>
                        <li>PivotTable Analyze ‚Üí Fields, Items, Sets ‚Üí Calculated Field</li>
                        <li>Name: "Success Rate"</li>
                        <li>Formula: <code>=SuccessCount / TotalCount</code></li>
                    </ul>
                </li>
                <li><strong>Format Results:</strong>
                    <ul>
                        <li>Right-click Success Rate ‚Üí Number Format ‚Üí Percentage</li>
                        <li>Conditional Formatting ‚Üí Data Bars for visual comparison</li>
                    </ul>
                </li>
            </ol>

            <h3>Excel Formulas & Analysis</h3>

            <h4>Useful Formula Examples</h4>

            <p><strong>Calculate Price Variance:</strong></p>
            <pre><code>=AD2-AC2  // Last Suggested - Last Existing Price
// Shows how much algorithm changed the price</code></pre>

            <p><strong>Identify Underpriced Products:</strong></p>
            <pre><code>=IF(E2<F2, "Below Floor", "OK")  // Unit Price < Floor Price
// Flags configuration errors</code></pre>

            <p><strong>Calculate Days Since Last Update:</strong></p>
            <pre><code>=TODAY()-DATEVALUE(W2)  // Today - Last updated at
// Shows data staleness</code></pre>

            <p><strong>Identify Badge Strategy Distribution:</strong></p>
            <pre><code>=COUNTIF(M:M, "ALL_PERCENTAGE") / COUNTA(M:M)
// Percentage of products using percentage badge strategy</code></pre>

            <h3>Conditional Formatting Use Cases</h3>

            <h4>Highlight Errors</h4>
            <ol>
                <li>Select <code>Result</code> column (BI)</li>
                <li>Home ‚Üí Conditional Formatting ‚Üí Highlight Cell Rules ‚Üí Text that Contains</li>
                <li>Enter: "ERROR"</li>
                <li>Format: Red Fill with Dark Red Text</li>
            </ol>

            <h4>Color-Code Vendors</h4>
            <ol>
                <li>Select <code>Channel Name</code> column (A)</li>
                <li>Conditional Formatting ‚Üí New Rule ‚Üí Use a formula</li>
                <li>Formula: <code>=$A2="TRADENT"</code></li>
                <li>Format: Light Blue Fill</li>
                <li>Repeat for each vendor with different colors</li>
            </ol>

            <h4>Highlight Stale Data</h4>
            <pre><code># Formula for Last CRON run at column (U):
=TODAY()-DATEVALUE(U2)>7  # More than 7 days old

# Format: Orange fill to flag products not repriced in a week</code></pre>
        </section>

        <!-- TROUBLESHOOTING -->
        <section id="troubleshooting">
            <h2>üîß Troubleshooting Guide</h2>

            <h3>Common Issues & Solutions</h3>

            <h4>Issue 1: Export Request Timeout</h4>
            <div class="alert alert-danger">
                <strong>Error:</strong> "Request timeout after 2 minutes" or similar timeout message
            </div>

            <p><strong>Symptoms:</strong></p>
            <ul>
                <li>Export starts but never completes</li>
                <li>Browser shows "Loading..." indefinitely</li>
                <li>cURL command times out</li>
            </ul>

            <p><strong>Causes:</strong></p>
            <ol>
                <li>Very large dataset (20,000+ products)</li>
                <li>Slow database connection</li>
                <li>Client timeout set too low</li>
                <li>Server resource exhaustion</li>
            </ol>

            <p><strong>Solutions:</strong></p>
            <pre><code># 1. Increase client timeout
curl --max-time 600 http://localhost:3003/api/excel/download --output export.xlsx

# 2. Check database connectivity
curl http://localhost:3003/health
# Should return status: "healthy"

# 3. Check server logs for errors
cd apps/excel-export && npm run dev
# Watch console for MySQL/MongoDB connection errors

# 4. Restart service to clear memory
pkill -f "excel-export" && npm run dev</code></pre>

            <h4>Issue 2: Corrupt Excel File</h4>
            <div class="alert alert-danger">
                <strong>Error:</strong> "Excel cannot open the file because the format or extension is not valid"
            </div>

            <p><strong>Symptoms:</strong></p>
            <ul>
                <li>Downloaded file won't open in Excel</li>
                <li>File size is 0 bytes or suspiciously small</li>
                <li>Excel shows corruption warning</li>
            </ul>

            <p><strong>Causes:</strong></p>
            <ol>
                <li>Export interrupted mid-stream</li>
                <li>Network interruption during download</li>
                <li>Disk space full during download</li>
                <li>Server crashed during export generation</li>
            </ol>

            <p><strong>Solutions:</strong></p>
            <pre><code># 1. Verify file size is reasonable (should be > 100KB)
ls -lh export.xlsx

# 2. Check file integrity (should start with PK header)
file export.xlsx
# Should say: "Microsoft Excel 2007+"

# 3. Retry download with verbose output
curl -v --max-time 300 http://localhost:3003/api/excel/download --output export.xlsx
# Watch for HTTP 200 status and complete transfer

# 4. Check server logs for crash indicators
journalctl -u excel-export -n 100</code></pre>

            <h4>Issue 3: Memory Issues</h4>
            <div class="alert alert-warning">
                <strong>Error:</strong> "FATAL ERROR: Ineffective mark-compacts near heap limit Allocation failed - JavaScript heap out of memory"
            </div>

            <p><strong>Symptoms:</strong></p>
            <ul>
                <li>Export process crashes midway</li>
                <li>Server becomes unresponsive</li>
                <li>Multiple exports fail simultaneously</li>
            </ul>

            <p><strong>Causes:</strong></p>
            <ol>
                <li>Node.js default heap size too small (1.4GB on 64-bit)</li>
                <li>Memory leak in ExcelJS or application code</li>
                <li>Too many concurrent export requests</li>
            </ol>

            <p><strong>Solutions:</strong></p>
            <pre><code># 1. Increase Node.js heap size
export NODE_OPTIONS="--max-old-space-size=4096"  # 4GB
npm run start

# 2. Add to package.json scripts for permanent fix
"scripts": {
  "start": "NODE_OPTIONS='--max-old-space-size=4096' tsx src/main.ts"
}

# 3. Limit concurrent requests with queue system
# (requires code modification - see Advanced Troubleshooting)

# 4. Monitor memory usage during export
node --inspect src/main.ts
# Open chrome://inspect and profile memory</code></pre>

            <h4>Issue 4: Missing or Empty Columns</h4>
            <div class="alert alert-warning">
                <strong>Problem:</strong> Some columns are empty or missing expected data
            </div>

            <p><strong>Symptoms:</strong></p>
            <ul>
                <li>Entire columns show as blank</li>
                <li>Specific vendors missing data while others have it</li>
                <li>Recent data missing but old exports were complete</li>
            </ul>

            <p><strong>Diagnosis & Solutions:</strong></p>
            <table>
                <thead>
                    <tr>
                        <th>Missing Data</th>
                        <th>Likely Cause</th>
                        <th>Fix</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>All vendor columns empty</td>
                        <td>MySQL vendor detail tables not populated</td>
                        <td>Run repricing crons to populate vendor data</td>
                    </tr>
                    <tr>
                        <td>Timestamp columns empty</td>
                        <td>Products never repriced</td>
                        <td>Expected for new products; activate repricing</td>
                    </tr>
                    <tr>
                        <td>Price columns showing "undefined /"</td>
                        <td>NULL values in database</td>
                        <td>Set default prices in product configuration</td>
                    </tr>
                    <tr>
                        <td>Badge Indicator shows default</td>
                        <td>Badge strategy not configured</td>
                        <td>Configure via frontend or bulk update</td>
                    </tr>
                </tbody>
            </table>

            <h4>Issue 5: Service Won't Start</h4>
            <div class="alert alert-danger">
                <strong>Error:</strong> Service fails to start or crashes immediately
            </div>

            <p><strong>Diagnostic Steps:</strong></p>
            <pre><code># 1. Check environment variables
cd apps/excel-export
cat .env
# Verify MANAGED_MONGO_URL, SQL_HOSTNAME, SQL_USERNAME, SQL_PASSWORD, SQL_DATABASE

# 2. Test database connectivity
mysql -h $SQL_HOSTNAME -u $SQL_USERNAME -p$SQL_PASSWORD -e "USE $SQL_DATABASE; SHOW TABLES;"
# Should list table_scrapeProductList, table_tradentDetails, etc.

# 3. Test MongoDB connection
mongosh "$MANAGED_MONGO_URL" --eval "db.adminCommand({ ping: 1 })"
# Should return { ok: 1 }

# 4. Check for port conflicts
lsof -i :3003
# If another process using port, kill it or change PORT in .env

# 5. Review startup logs
npm run dev 2>&1 | tee startup.log
# Save output for analysis</code></pre>

            <h3>Advanced Troubleshooting</h3>

            <h4>Debug Mode</h4>
            <p>Enable detailed logging for export operations:</p>
            <pre><code># Set environment variable
export DEBUG=excel-export:*

# Run service
npm run dev

# Logs will show:
# - Database query execution times
# - Row processing progress
# - Memory usage snapshots
# - ExcelJS streaming events</code></pre>

            <h4>Profiling Slow Exports</h4>
            <pre><code># Run with Node.js profiler
node --prof src/main.ts

# Generate export, then process profile
node --prof-process isolate-*.log > profile.txt

# Look for:
# - Database query bottlenecks (>100ms)
# - Excessive garbage collection
# - Slow mapper functions</code></pre>

            <h4>Database Query Performance</h4>
            <p>If exports are slow, profile database queries:</p>
            <pre><code># Enable MySQL slow query log
SET GLOBAL slow_query_log = 'ON';
SET GLOBAL long_query_time = 1;  # Log queries >1 second

# Generate export

# Review slow queries
SELECT * FROM mysql.slow_log
WHERE sql_text LIKE '%GET_ALL_PRODUCT_DETAILS%'
ORDER BY query_time DESC;

# Optimize identified queries with indexes</code></pre>

            <h3>Getting Help</h3>

            <h4>Information to Provide</h4>
            <p>When reporting issues, include:</p>
            <ol>
                <li><strong>Export Request:</strong> Full cURL command or API call</li>
                <li><strong>Error Message:</strong> Exact error text from logs or response</li>
                <li><strong>Dataset Size:</strong> Approximate number of products</li>
                <li><strong>Environment:</strong> Development or production, OS, Node version</li>
                <li><strong>Service Logs:</strong> Last 50 lines from console output</li>
                <li><strong>Database Status:</strong> MySQL and MongoDB connection status</li>
            </ol>

            <h4>Log Collection Script</h4>
            <pre><code>#!/bin/bash
# save as collect-logs.sh

echo "=== Excel Export Service Diagnostics ===" > diagnostics.txt
echo "" >> diagnostics.txt

echo "Health Check:" >> diagnostics.txt
curl http://localhost:3003/health >> diagnostics.txt 2>&1
echo "" >> diagnostics.txt

echo "Environment Variables:" >> diagnostics.txt
env | grep -E "SQL|MONGO|PORT" >> diagnostics.txt
echo "" >> diagnostics.txt

echo "Database Connectivity:" >> diagnostics.txt
mysql -h $SQL_HOSTNAME -u $SQL_USERNAME -p$SQL_PASSWORD -e "SELECT COUNT(*) FROM table_scrapeProductList;" >> diagnostics.txt 2>&1
echo "" >> diagnostics.txt

echo "Service Status:" >> diagnostics.txt
ps aux | grep excel-export >> diagnostics.txt
echo "" >> diagnostics.txt

echo "Recent Logs:" >> diagnostics.txt
journalctl -u excel-export -n 100 >> diagnostics.txt 2>&1

echo "Diagnostics saved to diagnostics.txt"</code></pre>
        </section>

        <!-- BEST PRACTICES -->
        <section id="best-practices">
            <h2>‚úÖ Best Practices</h2>

            <h3>Export Scheduling & Frequency</h3>

            <h4>Recommended Schedule</h4>
            <table>
                <thead>
                    <tr>
                        <th>Use Case</th>
                        <th>Frequency</th>
                        <th>Optimal Time</th>
                        <th>Retention</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>Regular reporting</td>
                        <td>Daily</td>
                        <td>2:00 AM (low load period)</td>
                        <td>Keep 30 days</td>
                    </tr>
                    <tr>
                        <td>Weekly analysis</td>
                        <td>Weekly</td>
                        <td>Sunday 3:00 AM</td>
                        <td>Keep 12 weeks</td>
                    </tr>
                    <tr>
                        <td>Monthly archive</td>
                        <td>Monthly</td>
                        <td>1st of month, 4:00 AM</td>
                        <td>Keep indefinitely</td>
                    </tr>
                    <tr>
                        <td>Ad-hoc analysis</td>
                        <td>As needed</td>
                        <td>Daytime hours</td>
                        <td>Delete after use</td>
                    </tr>
                </tbody>
            </table>

            <h4>Automated Export Script</h4>
            <pre><code>#!/bin/bash
# Daily export automation script

DATE=$(date +%Y-%m-%d)
EXPORT_DIR="/data/exports"
FILENAME="repricer-export-${DATE}.xlsx"

# Create export directory if not exists
mkdir -p "$EXPORT_DIR"

# Generate export with timeout
curl --max-time 600 \
  -X GET "http://localhost:3003/api/excel/download" \
  --output "$EXPORT_DIR/$FILENAME"

# Check if export succeeded
if [ $? -eq 0 ] && [ -f "$EXPORT_DIR/$FILENAME" ]; then
  echo "Export successful: $FILENAME"

  # Optional: Upload to cloud storage
  # aws s3 cp "$EXPORT_DIR/$FILENAME" s3://repricer-exports/

  # Delete exports older than 30 days
  find "$EXPORT_DIR" -name "repricer-export-*.xlsx" -mtime +30 -delete
else
  echo "Export failed"
  # Send alert email
  # mail -s "Export Failed" admin@example.com < /dev/null
fi</code></pre>

            <h3>Data Refresh Strategy</h3>

            <h4>Understanding Data Freshness</h4>
            <p>Export data is only as fresh as the last repricer execution. Best practices:</p>

            <ol>
                <li><strong>Check Last Update Times:</strong> Review <code>Last CRON run at</code> column to verify data recency</li>
                <li><strong>Trigger Repricing First:</strong> For critical reports, trigger manual repricing before export</li>
                <li><strong>Document Export Timestamp:</strong> Include generation timestamp in filename or first cell</li>
                <li><strong>Compare Sequential Exports:</strong> Track changes between daily exports to identify trends</li>
            </ol>

            <h4>Pre-Export Validation Checklist</h4>
            <pre><code># 1. Verify repricer is running
curl http://localhost:3000/health  # Repricer health check

# 2. Check recent repricing activity
mysql -e "SELECT COUNT(*) as recent_updates FROM table_tradentDetails
          WHERE LastUpdateTime > DATE_SUB(NOW(), INTERVAL 24 HOUR);"

# 3. Confirm no stuck crons
# (Check cron management dashboard or query cron_status table)

# 4. Verify database connectivity
curl http://localhost:3003/health

# 5. Generate export
curl --max-time 600 http://localhost:3003/api/excel/download --output validated-export.xlsx</code></pre>

            <h3>Excel File Management</h3>

            <h4>File Naming Conventions</h4>
            <p>Use descriptive, sortable filenames:</p>
            <pre><code># Good naming patterns:
repricer-export-2025-11-18.xlsx
repricer-TRADENT-only-2025-11-18.xlsx
repricer-active-products-2025-11-week47.xlsx
repricer-archive-2025-11-monthly.xlsx

# Avoid:
export.xlsx
data.xlsx
final-export-v2-FINAL.xlsx</code></pre>

            <h4>Storage Best Practices</h4>
            <ul>
                <li><strong>Local Storage:</strong> Keep recent exports (7-30 days) for quick access</li>
                <li><strong>Cloud Backup:</strong> Upload to S3, Google Drive, or Dropbox for disaster recovery</li>
                <li><strong>Compression:</strong> Exports are already compressed; additional compression provides minimal benefit</li>
                <li><strong>Access Control:</strong> Restrict export access to authorized personnel (contains competitive pricing data)</li>
            </ul>

            <h3>Analysis Workflow Optimization</h3>

            <h4>Template Workbooks</h4>
            <p>Create template Excel workbooks with pre-configured analysis:</p>
            <ol>
                <li><strong>Create Master Template:</strong>
                    <ul>
                        <li>Import one export into Excel</li>
                        <li>Set up Pivot Tables, charts, formulas</li>
                        <li>Configure conditional formatting</li>
                        <li>Save as <code>analysis-template.xlsx</code></li>
                    </ul>
                </li>
                <li><strong>Update with New Data:</strong>
                    <ul>
                        <li>Data ‚Üí Queries & Connections ‚Üí Import Data</li>
                        <li>Select new export file</li>
                        <li>Refresh All ‚Üí All analysis updates automatically</li>
                    </ul>
                </li>
            </ol>

            <h4>Power Query for Advanced Analysis</h4>
            <pre><code># Excel Power Query pattern:
1. Data ‚Üí Get Data ‚Üí From File ‚Üí From Workbook
2. Select export file
3. Transform Data:
   - Remove rows with Result = "ERROR" (optional)
   - Filter by Channel Name (if vendor-specific)
   - Add calculated columns (e.g., Price Variance)
4. Close & Load to PivotTable
5. Save query for reuse with new exports</code></pre>

            <h3>Performance Best Practices</h3>

            <h4>Client-Side Optimization</h4>
            <ul>
                <li><strong>Use Streaming Downloads:</strong> Don't load entire file into memory before saving</li>
                <li><strong>Download During Low Load:</strong> Schedule large exports during off-peak hours</li>
                <li><strong>Parallel Processing:</strong> Don't run multiple concurrent exports from same client</li>
                <li><strong>Network Stability:</strong> Use wired connection for 10,000+ product exports</li>
            </ul>

            <h4>Server-Side Optimization</h4>
            <ul>
                <li><strong>Database Maintenance:</strong> Run OPTIMIZE TABLE monthly on vendor tables</li>
                <li><strong>Index Verification:</strong> Ensure all foreign keys indexed (LinkedTradentDetailsInfo, etc.)</li>
                <li><strong>Connection Pooling:</strong> Verify pool size adequate for concurrent exports (min 10 connections)</li>
                <li><strong>Memory Monitoring:</strong> Set up alerts for heap usage >75%</li>
            </ul>

            <h3>Security Best Practices</h3>

            <h4>Data Protection</h4>
            <ol>
                <li><strong>Access Control:</strong>
                    <ul>
                        <li>Restrict export endpoint to authenticated users only</li>
                        <li>Implement role-based access (analyst, admin, viewer)</li>
                        <li>Log all export requests with user identification</li>
                    </ul>
                </li>
                <li><strong>Data Encryption:</strong>
                    <ul>
                        <li>Use HTTPS for all API calls (enforce TLS 1.2+)</li>
                        <li>Encrypt exports at rest (BitLocker, FileVault)</li>
                        <li>Sanitize sensitive data before sharing externally</li>
                    </ul>
                </li>
                <li><strong>Audit Trail:</strong>
                    <ul>
                        <li>Log who exported data and when</li>
                        <li>Track export parameters (full vs filtered)</li>
                        <li>Monitor for unusual export patterns</li>
                    </ul>
                </li>
            </ol>

            <h4>Compliance Considerations</h4>
            <div class="alert alert-warning">
                <strong>‚ö†Ô∏è Competitive Pricing Data:</strong> Exports contain competitor pricing intelligence. Ensure compliance with antitrust regulations. Do not share with competitors or use for price-fixing activities.
            </div>
        </section>

        <!-- FAQ -->
        <section id="faq">
            <h2>‚ùì Frequently Asked Questions</h2>

            <h3>General Questions</h3>

            <h4>Q: How often is export data updated?</h4>
            <p><strong>A:</strong> Export data reflects the current state of the MySQL and MongoDB databases at the moment of export generation. Data freshness depends on when products were last repriced. Check the <code>Last CRON run at</code> column to verify recency for specific products. Most products are repriced every 1-4 hours depending on their cron schedule.</p>

            <h4>Q: Can I schedule automatic exports?</h4>
            <p><strong>A:</strong> Yes. The service provides a REST API that can be called from cron jobs, schedulers, or workflow automation tools. See the "Export Scheduling & Frequency" section in Best Practices for automation scripts and scheduling recommendations.</p>

            <h4>Q: What's the maximum export size?</h4>
            <p><strong>A:</strong> The streaming architecture has no hard limit. Exports of 100,000+ products (600,000+ rows) are supported. Practical limits are:
                <ul>
                    <li><strong>Excel limit:</strong> 1,048,576 rows max</li>
                    <li><strong>Time limit:</strong> ~10 minutes for very large exports</li>
                    <li><strong>Network timeout:</strong> Configure client to handle long transfers</li>
                </ul>
            </p>

            <h4>Q: Why are some products missing from the export?</h4>
            <p><strong>A:</strong> Products appear in the export only if they have at least one vendor channel configured (Tradent, Frontier, MVP, TopDent, FirstDent, or Triad). Products with no vendor associations are excluded. Additionally, products must exist in <code>table_scrapeProductList</code> MySQL table.</p>

            <h3>Technical Questions</h3>

            <h4>Q: What's the difference between streaming and traditional Excel generation?</h4>
            <p><strong>A:</strong> Traditional Excel generation loads all data into memory, builds the complete workbook, then writes to disk/network. Streaming writes rows to the HTTP response as they're generated, keeping only ~100 rows in memory at any time. This enables unlimited dataset size and 90% memory reduction.</p>

            <h4>Q: Can I filter exports by date range?</h4>
            <p><strong>A:</strong> The current API endpoint does not support date range filtering. Generate a full export, then use Excel filters on the <code>Last CRON run at</code> or <code>Last updated at</code> columns to view products within specific timeframes. Alternatively, implement custom filtering in the service code.</p>

            <h4>Q: How do I export only specific vendors?</h4>
            <p><strong>A:</strong> The API returns all vendors for all products. To isolate a specific vendor:
                <ol>
                    <li>Generate full export</li>
                    <li>Apply Excel AutoFilter on <code>Channel Name</code> column</li>
                    <li>Select only desired vendor (e.g., TRADENT)</li>
                    <li>Copy filtered results to new workbook (optional)</li>
                </ol>
                For programmatic filtering, process the export with Python/Pandas or similar tools.
            </p>

            <h4>Q: Why do price columns have trailing slashes?</h4>
            <p><strong>A:</strong> Columns like <code>Last Existing Price</code>, <code>Last Suggested Price</code>, and <code>Lowest Vendor Price</code> append " /" to prevent Excel from auto-converting values to date format. For example, without the slash, "12.25" might become "Dec 25". This formatting preserves numeric interpretation while preventing date conversion.</p>

            <h3>Data Questions</h3>

            <h4>Q: What does "Badge Indicator" mean?</h4>
            <p><strong>A:</strong> Badge Indicator defines the competition strategy for products based on seller badge levels. The four strategies are:
                <ul>
                    <li><strong>ALL_ZERO:</strong> Compete against all sellers as if none have badges</li>
                    <li><strong>ALL_PERCENTAGE:</strong> Use percentage-based adjustments for all badge levels</li>
                    <li><strong>BADGE_ONLY:</strong> Only compete with sellers at the same badge level</li>
                    <li><strong>NON_BADGE_ONLY:</strong> Compete exclusively with non-badged sellers</li>
                </ul>
            </p>

            <h4>Q: What's the difference between "Last Existing Price" and "Last Suggested Price"?</h4>
            <p><strong>A:</strong>
                <ul>
                    <li><strong>Last Existing Price:</strong> The price that was live on the marketplace before the last reprice execution</li>
                    <li><strong>Last Suggested Price:</strong> The price calculated and recommended by the repricing algorithm during the last execution</li>
                </ul>
                These may differ if the algorithm suggested a price change but it wasn't applied (e.g., due to validation failure or manual override).
            </p>

            <h4>Q: How do I interpret the "Result" column?</h4>
            <p><strong>A:</strong> The Result column shows the outcome of the last reprice attempt:
                <ul>
                    <li><strong>SUCCESS:</strong> Repricing completed and price updated on marketplace</li>
                    <li><strong>ERROR:</strong> Repricing failed; check <code>Last Reprice Comment</code> for details</li>
                    <li><strong>SKIPPED:</strong> Repricing skipped due to business rules or filters</li>
                    <li><strong>NO_CHANGE:</strong> Algorithm determined current price is optimal; no change made</li>
                    <li><strong>Empty:</strong> Product not yet processed by repricing system</li>
                </ul>
            </p>

            <h3>Performance Questions</h3>

            <h4>Q: How long does a typical export take?</h4>
            <p><strong>A:</strong> Export times vary by dataset size:
                <ul>
                    <li>100 products (~600 rows): 3-5 seconds</li>
                    <li>1,000 products (~6,000 rows): 15-25 seconds</li>
                    <li>5,000 products (~30,000 rows): 60-90 seconds</li>
                    <li>10,000 products (~60,000 rows): 2-3 minutes</li>
                </ul>
                Times measured on 4-core, 16GB RAM server. Database connectivity and load significantly impact performance.
            </p>

            <h4>Q: Can I run multiple exports simultaneously?</h4>
            <p><strong>A:</strong> Yes, the service supports concurrent exports through connection pooling and streaming architecture. Recommended limits:
                <ul>
                    <li><strong>Development:</strong> 1-2 concurrent exports</li>
                    <li><strong>Production (4GB RAM):</strong> 3-5 concurrent exports</li>
                    <li><strong>Production (8GB RAM):</strong> 10+ concurrent exports</li>
                </ul>
                Monitor database connection pool usage to avoid exhaustion.
            </p>

            <h4>Q: My export file is very large. How can I reduce size?</h4>
            <p><strong>A:</strong>
                <ol>
                    <li><strong>Filter in Excel:</strong> Delete rows for unused vendors or inactive products, then save</li>
                    <li><strong>Save as Binary:</strong> File ‚Üí Save As ‚Üí Excel Binary Workbook (.xlsb) reduces size 50-70%</li>
                    <li><strong>Remove Formatting:</strong> Clear conditional formatting and unused styles</li>
                    <li><strong>Compress:</strong> ZIP the .xlsx file for storage/transfer (limited additional compression)</li>
                    <li><strong>Split by Vendor:</strong> Create separate exports per vendor instead of one combined file</li>
                </ol>
            </p>

            <h3>Integration Questions</h3>

            <h4>Q: Can I integrate exports with Power BI or Tableau?</h4>
            <p><strong>A:</strong> Yes. Both Power BI and Tableau can import Excel files as data sources:
                <ul>
                    <li><strong>Power BI:</strong> Get Data ‚Üí Excel ‚Üí Select export file ‚Üí Load ‚Üí Refresh schedule available</li>
                    <li><strong>Tableau:</strong> Connect ‚Üí Excel ‚Üí Select export file ‚Üí Refresh extracts on schedule</li>
                </ul>
                For live data, use the MySQL database directly as a data source instead of Excel exports.
            </p>

            <h4>Q: How do I automate export analysis with Python?</h4>
            <p><strong>A:</strong> Use the requests and pandas libraries:</p>
            <pre><code>import requests
import pandas as pd

# Download export
response = requests.get('http://localhost:3003/api/excel/download')
with open('export.xlsx', 'wb') as f:
    f.write(response.content)

# Load into pandas DataFrame
df = pd.read_excel('export.xlsx')

# Analysis examples
vendor_summary = df.groupby('Channel Name').agg({
    'MPID': 'count',
    'Latest Price': 'mean',
    'Result': lambda x: (x == 'SUCCESS').sum()
})

print(vendor_summary)</code></pre>

            <h4>Q: Can I export to CSV instead of Excel?</h4>
            <p><strong>A:</strong> The service currently only generates Excel (.xlsx) files. To convert to CSV:
                <ol>
                    <li><strong>Excel:</strong> Open export ‚Üí File ‚Üí Save As ‚Üí CSV (Comma delimited)</li>
                    <li><strong>Python:</strong> <code>pd.read_excel('export.xlsx').to_csv('export.csv', index=False)</code></li>
                    <li><strong>Command Line:</strong> <code>ssconvert export.xlsx export.csv</code> (requires Gnumeric)</li>
                </ol>
                Note: CSV loses multi-sheet capability and formatting. Consider implementing CSV export in service code if needed frequently.
            </p>

            <div class="alert alert-info">
                <strong>üí° Additional Questions?</strong> For questions not covered in this FAQ, review the service code at <code>apps/excel-export/src/</code> or consult the development team. The codebase includes inline documentation and clear implementation patterns for understanding export behavior.
            </div>
        </section>

        <footer>
            <p>Excel Export Service User Guide | Version 1.0 | Last Updated: November 18, 2025</p>
            <p>Part of the Dental Supply Repricing Monorepo | <a href="../DOCUMENTATION-INDEX.md">Documentation Index</a></p>
        </footer>
    </div>
</body>
</html>