<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Repricer Application - Technical Documentation</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            line-height: 1.6;
            color: #333;
            background: #f5f5f5;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 60px 20px;
            margin-bottom: 40px;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }

        .subtitle {
            font-size: 1.2rem;
            opacity: 0.9;
        }

        .meta-info {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 40px;
        }

        .meta-card {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .meta-card h3 {
            color: #667eea;
            margin-bottom: 10px;
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .meta-card p {
            font-size: 1.5rem;
            font-weight: bold;
            color: #333;
        }

        .section {
            background: white;
            padding: 30px;
            margin-bottom: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        h2 {
            color: #667eea;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 3px solid #667eea;
            font-size: 1.8rem;
        }

        h3 {
            color: #764ba2;
            margin-top: 25px;
            margin-bottom: 15px;
            font-size: 1.4rem;
        }

        h4 {
            color: #555;
            margin-top: 20px;
            margin-bottom: 10px;
            font-size: 1.1rem;
        }

        ul, ol {
            margin-left: 20px;
            margin-bottom: 15px;
        }

        li {
            margin-bottom: 8px;
        }

        code {
            background: #f4f4f4;
            padding: 2px 6px;
            border-radius: 3px;
            font-family: 'Courier New', monospace;
            color: #e83e8c;
            font-size: 0.9em;
        }

        pre {
            background: #2d2d2d;
            color: #f8f8f2;
            padding: 20px;
            border-radius: 5px;
            overflow-x: auto;
            margin: 15px 0;
            font-size: 0.9rem;
        }

        pre code {
            background: none;
            color: #f8f8f2;
            padding: 0;
        }

        .tech-stack {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }

        .tech-item {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 5px;
            border-left: 4px solid #667eea;
        }

        .tech-item strong {
            color: #667eea;
            display: block;
            margin-bottom: 5px;
        }

        .architecture-diagram {
            background: #f8f9fa;
            padding: 30px;
            border-radius: 8px;
            margin: 20px 0;
            text-align: center;
        }

        .flow-box {
            background: white;
            border: 2px solid #667eea;
            padding: 15px;
            margin: 10px;
            border-radius: 5px;
            display: inline-block;
            min-width: 150px;
        }

        .arrow {
            font-size: 2rem;
            color: #667eea;
            margin: 10px 0;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }

        th, td {
            border: 1px solid #ddd;
            padding: 12px;
            text-align: left;
        }

        th {
            background: #667eea;
            color: white;
            font-weight: 600;
        }

        tr:nth-child(even) {
            background: #f8f9fa;
        }

        .highlight {
            background: #fff3cd;
            padding: 15px;
            border-left: 4px solid #ffc107;
            margin: 15px 0;
            border-radius: 4px;
        }

        .warning {
            background: #f8d7da;
            padding: 15px;
            border-left: 4px solid #dc3545;
            margin: 15px 0;
            border-radius: 4px;
        }

        .info {
            background: #d1ecf1;
            padding: 15px;
            border-left: 4px solid #0dcaf0;
            margin: 15px 0;
            border-radius: 4px;
        }

        .toc {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 30px;
        }

        .toc h2 {
            border: none;
            margin-bottom: 15px;
        }

        .toc ul {
            list-style: none;
            margin-left: 0;
        }

        .toc a {
            color: #667eea;
            text-decoration: none;
            display: block;
            padding: 5px 0;
        }

        .toc a:hover {
            text-decoration: underline;
        }

        footer {
            text-align: center;
            padding: 20px;
            color: #666;
            margin-top: 40px;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>ðŸš€ Repricer Application</h1>
            <p class="subtitle">Comprehensive Technical Documentation</p>
            <p style="margin-top: 10px; opacity: 0.8;">Version 1.0.1 | Node.js TypeScript Application</p>
        </header>

        <div class="meta-info">
            <div class="meta-card">
                <h3>Technology Stack</h3>
                <p>Node.js + TypeScript</p>
            </div>
            <div class="meta-card">
                <h3>Architecture Pattern</h3>
                <p>MVC with Services</p>
            </div>
            <div class="meta-card">
                <h3>Total TypeScript Files</h3>
                <p>89 files</p>
            </div>
            <div class="meta-card">
                <h3>Key Components</h3>
                <p>23 Controllers</p>
            </div>
        </div>

        <div class="toc section">
            <h2>ðŸ“‹ Table of Contents</h2>
            <ul>
                <li><a href="#overview">1. System Overview</a></li>
                <li><a href="#architecture">2. Architecture & Design Patterns</a></li>
                <li><a href="#tech-stack">3. Technology Stack</a></li>
                <li><a href="#repricing-logic">4. Repricing Algorithm Logic</a></li>
                <li><a href="#data-models">5. Data Models & Schema</a></li>
                <li><a href="#key-modules">6. Key Modules & Responsibilities</a></li>
                <li><a href="#api-endpoints">7. API Endpoints & Routes</a></li>
                <li><a href="#integration">8. Integration Points</a></li>
                <li><a href="#configuration">9. Configuration Management</a></li>
                <li><a href="#deployment">10. Deployment & Operations</a></li>
            </ul>
        </div>

        <div id="overview" class="section">
            <h2>1. System Overview</h2>

            <p>The Repricer application is an enterprise-grade pricing automation system designed for e-commerce platforms, specifically optimized for dental supply vendors. It provides sophisticated competitive pricing algorithms, real-time market monitoring, and automated price adjustments based on configurable business rules.</p>

            <h3>Core Functionality</h3>
            <ul>
                <li><strong>Automated Price Repricing:</strong> Multi-vendor competitive pricing engine with V1 and V2 algorithm support</li>
                <li><strong>Real-time Market Monitoring:</strong> Continuous tracking of competitor prices and market conditions</li>
                <li><strong>Cron-based Scheduling:</strong> Configurable job scheduling with 30+ distinct cron configurations</li>
                <li><strong>Multi-vendor Support:</strong> Supports 6+ vendors (Tradent, Frontier, FirstDent, TopDent, MVP, Triad)</li>
                <li><strong>Badge-based Competition:</strong> Authorized vs non-authorized distributor differentiation</li>
                <li><strong>Price Break Management:</strong> Quantity-based pricing with configurable thresholds</li>
                <li><strong>Historical Data Tracking:</strong> Comprehensive audit trails and export capabilities</li>
            </ul>

            <div class="highlight">
                <strong>Key Business Value:</strong> Enables dynamic pricing strategies that maximize profit margins while maintaining competitive market positioning through automated rule-based repricing algorithms.
            </div>
        </div>

        <div id="architecture" class="section">
            <h2>2. Architecture & Design Patterns</h2>

            <h3>Architectural Pattern</h3>
            <p>The application follows a <strong>layered MVC architecture</strong> with service-oriented design principles:</p>

            <div class="architecture-diagram">
                <div class="flow-box" style="background: #e3f2fd;">
                    <strong>Presentation Layer</strong><br>
                    EJS Templates + Express Routes
                </div>
                <div class="arrow">â†“</div>
                <div class="flow-box" style="background: #f3e5f5;">
                    <strong>Controller Layer</strong><br>
                    23 Controllers (Product, Cron, Algo, etc.)
                </div>
                <div class="arrow">â†“</div>
                <div class="flow-box" style="background: #fff3e0;">
                    <strong>Service Layer</strong><br>
                    Business Logic + Algorithm Services
                </div>
                <div class="arrow">â†“</div>
                <div class="flow-box" style="background: #e8f5e9;">
                    <strong>Data Access Layer</strong><br>
                    MySQL (Knex) + MongoDB (Mongoose)
                </div>
            </div>

            <h3>Directory Structure</h3>
            <pre><code>apps/repricer/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ controllers/      # Request handlers (23 files)
â”‚   â”œâ”€â”€ services/         # Business logic & data access
â”‚   â”‚   â””â”€â”€ algo_v2/     # V2 algorithm implementation
â”‚   â”œâ”€â”€ models/          # Data models & schemas
â”‚   â”œâ”€â”€ routes/          # Express routing configuration
â”‚   â”œâ”€â”€ middleware/      # Auth, mapping, helpers
â”‚   â”œâ”€â”€ utility/         # Config, encryption, helpers
â”‚   â””â”€â”€ client/          # Cache client (Redis/Valkey)
â”œâ”€â”€ views/               # EJS templates
â”œâ”€â”€ resources/           # JSON configuration files
â”œâ”€â”€ MYSQL/              # SQL schemas & migrations
â””â”€â”€ public/             # Static assets</code></pre>

            <h3>Design Patterns</h3>

            <h4>1. MVC (Model-View-Controller)</h4>
            <ul>
                <li><strong>Models:</strong> Mongoose schemas for MongoDB, SQL models for MySQL</li>
                <li><strong>Views:</strong> EJS templates for server-side rendering</li>
                <li><strong>Controllers:</strong> Express handlers coordinating business logic</li>
            </ul>

            <h4>2. Service Layer Pattern</h4>
            <ul>
                <li>Business logic abstraction in dedicated service modules</li>
                <li>Database operations encapsulated in service layer</li>
                <li>Reusable business components across controllers</li>
            </ul>

            <h4>3. Repository Pattern</h4>
            <ul>
                <li>MySQL operations through Knex query builder</li>
                <li>MongoDB operations through Mongoose ODM</li>
                <li>Data access abstraction for testability</li>
            </ul>

            <h4>4. Singleton Pattern</h4>
            <ul>
                <li>MongoDB connection management</li>
                <li>Knex database instance pooling</li>
                <li>Cache client initialization</li>
            </ul>

            <h4>5. Middleware Chain Pattern</h4>
            <ul>
                <li>Authentication middleware (<code>AuthToken</code>, <code>auth-middleware</code>)</li>
                <li>Error handling middleware</li>
                <li>Request logging with Morgan</li>
                <li>Session management</li>
            </ul>
        </div>

        <div id="tech-stack" class="section">
            <h2>3. Technology Stack</h2>

            <div class="tech-stack">
                <div class="tech-item">
                    <strong>Runtime</strong>
                    Node.js 22 (Alpine Linux)
                </div>
                <div class="tech-item">
                    <strong>Language</strong>
                    TypeScript 5.8.3
                </div>
                <div class="tech-item">
                    <strong>Framework</strong>
                    Express.js 5.1.0
                </div>
                <div class="tech-item">
                    <strong>Template Engine</strong>
                    EJS 3.1.8
                </div>
                <div class="tech-item">
                    <strong>SQL Database</strong>
                    MySQL 2 (mysql2 3.11.0)
                </div>
                <div class="tech-item">
                    <strong>NoSQL Database</strong>
                    MongoDB 4.10.0
                </div>
                <div class="tech-item">
                    <strong>ORM/ODM</strong>
                    Mongoose 8.16.4
                </div>
                <div class="tech-item">
                    <strong>Query Builder</strong>
                    Knex 3.1.0
                </div>
                <div class="tech-item">
                    <strong>Cache</strong>
                    Redis (ioredis 5.7.0) + Valkey
                </div>
                <div class="tech-item">
                    <strong>Session Store</strong>
                    memorystore 1.6.7
                </div>
                <div class="tech-item">
                    <strong>Validation</strong>
                    Zod 4.0.10
                </div>
                <div class="tech-item">
                    <strong>Scheduling</strong>
                    node-cron 3.0.2
                </div>
            </div>

            <h3>Key Dependencies</h3>

            <table>
                <thead>
                    <tr>
                        <th>Category</th>
                        <th>Package</th>
                        <th>Version</th>
                        <th>Purpose</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>HTTP Client</td>
                        <td>axios</td>
                        <td>0.27.2</td>
                        <td>External API requests with retry logic</td>
                    </tr>
                    <tr>
                        <td>Date/Time</td>
                        <td>dayjs</td>
                        <td>1.11.5</td>
                        <td>Date manipulation and formatting</td>
                    </tr>
                    <tr>
                        <td>Utilities</td>
                        <td>lodash</td>
                        <td>4.17.21</td>
                        <td>Data transformation and utilities</td>
                    </tr>
                    <tr>
                        <td>Excel</td>
                        <td>exceljs</td>
                        <td>4.3.0</td>
                        <td>Excel file generation and parsing</td>
                    </tr>
                    <tr>
                        <td>CSV</td>
                        <td>csv-parser</td>
                        <td>3.1.0</td>
                        <td>CSV data processing</td>
                    </tr>
                    <tr>
                        <td>Email</td>
                        <td>postmark</td>
                        <td>4.0.5</td>
                        <td>Email notifications</td>
                    </tr>
                    <tr>
                        <td>FTP</td>
                        <td>basic-ftp</td>
                        <td>5.0.5</td>
                        <td>File transfer operations</td>
                    </tr>
                    <tr>
                        <td>Security</td>
                        <td>bcrypt</td>
                        <td>6.0.0</td>
                        <td>Password hashing</td>
                    </tr>
                </tbody>
            </table>

            <h3>Development Tools</h3>
            <ul>
                <li><strong>Dev Server:</strong> ts-node-dev with auto-reload and transpilation</li>
                <li><strong>Code Quality:</strong> Prettier for formatting, EJS linting</li>
                <li><strong>Build:</strong> TypeScript compiler (tsc)</li>
                <li><strong>Memory:</strong> 4GB max old space size for development</li>
            </ul>
        </div>

        <div id="repricing-logic" class="section">
            <h2>4. Repricing Algorithm Logic</h2>

            <h3>Algorithm Versions</h3>

            <div class="info">
                <strong>Dual Algorithm System:</strong> The application supports both V1 (legacy) and V2 (current) repricing algorithms with configurable execution modes for gradual migration and A/B testing.
            </div>

            <h4>Algorithm Execution Modes</h4>
            <table>
                <thead>
                    <tr>
                        <th>Mode</th>
                        <th>Description</th>
                        <th>Use Case</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><code>V2_ONLY</code></td>
                        <td>Execute V2 algorithm exclusively</td>
                        <td>Production for migrated products</td>
                    </tr>
                    <tr>
                        <td><code>V1_ONLY</code></td>
                        <td>Execute V1 algorithm exclusively</td>
                        <td>Legacy products not yet migrated</td>
                    </tr>
                    <tr>
                        <td><code>V2_EXECUTE_V1_DRY</code></td>
                        <td>Execute V2, run V1 for comparison only</td>
                        <td>Testing V2 with V1 validation</td>
                    </tr>
                    <tr>
                        <td><code>V1_EXECUTE_V2_DRY</code></td>
                        <td>Execute V1, run V2 for comparison only</td>
                        <td>Testing V2 before full migration</td>
                    </tr>
                </tbody>
            </table>

            <h3>V2 Algorithm Settings</h3>

            <p>Each product-vendor combination has configurable algorithm settings stored in <code>v2_algo_settings</code> table:</p>

            <pre><code>interface V2AlgoSettings {
  mp_id: number;                              // Marketplace Product ID
  vendor_id: number;                          // Vendor identifier

  // Price Movement Controls
  up_down: AlgoPriceDirection;               // UP, DOWN, or BOTH
  reprice_up_percentage: number;             // Max % increase allowed
  reprice_down_percentage: number;           // Max % decrease allowed

  // Badge Indicator Competition
  badge_indicator: AlgoBadgeIndicator;       // ALL_ZERO, ALL_PERCENTAGE,
                                             // BADGE_ONLY, NON_BADGE_ONLY
  reprice_up_badge_percentage: number;       // Badge-specific up %
  reprice_down_badge_percentage: number;     // Badge-specific down %

  // Price Boundaries
  floor_price: number;                       // Minimum price allowed
  max_price: number;                         // Maximum price allowed

  // Competition Rules
  compete_with_all_vendors: boolean;         // Compete with all vs selective
  suppress_price_break: boolean;             // Suppress quantity breaks
  suppress_price_break_if_Q1_not_updated: boolean;
  compete_on_price_break_only: boolean;      // Only compete on breaks
  compare_q2_with_q1: boolean;               // Compare Q2 pricing with Q1

  // Vendor Relationships
  sister_vendor_ids: string;                 // Comma-separated IDs
  exclude_vendors: string;                   // Vendors to ignore
  inactive_vendor_id: string;                // Inactive vendor handling
  own_vendor_threshold: number;              // Own vendor competition threshold

  // Advanced Settings
  handling_time_group: AlgoHandlingTimeGroup; // Shipping time grouping
  keep_position: boolean;                    // Maintain price position
  floor_compete_with_next: boolean;          // Compete at floor
  execution_priority: number;                // Execution order
  price_strategy: AlgoPriceStrategy;         // Strategy selection
  inventory_competition_threshold: number;   // Min inventory to compete
}</code></pre>

            <h3>Badge Indicator System</h3>

            <p>The badge system differentiates authorized distributors from non-authorized:</p>

            <table>
                <thead>
                    <tr>
                        <th>Badge Type</th>
                        <th>Description</th>
                        <th>Strategy</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><code>ALL_ZERO</code></td>
                        <td>Compete with all vendors - Regular</td>
                        <td>Standard competitive pricing</td>
                    </tr>
                    <tr>
                        <td><code>ALL_PERCENTAGE</code></td>
                        <td>Compete with all - Percentage based</td>
                        <td>Percentage-based adjustments</td>
                    </tr>
                    <tr>
                        <td><code>BADGE_ONLY</code></td>
                        <td>Authorized Distributors only</td>
                        <td>Premium positioning strategy</td>
                    </tr>
                    <tr>
                        <td><code>NON_BADGE_ONLY</code></td>
                        <td>Non-Authorized Distributors only</td>
                        <td>Aggressive competitive strategy</td>
                    </tr>
                </tbody>
            </table>

            <h3>Algorithm Execution Flow</h3>

            <div class="architecture-diagram">
                <div class="flow-box">1. Fetch Product Data</div>
                <div class="arrow">â†“</div>
                <div class="flow-box">2. Load V2 Settings</div>
                <div class="arrow">â†“</div>
                <div class="flow-box">3. Get Competitor Prices</div>
                <div class="arrow">â†“</div>
                <div class="flow-box">4. Apply Badge Filters</div>
                <div class="arrow">â†“</div>
                <div class="flow-box">5. Calculate Suggested Price</div>
                <div class="arrow">â†“</div>
                <div class="flow-box">6. Validate Boundaries</div>
                <div class="arrow">â†“</div>
                <div class="flow-box">7. Store Results</div>
                <div class="arrow">â†“</div>
                <div class="flow-box">8. Update Net32 API</div>
            </div>

            <h3>Price Calculation Logic</h3>

            <ol>
                <li><strong>Competitor Filtering:</strong>
                    <ul>
                        <li>Apply badge indicator filters (authorized vs non-authorized)</li>
                        <li>Exclude specified vendors from consideration</li>
                        <li>Filter by handling time groups if configured</li>
                        <li>Check inventory competition thresholds</li>
                    </ul>
                </li>

                <li><strong>Base Price Determination:</strong>
                    <ul>
                        <li>Identify lowest qualifying competitor price</li>
                        <li>Apply price strategy (undercut, match, maintain position)</li>
                        <li>Consider quantity break pricing if enabled</li>
                    </ul>
                </li>

                <li><strong>Price Adjustment:</strong>
                    <ul>
                        <li>Apply percentage adjustments (up/down)</li>
                        <li>Badge-specific percentage overrides</li>
                        <li>Own vendor threshold considerations</li>
                    </ul>
                </li>

                <li><strong>Boundary Validation:</strong>
                    <ul>
                        <li>Enforce floor price (minimum)</li>
                        <li>Enforce max price (maximum)</li>
                        <li>Validate price break logic</li>
                    </ul>
                </li>

                <li><strong>Result Recording:</strong>
                    <ul>
                        <li>Store suggested price in <code>v2_algo_results</code></li>
                        <li>Record chain-of-thought HTML in <code>v2_algo_execution</code></li>
                        <li>Log triggered vendor and reasoning</li>
                        <li>Track price update result from Net32 API</li>
                    </ul>
                </li>
            </ol>

            <h3>Vendor Synchronization</h3>

            <p>The system supports 6 primary vendors with automatic settings synchronization:</p>

            <table>
                <thead>
                    <tr>
                        <th>Vendor</th>
                        <th>ID</th>
                        <th>Table</th>
                        <th>Auto-Sync</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>FirstDent</td>
                        <td>20533</td>
                        <td>table_firstDentDetails</td>
                        <td>Yes</td>
                    </tr>
                    <tr>
                        <td>Frontier</td>
                        <td>20722</td>
                        <td>table_frontierDetails</td>
                        <td>Yes</td>
                    </tr>
                    <tr>
                        <td>Tradent</td>
                        <td>20723</td>
                        <td>table_tradentDetails</td>
                        <td>Yes</td>
                    </tr>
                    <tr>
                        <td>TopDent</td>
                        <td>21127</td>
                        <td>table_topDentDetails</td>
                        <td>Yes</td>
                    </tr>
                    <tr>
                        <td>MVP</td>
                        <td>21222</td>
                        <td>table_mvpDetails</td>
                        <td>Yes</td>
                    </tr>
                    <tr>
                        <td>Triad</td>
                        <td>21235</td>
                        <td>table_triadDetails</td>
                        <td>Yes</td>
                    </tr>
                </tbody>
            </table>
        </div>

        <div id="data-models" class="section">
            <h2>5. Data Models & Schema</h2>

            <h3>Database Architecture</h3>

            <div class="info">
                <strong>Hybrid Database Strategy:</strong> MySQL for structured product and vendor data, MongoDB for flexible cron logs, settings, and historical data.
            </div>

            <h3>MySQL Schema (Primary)</h3>

            <h4>Core Tables</h4>

            <table>
                <thead>
                    <tr>
                        <th>Table</th>
                        <th>Purpose</th>
                        <th>Key Fields</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><code>table_scrapeProductList</code></td>
                        <td>Master product registry</td>
                        <td>MpId, ProductName, Net32Url, IsActive, algo_execution_mode</td>
                    </tr>
                    <tr>
                        <td><code>v2_algo_settings</code></td>
                        <td>V2 algorithm configuration per product/vendor</td>
                        <td>mp_id, vendor_id, price boundaries, competition rules</td>
                    </tr>
                    <tr>
                        <td><code>v2_algo_results</code></td>
                        <td>Algorithm execution results</td>
                        <td>job_id, suggested_price, result, triggered_by_vendor</td>
                    </tr>
                    <tr>
                        <td><code>v2_algo_execution</code></td>
                        <td>Detailed execution traces</td>
                        <td>job_id, chain_of_thought_html, execution metadata</td>
                    </tr>
                    <tr>
                        <td><code>v2_algo_errors</code></td>
                        <td>Error tracking</td>
                        <td>error_type, error_message, mp_id, vendor_id</td>
                    </tr>
                </tbody>
            </table>

            <h4>Vendor-Specific Tables</h4>

            <ul>
                <li><code>table_firstDentDetails</code> - FirstDent vendor data</li>
                <li><code>table_frontierDetails</code> - Frontier vendor data</li>
                <li><code>table_tradentDetails</code> - Tradent vendor data</li>
                <li><code>table_topDentDetails</code> - TopDent vendor data</li>
                <li><code>table_mvpDetails</code> - MVP vendor data</li>
                <li><code>table_triadDetails</code> - Triad vendor data</li>
            </ul>

            <p>Each vendor table contains:</p>
            <ul>
                <li>Product pricing information</li>
                <li>Last update timestamps</li>
                <li>Cron execution history</li>
                <li>Badge indicators</li>
                <li>Channel IDs and configuration</li>
            </ul>

            <h3>MongoDB Schema (Secondary)</h3>

            <h4>Item Model (Mongoose)</h4>

            <pre><code>interface ItemSchema {
  // Product Identification
  mpid: string;                    // Marketplace ID (required)
  productName: string;
  channelId: string;
  channelName: string;
  focusId: string;
  alternateId: string;

  // URLs and References
  net32url: string;
  net32_url: string;

  // Pricing
  unitPrice: number;
  floorPrice: number;
  maxPrice: number;
  latest_price: number;

  // Control Flags
  activated: boolean;              // Default: true
  scrapeOn: boolean;               // Default: true
  allowReprice: boolean;           // Default: true
  is_nc_needed: boolean;

  // Cron Configuration
  cronId: string;
  cronName: string;
  requestInterval: number;
  requestIntervalUnit: string;
  Request_every: string;

  // Timestamps
  last_cron_time: Date;
  last_update_time: Date;
  last_attempted_time: Date;
  next_cron_time: Date;
  currentDateTime: Date;

  // Repricing Rules
  repricingRule: number;           // Default: 2
  priority: number;                // Default: 5
  executionPriority: number;
  suppressPriceBreak: boolean;
  suppressPriceBreakForOne: boolean;
  badgeIndicator: string;
  badgePercentage: number;
  percentageIncrease: number;

  // Competition Settings
  competeAll: boolean;             // Default: false
  compareWithQ1: boolean;
  beatQPrice: boolean;
  abortDeactivatingQPriceBreak: boolean;

  // Vendor Management
  ownVendorId: string;
  sisterVendorId: string;
  inactiveVendorId: string;
  includeInactiveVendors: boolean;

  // Status Tracking
  last_cron_message: string;
  lowest_vendor: string;
  lowest_vendor_price: string;
  lastExistingPrice: string;
  lastSuggestedPrice: string;
  lastUpdatedBy: string;
  lastCronRun: string;

  // Bulk Operations
  override_bulk_update: boolean;
  override_bulk_rule: number;
  wait_update_period: boolean;

  // Metadata
  tags: Array;
  SecretKey: string;
  Reprice_on_off: string;

  // Timestamps (auto-managed)
  createdAt: Date;
  updatedAt: Date;
}</code></pre>

            <h4>MongoDB Collections</h4>

            <table>
                <thead>
                    <tr>
                        <th>Collection</th>
                        <th>Purpose</th>
                        <th>Size</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><code>cronLogs</code></td>
                        <td>Cron execution history</td>
                        <td>High volume</td>
                    </tr>
                    <tr>
                        <td><code>cronSettings</code></td>
                        <td>Cron job configurations (30+ configs)</td>
                        <td>Medium</td>
                    </tr>
                    <tr>
                        <td><code>items</code></td>
                        <td>Product master data (mirrors SQL)</td>
                        <td>Large</td>
                    </tr>
                    <tr>
                        <td><code>filterCronSettings</code></td>
                        <td>Filter-based cron configurations</td>
                        <td>Small</td>
                    </tr>
                    <tr>
                        <td><code>slowCronSettings</code></td>
                        <td>Slow-running cron configurations</td>
                        <td>Small</td>
                    </tr>
                    <tr>
                        <td><code>scrapeCronSettings</code></td>
                        <td>Scraping-specific configurations</td>
                        <td>Medium</td>
                    </tr>
                    <tr>
                        <td><code>422cronLogs</code></td>
                        <td>HTTP 422 error tracking</td>
                        <td>Variable</td>
                    </tr>
                    <tr>
                        <td><code>errorItems</code></td>
                        <td>Failed product processing</td>
                        <td>Variable</td>
                    </tr>
                    <tr>
                        <td><code>historyData</code></td>
                        <td>Historical pricing data</td>
                        <td>Very large</td>
                    </tr>
                    <tr>
                        <td><code>users</code></td>
                        <td>User authentication</td>
                        <td>Small</td>
                    </tr>
                    <tr>
                        <td><code>exportStatus</code></td>
                        <td>Export job tracking</td>
                        <td>Small</td>
                    </tr>
                </tbody>
            </table>
        </div>

        <div id="key-modules" class="section">
            <h2>6. Key Modules & Responsibilities</h2>

            <h3>Controllers (23 total)</h3>

            <table>
                <thead>
                    <tr>
                        <th>Controller</th>
                        <th>File Size</th>
                        <th>Primary Responsibility</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><code>product.ts</code></td>
                        <td>33.5 KB</td>
                        <td>Master product management, Excel imports, CRUD operations</td>
                    </tr>
                    <tr>
                        <td><code>product-v2.ts</code></td>
                        <td>30.6 KB</td>
                        <td>V2 product interface with enhanced features</td>
                    </tr>
                    <tr>
                        <td><code>v2-algo.ts</code></td>
                        <td>9.1 KB</td>
                        <td>V2 algorithm settings, results, execution mode management</td>
                    </tr>
                    <tr>
                        <td><code>cron_logs.ts</code></td>
                        <td>48.2 KB (1460 lines)</td>
                        <td>Cron execution logging, filtering, analytics</td>
                    </tr>
                    <tr>
                        <td><code>cron_settings.ts</code></td>
                        <td>18.8 KB (541 lines)</td>
                        <td>Cron configuration management, scheduling</td>
                    </tr>
                    <tr>
                        <td><code>cron-filter.ts</code></td>
                        <td>12.9 KB</td>
                        <td>Filter-based cron management</td>
                    </tr>
                    <tr>
                        <td><code>scrape.ts</code></td>
                        <td>14.8 KB</td>
                        <td>Web scraping operations for competitor data</td>
                    </tr>
                    <tr>
                        <td><code>scrape-logs.ts</code></td>
                        <td>2.0 KB</td>
                        <td>Scraping execution logs</td>
                    </tr>
                    <tr>
                        <td><code>history.ts</code></td>
                        <td>7.1 KB</td>
                        <td>Historical data access and export</td>
                    </tr>
                    <tr>
                        <td><code>debug.ts</code></td>
                        <td>12.8 KB</td>
                        <td>Debugging utilities and diagnostics</td>
                    </tr>
                    <tr>
                        <td><code>monitor.ts</code></td>
                        <td>3.4 KB</td>
                        <td>System monitoring endpoints</td>
                    </tr>
                    <tr>
                        <td><code>monitor-sense.ts</code></td>
                        <td>10.0 KB</td>
                        <td>Advanced monitoring with cron startup</td>
                    </tr>
                    <tr>
                        <td><code>storage-sense.ts</code></td>
                        <td>6.1 KB</td>
                        <td>Disk space monitoring and alerts</td>
                    </tr>
                    <tr>
                        <td><code>ip-health.ts</code></td>
                        <td>4.2 KB</td>
                        <td>IP health checks for proxy management</td>
                    </tr>
                    <tr>
                        <td><code>admin.ts</code></td>
                        <td>3.9 KB</td>
                        <td>Administrative functions</td>
                    </tr>
                    <tr>
                        <td><code>user.ts</code></td>
                        <td>5.9 KB</td>
                        <td>User authentication and management</td>
                    </tr>
                    <tr>
                        <td><code>config.ts</code></td>
                        <td>4.6 KB</td>
                        <td>Configuration management interface</td>
                    </tr>
                    <tr>
                        <td><code>cache.ts</code></td>
                        <td>2.4 KB</td>
                        <td>Cache management operations</td>
                    </tr>
                    <tr>
                        <td><code>report.ts</code></td>
                        <td>2.2 KB</td>
                        <td>Report generation</td>
                    </tr>
                    <tr>
                        <td><code>help.ts</code></td>
                        <td>12.4 KB</td>
                        <td>Help documentation and guides</td>
                    </tr>
                    <tr>
                        <td><code>app-log.ts</code></td>
                        <td>4.9 KB</td>
                        <td>Application log management</td>
                    </tr>
                    <tr>
                        <td><code>notify-controller.ts</code></td>
                        <td>4.5 KB</td>
                        <td>Email notifications via Postmark</td>
                    </tr>
                    <tr>
                        <td><code>play.ts</code></td>
                        <td>1.2 KB</td>
                        <td>Testing/playground endpoints</td>
                    </tr>
                </tbody>
            </table>

            <h3>Services Layer</h3>

            <h4>Core Services</h4>

            <ul>
                <li><strong>mysql.ts (33.5 KB):</strong> MySQL database operations, stored procedure calls, connection pooling</li>
                <li><strong>mongo.ts (46.1 KB):</strong> MongoDB operations, singleton connection management, collection access</li>
                <li><strong>knex-wrapper.ts (1.0 KB):</strong> Knex instance management and pooling</li>
                <li><strong>cron.ts:</strong> Cron scheduling utilities</li>
                <li><strong>ftp.ts:</strong> FTP file transfer operations</li>
                <li><strong>excel-export.service.ts (2.5 KB):</strong> Excel file generation</li>
                <li><strong>history-export.ts (13.4 KB):</strong> Historical data export to Excel/CSV</li>
            </ul>

            <h4>Algorithm V2 Services</h4>

            <ul>
                <li><strong>algo_v2/settings.ts (31.4 KB, 1060 lines):</strong>
                    <ul>
                        <li>V2 algorithm settings CRUD operations</li>
                        <li>Vendor settings synchronization</li>
                        <li>Channel ID management</li>
                        <li>Product-vendor configuration</li>
                    </ul>
                </li>

                <li><strong>algo_v2/results.ts (1.9 KB):</strong>
                    <ul>
                        <li>Algorithm execution results retrieval</li>
                        <li>Chain-of-thought HTML processing</li>
                        <li>Vendor name lookup integration</li>
                    </ul>
                </li>

                <li><strong>algo_v2/products.ts (1.1 KB):</strong>
                    <ul>
                        <li>Product details fetching</li>
                        <li>Algorithm execution mode management</li>
                    </ul>
                </li>

                <li><strong>algo_v2/errors.ts:</strong>
                    <ul>
                        <li>Error tracking and retrieval</li>
                    </ul>
                </li>
            </ul>

            <h3>Middleware Layer</h3>

            <table>
                <thead>
                    <tr>
                        <th>Middleware</th>
                        <th>Size</th>
                        <th>Function</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><code>mapper-helper.ts</code></td>
                        <td>36.3 KB</td>
                        <td>Data transformation, vendor mapping, badge parsing</td>
                    </tr>
                    <tr>
                        <td><code>mysql.ts</code></td>
                        <td>24.8 KB</td>
                        <td>MySQL middleware operations</td>
                    </tr>
                    <tr>
                        <td><code>product-helper.ts</code></td>
                        <td>5.7 KB</td>
                        <td>Product-specific helper functions</td>
                    </tr>
                    <tr>
                        <td><code>auth-token.ts</code></td>
                        <td>0.8 KB</td>
                        <td>Token-based authentication</td>
                    </tr>
                    <tr>
                        <td><code>auth-middleware.ts</code></td>
                        <td>0.8 KB</td>
                        <td>Session-based authentication</td>
                    </tr>
                    <tr>
                        <td><code>scrape-only.ts</code></td>
                        <td>1.5 KB</td>
                        <td>Scraping-only mode middleware</td>
                    </tr>
                </tbody>
            </table>

            <h3>Utility Modules</h3>

            <ul>
                <li><strong>config.ts:</strong> Environment configuration with Zod validation (80+ config values)</li>
                <li><strong>encrypto.ts:</strong> AES-256-CBC encryption/decryption for sensitive data</li>
                <li><strong>error-middleware.ts:</strong> Global error handling</li>
                <li><strong>session-helper.ts:</strong> Session management utilities</li>
                <li><strong>cache-helper.ts:</strong> Cache operations helper</li>
                <li><strong>http-wrappers.ts:</strong> HTTP request wrappers</li>
            </ul>

            <h3>Cache Client</h3>

            <p><strong>cacheClient.ts:</strong> Valkey/Redis client abstraction with connection pooling and error handling</p>
        </div>

        <div id="api-endpoints" class="section">
            <h2>7. API Endpoints & Routes</h2>

            <h3>Route Organization</h3>

            <p>Routes are organized by functional domain with modular router composition:</p>

            <pre><code>// Main Router (routes/index.ts)
router.use(userRouter);              // Authentication & user management
router.use('/productV2', productV2Router);
router.use('/v2-algo', v2AlgoRouter);
router.use('/masteritem', productRouter);
router.use('/dashboard', cronLogsRouter);
router.use('/help', helpRouter);
router.use('/scrape', scrapeRouter);
router.use('/cronSettings', cronSettingsRouter);
router.use('/admin', adminRouter);
router.use('/config', configRouter);
router.use('/history', historyRouter);
router.use('/cache', cacheRouter);
router.use('/debug', debugRouter);
router.use('/report', reportRouter);
router.use('/play', playRouter);
router.use('/filter', cronFilterRouter);
router.use('/monitor', monitorRouter);
router.use('/app-log', appLogRouter);
router.use(storageSenseController);
router.use(notifyController);
router.use(ipHealthController);
router.use(monitorSenseController);</code></pre>

            <h3>Key Endpoint Categories</h3>

            <h4>1. V2 Algorithm Endpoints (<code>/v2-algo</code>)</h4>

            <table>
                <thead>
                    <tr>
                        <th>Method</th>
                        <th>Path</th>
                        <th>Description</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>GET</td>
                        <td><code>/v2-algo/results/:mpId</code></td>
                        <td>Get algorithm results with execution data</td>
                    </tr>
                    <tr>
                        <td>GET</td>
                        <td><code>/v2-algo/settings/:mpId</code></td>
                        <td>Get V2 algorithm settings for product</td>
                    </tr>
                    <tr>
                        <td>PUT</td>
                        <td><code>/v2-algo/settings/:mpId</code></td>
                        <td>Update V2 algorithm settings</td>
                    </tr>
                    <tr>
                        <td>GET</td>
                        <td><code>/v2-algo/errors</code></td>
                        <td>Get all V2 algorithm errors</td>
                    </tr>
                    <tr>
                        <td>PUT</td>
                        <td><code>/v2-algo/execution-mode/:mpId</code></td>
                        <td>Update algorithm execution mode</td>
                    </tr>
                    <tr>
                        <td>GET</td>
                        <td><code>/v2-algo/execution-mode/:mpId</code></td>
                        <td>Get current execution mode</td>
                    </tr>
                    <tr>
                        <td>POST</td>
                        <td><code>/v2-algo/sync-vendor/:mpId</code></td>
                        <td>Sync vendor settings for product</td>
                    </tr>
                    <tr>
                        <td>POST</td>
                        <td><code>/v2-algo/sync-all-vendors</code></td>
                        <td>Sync all vendor settings globally</td>
                    </tr>
                    <tr>
                        <td>GET</td>
                        <td><code>/v2-algo/products-with-algo</code></td>
                        <td>Get all products with algo data (cached)</td>
                    </tr>
                    <tr>
                        <td>PUT</td>
                        <td><code>/v2-algo/toggle-enabled/:mpId/:vendorId</code></td>
                        <td>Toggle algorithm enabled status</td>
                    </tr>
                    <tr>
                        <td>GET</td>
                        <td><code>/v2-algo/net32-url/:mpId</code></td>
                        <td>Get Net32 product URL</td>
                    </tr>
                </tbody>
            </table>

            <h4>2. Product Management (<code>/masteritem</code>, <code>/productV2</code>)</h4>

            <ul>
                <li>Product listing with pagination and filtering</li>
                <li>Add/Edit/Delete product operations</li>
                <li>Excel data import (<code>POST /masteritem/sync_excel_data</code>)</li>
                <li>Bulk product updates</li>
                <li>Tag-based search</li>
            </ul>

            <h4>3. Cron Management (<code>/cronSettings</code>, <code>/dashboard</code>)</h4>

            <ul>
                <li>Cron configuration CRUD</li>
                <li>Cron execution logs with filtering</li>
                <li>Start/Stop/Recreate cron jobs</li>
                <li>Cron status monitoring</li>
                <li>Filter cron and slow cron management</li>
            </ul>

            <h4>4. Scraping Operations (<code>/scrape</code>)</h4>

            <ul>
                <li>Scrape product list management</li>
                <li>Scraping execution and logs</li>
                <li>Proxy provider configuration</li>
                <li>Scraping status monitoring</li>
            </ul>

            <h4>5. Monitoring & Health (<code>/monitor</code>)</h4>

            <ul>
                <li><code>GET /health</code> - Basic health check</li>
                <li>Storage monitoring endpoints</li>
                <li>IP health checks</li>
                <li>System metrics</li>
            </ul>

            <h4>6. Debug & Diagnostics (<code>/debug</code>)</h4>

            <ul>
                <li>Data inspection endpoints</li>
                <li>Filter testing</li>
                <li>422 error analysis</li>
                <li>Proxy provider diagnostics</li>
            </ul>

            <h4>7. History & Reporting (<code>/history</code>, <code>/report</code>)</h4>

            <ul>
                <li>Historical data queries</li>
                <li>Export to Excel/CSV</li>
                <li>Download history files</li>
                <li>Report generation</li>
            </ul>

            <h4>8. Configuration (<code>/config</code>, <code>/cache</code>)</h4>

            <ul>
                <li>System configuration management</li>
                <li>Environment settings</li>
                <li>Cache operations and invalidation</li>
            </ul>

            <h4>9. Authentication (<code>/user</code>)</h4>

            <ul>
                <li>Login/Logout</li>
                <li>User creation</li>
                <li>Session management</li>
                <li>Role-based access control</li>
            </ul>

            <h3>Special Routes</h3>

            <ul>
                <li><code>GET /vite*splat</code> - Vite development server proxy</li>
                <li><code>GET /health</code> - Health check endpoint</li>
                <li><code>/public/images</code> - Static image serving</li>
                <li><code>/logo</code> - Excel upload logo serving</li>
            </ul>
        </div>

        <div id="integration" class="section">
            <h2>8. Integration Points</h2>

            <h3>External APIs</h3>

            <h4>Net32 API Integration</h4>

            <p><strong>Base URL:</strong> <code>https://api.net32.com</code></p>

            <table>
                <thead>
                    <tr>
                        <th>Endpoint</th>
                        <th>Purpose</th>
                        <th>Method</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><code>/products/offers/update</code></td>
                        <td>Update product prices</td>
                        <td>POST</td>
                    </tr>
                    <tr>
                        <td>Product scraping endpoints</td>
                        <td>Fetch competitor pricing</td>
                        <td>GET</td>
                    </tr>
                </tbody>
            </table>

            <p><strong>Authentication:</strong> SecretKey-based authentication with per-product keys stored in database</p>

            <p><strong>Error Handling:</strong></p>
            <ul>
                <li>422 errors logged separately in <code>422cronLogs</code> collection</li>
                <li>Retry logic via <code>axios-retry</code> (3 retries, exponential backoff)</li>
                <li>Invalid response tracking: "Error: Invalid response found in Net32 Api"</li>
            </ul>

            <h4>Postmark Email Service</h4>

            <ul>
                <li><strong>Package:</strong> postmark 4.0.5</li>
                <li><strong>Use Cases:</strong> User creation notifications, alerts, reports</li>
                <li><strong>Configuration:</strong> API key via environment variables</li>
            </ul>

            <h3>Internal Service Integrations</h3>

            <h4>Repricer Core API</h4>

            <p>Internal microservice communication for core repricing operations:</p>

            <table>
                <thead>
                    <tr>
                        <th>Endpoint</th>
                        <th>Purpose</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><code>/schedule/StartCronV3</code></td>
                        <td>Start all scheduled crons</td>
                    </tr>
                    <tr>
                        <td><code>/schedule/StartCron</code></td>
                        <td>Start specific cron</td>
                    </tr>
                    <tr>
                        <td><code>/schedule/StopCron</code></td>
                        <td>Stop specific cron</td>
                    </tr>
                    <tr>
                        <td><code>/schedule/RecreateCron</code></td>
                        <td>Recreate cron job</td>
                    </tr>
                    <tr>
                        <td><code>/schedule/StopAll</code></td>
                        <td>Stop all crons</td>
                    </tr>
                    <tr>
                        <td><code>/schedule/startOverride</code></td>
                        <td>Override run execution</td>
                    </tr>
                    <tr>
                        <td><code>/schedule/start_specific_cron</code></td>
                        <td>Run specific cron by ID</td>
                    </tr>
                    <tr>
                        <td><code>/search/RepriceProduct/</code></td>
                        <td>Own vendor repricing</td>
                    </tr>
                    <tr>
                        <td><code>/product/updateManualProd/</code></td>
                        <td>Manual product update</td>
                    </tr>
                    <tr>
                        <td><code>/repricer/V2AlgoTest</code></td>
                        <td>V2 algorithm simulation</td>
                    </tr>
                    <tr>
                        <td><code>/repricer/ManualUpdate</code></td>
                        <td>Manual repricing trigger</td>
                    </tr>
                    <tr>
                        <td><code>/feed/RepriceProduct/</code></td>
                        <td>Feed-based repricing</td>
                    </tr>
                </tbody>
            </table>

            <h3>Database Connections</h3>

            <h4>MySQL Connection</h4>

            <pre><code>// Via Knex.js
const knex = require('knex')({
  client: 'mysql2',
  connection: {
    host: process.env.MYSQL_HOST,
    port: process.env.MYSQL_PORT,
    user: process.env.MYSQL_USER,
    password: process.env.MYSQL_PASSWORD,
    database: process.env.MYSQL_DATABASE
  },
  pool: { min: 0, max: 10 }
});</code></pre>

            <ul>
                <li><strong>Connection Pooling:</strong> 0-10 connections managed by Knex</li>
                <li><strong>Query Builder:</strong> Type-safe SQL queries via Knex</li>
                <li><strong>Stored Procedures:</strong> Direct SP calls via <code>knex.raw()</code></li>
            </ul>

            <h4>MongoDB Connection</h4>

            <pre><code>// Singleton pattern
const mongoClient = new MongoClient(mongoUrl);
await mongoClient.connect();
const mongoDb = mongoClient.db(dbName);</code></pre>

            <ul>
                <li><strong>Connection:</strong> Singleton connection with encrypted credentials</li>
                <li><strong>ODM:</strong> Mongoose for schema validation</li>
                <li><strong>Collections:</strong> 11+ collections for various data types</li>
            </ul>

            <h4>Cache Layer (Redis/Valkey)</h4>

            <pre><code>// Via ioredis and @valkey/client
const redis = new Redis({
  host: process.env.REDIS_HOST,
  port: process.env.REDIS_PORT,
  password: process.env.REDIS_PASSWORD
});</code></pre>

            <ul>
                <li><strong>Primary Use:</strong> Product data caching (10-minute TTL)</li>
                <li><strong>Cache Keys:</strong> Defined in <code>cacheKeyName.json</code></li>
                <li><strong>Invalidation:</strong> Manual via cache endpoints</li>
            </ul>

            <h3>File Transfer Integrations</h3>

            <h4>FTP Operations</h4>

            <ul>
                <li><strong>Package:</strong> basic-ftp 5.0.5, promise-ftp 1.3.5</li>
                <li><strong>Use Cases:</strong> File uploads/downloads for data exchange</li>
                <li><strong>Service:</strong> <code>services/ftp.ts</code></li>
            </ul>

            <h4>File Exports</h4>

            <ul>
                <li><strong>Excel:</strong> ExcelJS for .xlsx generation</li>
                <li><strong>CSV:</strong> json2csv for CSV exports</li>
                <li><strong>Base Path:</strong> <code>/repricer-api-core/history/</code></li>
            </ul>
        </div>

        <div id="configuration" class="section">
            <h2>9. Configuration Management</h2>

            <h3>Environment Configuration</h3>

            <p>Configuration is managed via environment variables with Zod schema validation (80+ settings):</p>

            <h4>Core Application Settings</h4>

            <table>
                <thead>
                    <tr>
                        <th>Variable</th>
                        <th>Default</th>
                        <th>Description</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><code>PORT</code></td>
                        <td>3000</td>
                        <td>HTTP server port</td>
                    </tr>
                    <tr>
                        <td><code>NODE_ENV</code></td>
                        <td>development</td>
                        <td>Environment mode</td>
                    </tr>
                    <tr>
                        <td><code>SESSION_SECRET</code></td>
                        <td>-</td>
                        <td>Session encryption key</td>
                    </tr>
                    <tr>
                        <td><code>REQUEST_LOGGING</code></td>
                        <td>false</td>
                        <td>Enable Morgan logging</td>
                    </tr>
                </tbody>
            </table>

            <h4>Database Configuration</h4>

            <table>
                <thead>
                    <tr>
                        <th>Variable</th>
                        <th>Default</th>
                        <th>Description</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><code>MANAGED_MONGO_URL</code></td>
                        <td>-</td>
                        <td>MongoDB connection string (encrypted password)</td>
                    </tr>
                    <tr>
                        <td><code>MANAGED_MONGO_PASSWORD</code></td>
                        <td>-</td>
                        <td>Encrypted MongoDB password</td>
                    </tr>
                    <tr>
                        <td><code>GET_REPRICER_DBNAME</code></td>
                        <td>repricer</td>
                        <td>Primary database name</td>
                    </tr>
                    <tr>
                        <td><code>REPRICER_ENCRYPTION_KEY</code></td>
                        <td>-</td>
                        <td>AES-256 encryption key</td>
                    </tr>
                </tbody>
            </table>

            <h4>Collection Names</h4>

            <ul>
                <li><code>GET_CRON_LOGS_COLLECTION_NAME</code> = "cronLogs"</li>
                <li><code>ITEMS_COLLECTION_NAME</code> = "items"</li>
                <li><code>CRON_SETTINGS_COLLECTION_NAME</code> = "cronSettings"</li>
                <li><code>FILTER_CRON_COLLECTION_NAME</code> = "filterCronSettings"</li>
                <li><code>SLOW_CRON_GROUP_COLLECTION_NAME</code> = "slowCronSettings"</li>
                <li><code>SCRAPE_ITEMS_COLLECTION</code> = "scrapeItems"</li>
                <li><code>ERROR_422_CRON_LOGS</code> = "422cronLogs"</li>
            </ul>

            <h4>Pagination & Limits</h4>

            <ul>
                <li><code>CRON_PAGESIZE</code> = 10</li>
                <li><code>HISTORY_LIMIT</code> = 50</li>
                <li><code>FILTER_CRON_LOGS_LIMIT</code> = 10</li>
            </ul>

            <h3>Resource Configuration Files</h3>

            <p>JSON configuration files in <code>resources/</code> directory:</p>

            <table>
                <thead>
                    <tr>
                        <th>File</th>
                        <th>Purpose</th>
                        <th>Contents</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><code>cronMapping.json</code></td>
                        <td>Cron ID to variable mapping</td>
                        <td>43 cron configurations (E1-E30, FC1-FC3, SCG1-SCG3, SOC1-SOC30)</td>
                    </tr>
                    <tr>
                        <td><code>badgeIndicatorMapping.json</code></td>
                        <td>Badge competition strategies</td>
                        <td>ALL_ZERO, ALL_PERCENTAGE, BADGE_ONLY, NON_BADGE_ONLY</td>
                    </tr>
                    <tr>
                        <td><code>HandlingTimeFilterMapping.json</code></td>
                        <td>Shipping time groupings</td>
                        <td>Handling time filter configurations</td>
                    </tr>
                    <tr>
                        <td><code>itemMapper.json</code></td>
                        <td>Item property mappings</td>
                        <td>Field transformation rules</td>
                    </tr>
                    <tr>
                        <td><code>apiMapping.json</code></td>
                        <td>API endpoint mappings</td>
                        <td>Internal API route configurations</td>
                    </tr>
                    <tr>
                        <td><code>serverIp.json</code></td>
                        <td>Server IP configurations</td>
                        <td>Proxy and server IP addresses</td>
                    </tr>
                    <tr>
                        <td><code>SecretKeyMapping.json</code></td>
                        <td>API key mappings</td>
                        <td>Product-specific API keys</td>
                    </tr>
                    <tr>
                        <td><code>cacheKeyName.json</code></td>
                        <td>Cache key definitions</td>
                        <td>Redis/Valkey key naming</td>
                    </tr>
                </tbody>
            </table>

            <h3>Cron Configuration</h3>

            <p>30+ distinct cron jobs configured via MongoDB <code>cronSettings</code> collection:</p>

            <h4>Cron Categories</h4>

            <ul>
                <li><strong>E1-E30:</strong> Standard execution crons (30 configurations)</li>
                <li><strong>FC1-FC3:</strong> Filter crons (3 configurations)</li>
                <li><strong>SCG1-SCG3:</strong> Slow cron groups (3 configurations)</li>
                <li><strong>SOC1-SOC30:</strong> Scrape-only crons (30 configurations)</li>
            </ul>

            <h4>Cron Settings Schema</h4>

            <pre><code>interface CronSettings {
  CronId: string;              // Unique identifier
  CronName: string;            // Display name
  CronStatus: boolean;         // Active/Inactive
  IsHidden: boolean;           // Visibility flag
  ProxyProvider: number;       // Primary proxy
  AlternateProxyProvider: number[]; // Fallback proxies
  UpdatedTime: Date;
  // ... audit fields
}</code></pre>

            <h3>Security Configuration</h3>

            <h4>Encryption</h4>

            <ul>
                <li><strong>Algorithm:</strong> AES-256-CBC</li>
                <li><strong>Key Derivation:</strong> SHA-256 hash of secret key</li>
                <li><strong>IV:</strong> 16-byte random initialization vector per encryption</li>
                <li><strong>Format:</strong> <code>base64(IV):base64(encrypted)</code></li>
            </ul>

            <h4>Password Hashing</h4>

            <ul>
                <li><strong>Algorithm:</strong> bcrypt</li>
                <li><strong>Rounds:</strong> Default 10 (configurable)</li>
                <li><strong>Usage:</strong> User password storage</li>
            </ul>

            <h4>Session Management</h4>

            <ul>
                <li><strong>Store:</strong> MemoryStore (24-hour check period)</li>
                <li><strong>Cookie:</strong> Signed with secret</li>
                <li><strong>Resave:</strong> false (session efficiency)</li>
                <li><strong>SaveUninitialized:</strong> false (GDPR compliance)</li>
            </ul>
        </div>

        <div id="deployment" class="section">
            <h2>10. Deployment & Operations</h2>

            <h3>Docker Deployment</h3>

            <h4>Dockerfile Configuration</h4>

            <pre><code># Multi-stage build optimized for production
FROM node:22-alpine

WORKDIR /app

# Copy all monorepo files
COPY . ./

# Install all dependencies at root level
RUN npm ci

# Build TypeScript to JavaScript
RUN npm run build

# Remove dev dependencies for smaller image
RUN npm prune --production

# Expose application port
EXPOSE 3000

# Set production environment
ENV NODE_ENV=production

# Navigate to app directory
WORKDIR /app/apps/repricer

# Start application
CMD ["npm", "start"]</code></pre>

            <h4>Docker Optimizations</h4>

            <ul>
                <li><strong>Base Image:</strong> node:22-alpine (minimal footprint)</li>
                <li><strong>Build:</strong> TypeScript compilation at build time</li>
                <li><strong>Dependencies:</strong> Production-only after build</li>
                <li><strong>Working Directory:</strong> Monorepo-aware structure</li>
            </ul>

            <h3>Build Process</h3>

            <pre><code>// package.json scripts
"scripts": {
  "dev": "ts-node-dev -r dotenv/config --respawn --transpile-only
          --ignore-watch node_modules src/server.ts",
  "build": "tsc",
  "start": "node dist/server.js",
  "debug": "cross-env NODE_OPTIONS=--inspect ts-node src/server.ts",
  "lint:ejs": "ejslint views",
  "format": "prettier --write \"**/*.{js,json,css,sql}\""
}</code></pre>

            <h4>Build Steps</h4>

            <ol>
                <li><strong>TypeScript Compilation:</strong> <code>tsc</code> compiles <code>src/</code> to <code>dist/</code></li>
                <li><strong>Source Maps:</strong> Generated for production debugging</li>
                <li><strong>Target:</strong> ES2020 with CommonJS modules</li>
                <li><strong>Strict Mode:</strong> Enabled for type safety</li>
            </ol>

            <h3>Production Configuration</h3>

            <h4>Environment Variables Required</h4>

            <div class="warning">
                <strong>Critical:</strong> The following environment variables must be set before deployment:
            </div>

            <ul>
                <li><code>MANAGED_MONGO_URL</code> - MongoDB connection string</li>
                <li><code>MANAGED_MONGO_PASSWORD</code> - Encrypted MongoDB password</li>
                <li><code>SESSION_SECRET</code> - Session encryption key</li>
                <li><code>REPRICER_ENCRYPTION_KEY</code> - Data encryption key</li>
                <li>MySQL connection parameters (host, port, user, password, database)</li>
                <li>Redis/Valkey connection parameters</li>
                <li>Net32 API credentials</li>
                <li>Postmark API key (if email enabled)</li>
            </ul>

            <h3>Performance Considerations</h3>

            <h4>Memory Management</h4>

            <ul>
                <li><strong>Development:</strong> <code>--max-old-space-size=4096</code> (4GB heap)</li>
                <li><strong>Production:</strong> Default Node.js limits (adjust via NODE_OPTIONS)</li>
                <li><strong>Caching:</strong> 10-minute TTL for product data cache</li>
            </ul>

            <h4>Database Pooling</h4>

            <ul>
                <li><strong>MySQL:</strong> 0-10 connections via Knex pool</li>
                <li><strong>MongoDB:</strong> Singleton connection pattern</li>
                <li><strong>Redis:</strong> ioredis connection pooling</li>
            </ul>

            <h4>Request Limits</h4>

            <ul>
                <li><strong>Body Size:</strong> 500MB limit for large Excel imports</li>
                <li><strong>URL Parameters:</strong> 10 million parameter limit</li>
                <li><strong>Pagination:</strong> Configurable page sizes (default 10)</li>
            </ul>

            <h3>Monitoring & Health Checks</h3>

            <h4>Health Endpoint</h4>

            <pre><code>GET /health
Response: { "status": "ok" }
Status Code: 200</code></pre>

            <h4>Startup Monitoring</h4>

            <ul>
                <li>Automatic cron scheduling on startup (<code>startAllMonitorCrons()</code>)</li>
                <li>Uncaught exception logging</li>
                <li>Unhandled rejection logging</li>
                <li>Version logging from package.json</li>
            </ul>

            <h4>Storage Monitoring</h4>

            <ul>
                <li>Disk space monitoring via <code>hdd-space</code> package</li>
                <li>Alert thresholds configurable</li>
                <li>Storage sense controller endpoints</li>
            </ul>

            <h4>Application Logging</h4>

            <ul>
                <li><strong>Request Logging:</strong> Morgan (combined format) if enabled</li>
                <li><strong>Cron Logs:</strong> MongoDB collection with filtering</li>
                <li><strong>Error Logs:</strong> Dedicated error collections</li>
                <li><strong>App Logs:</strong> Application-level logging with management endpoints</li>
            </ul>

            <h3>Operational Endpoints</h3>

            <table>
                <thead>
                    <tr>
                        <th>Endpoint</th>
                        <th>Purpose</th>
                        <th>Usage</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><code>GET /health</code></td>
                        <td>Health check</td>
                        <td>Load balancer / monitoring</td>
                    </tr>
                    <tr>
                        <td><code>GET /app/logs</code></td>
                        <td>View application logs</td>
                        <td>Debugging / diagnostics</td>
                    </tr>
                    <tr>
                        <td><code>POST /app/clear-logs</code></td>
                        <td>Clear log files</td>
                        <td>Maintenance</td>
                    </tr>
                    <tr>
                        <td><code>GET /storage-sense/*</code></td>
                        <td>Disk usage monitoring</td>
                        <td>Capacity planning</td>
                    </tr>
                    <tr>
                        <td><code>GET /ip-health/*</code></td>
                        <td>Proxy IP health checks</td>
                        <td>Proxy management</td>
                    </tr>
                    <tr>
                        <td><code>GET /monitor/*</code></td>
                        <td>System monitoring</td>
                        <td>Performance tracking</td>
                    </tr>
                </tbody>
            </table>

            <h3>Backup & Recovery</h3>

            <h4>Data Export</h4>

            <ul>
                <li><strong>Historical Data:</strong> Excel/CSV export via <code>/history</code> endpoints</li>
                <li><strong>Product Data:</strong> Excel bulk export functionality</li>
                <li><strong>Cron Logs:</strong> Filterable export with date ranges</li>
                <li><strong>Export Status:</strong> Tracked in <code>exportStatus</code> collection</li>
            </ul>

            <h4>Database Backups</h4>

            <ul>
                <li><strong>MySQL:</strong> Standard MySQL backup procedures (mysqldump, binary logs)</li>
                <li><strong>MongoDB:</strong> mongodump for full backups</li>
                <li><strong>Frequency:</strong> Define based on data criticality</li>
            </ul>

            <h3>Maintenance Windows</h3>

            <div class="info">
                <strong>Recommended Maintenance Schedule:</strong>
                <ul>
                    <li>Weekly: Log cleanup, cache invalidation</li>
                    <li>Monthly: Database optimization, index rebuilding</li>
                    <li>Quarterly: Dependency updates, security patches</li>
                </ul>
            </div>
        </div>

        <footer>
            <p>Generated: 2025-11-11 | Repricer Application Technical Documentation</p>
            <p>For questions or updates, contact the development team.</p>
        </footer>
    </div>
</body>
</html>