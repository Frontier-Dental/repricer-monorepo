<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>V1 Algorithm Rules Integration Guide - How Everything Works Together</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            line-height: 1.7;
            color: #2c3e50;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            box-shadow: 0 0 60px rgba(0,0,0,0.3);
        }

        header {
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
            color: white;
            padding: 4rem 3rem;
            position: relative;
            overflow: hidden;
        }

        header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%23ffffff' fill-opacity='0.05'%3E%3Cpath d='M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E");
            opacity: 0.5;
        }

        header h1 {
            font-size: 3rem;
            margin-bottom: 1rem;
            position: relative;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        header .subtitle {
            font-size: 1.4rem;
            opacity: 0.9;
            position: relative;
            max-width: 800px;
        }

        .header-badge {
            display: inline-block;
            background: linear-gradient(135deg, #f093fb, #f5576c);
            padding: 0.5rem 1.5rem;
            border-radius: 50px;
            font-size: 0.9rem;
            font-weight: 600;
            margin-top: 1.5rem;
            position: relative;
        }

        nav {
            background: #f8f9fa;
            padding: 1.5rem 2rem;
            border-bottom: 3px solid #e9ecef;
            position: sticky;
            top: 0;
            z-index: 100;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        nav h2 {
            font-size: 0.85rem;
            color: #6c757d;
            margin-bottom: 1rem;
            text-transform: uppercase;
            letter-spacing: 2px;
        }

        nav ul {
            list-style: none;
            display: flex;
            flex-wrap: wrap;
            gap: 0.75rem;
        }

        nav a {
            color: #495057;
            text-decoration: none;
            padding: 0.6rem 1.2rem;
            background: white;
            border-radius: 8px;
            border: 2px solid #e9ecef;
            transition: all 0.3s ease;
            font-weight: 500;
            font-size: 0.95rem;
        }

        nav a:hover {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border-color: transparent;
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
        }

        main {
            padding: 3rem;
        }

        section {
            margin-bottom: 4rem;
            background: white;
            border-radius: 16px;
            padding: 2.5rem;
            border: 1px solid #e9ecef;
            box-shadow: 0 4px 20px rgba(0,0,0,0.05);
        }

        h2 {
            color: #1a1a2e;
            font-size: 2.2rem;
            margin-bottom: 1.5rem;
            padding-bottom: 1rem;
            border-bottom: 4px solid;
            border-image: linear-gradient(135deg, #667eea, #764ba2) 1;
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        h3 {
            color: #16213e;
            font-size: 1.6rem;
            margin-top: 2.5rem;
            margin-bottom: 1.25rem;
        }

        h4 {
            color: #0f3460;
            font-size: 1.25rem;
            margin-top: 2rem;
            margin-bottom: 1rem;
        }

        p {
            margin-bottom: 1rem;
            color: #4a5568;
        }

        /* Pipeline Visualization */
        .pipeline {
            display: flex;
            flex-direction: column;
            gap: 0;
            margin: 2rem 0;
        }

        .pipeline-stage {
            background: linear-gradient(135deg, #f8f9fa, #e9ecef);
            border-radius: 12px;
            padding: 1.5rem 2rem;
            position: relative;
            border-left: 5px solid;
            margin-bottom: 0;
        }

        .pipeline-stage::after {
            content: '‚Üì';
            position: absolute;
            bottom: -28px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 1.5rem;
            color: #6c757d;
            z-index: 10;
        }

        .pipeline-stage:last-child::after {
            display: none;
        }

        .pipeline-stage.input { border-color: #17a2b8; }
        .pipeline-stage.filter { border-color: #ffc107; }
        .pipeline-stage.calculate { border-color: #28a745; }
        .pipeline-stage.rules { border-color: #dc3545; }
        .pipeline-stage.output { border-color: #6f42c1; }

        .pipeline-stage h4 {
            margin-top: 0;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .pipeline-stage .stage-badge {
            display: inline-block;
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 600;
            color: white;
        }

        .input .stage-badge { background: #17a2b8; }
        .filter .stage-badge { background: #ffc107; color: #333; }
        .calculate .stage-badge { background: #28a745; }
        .rules .stage-badge { background: #dc3545; }
        .output .stage-badge { background: #6f42c1; }

        /* Example Cards */
        .example-card {
            background: linear-gradient(135deg, #fafbfc, #f0f4f8);
            border-radius: 16px;
            padding: 2rem;
            margin: 2rem 0;
            border: 2px solid #e2e8f0;
            position: relative;
            overflow: hidden;
        }

        .example-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 6px;
            background: linear-gradient(135deg, #667eea, #764ba2);
        }

        .example-header {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-bottom: 1.5rem;
        }

        .example-number {
            width: 50px;
            height: 50px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            font-weight: bold;
            flex-shrink: 0;
        }

        .example-title {
            font-size: 1.4rem;
            font-weight: 700;
            color: #1a1a2e;
        }

        .example-subtitle {
            font-size: 0.95rem;
            color: #6c757d;
        }

        .scenario-box {
            background: white;
            border-radius: 12px;
            padding: 1.5rem;
            margin: 1rem 0;
            border: 1px solid #e2e8f0;
        }

        .scenario-box h5 {
            color: #4a5568;
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .data-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
        }

        .data-item {
            display: flex;
            justify-content: space-between;
            padding: 0.5rem 0;
            border-bottom: 1px dashed #e2e8f0;
        }

        .data-item:last-child {
            border-bottom: none;
        }

        .data-label {
            font-weight: 500;
            color: #4a5568;
        }

        .data-value {
            font-family: 'SF Mono', 'Fira Code', monospace;
            color: #1a1a2e;
            font-weight: 600;
        }

        /* Step by Step */
        .step-list {
            list-style: none;
            margin: 1.5rem 0;
        }

        .step-item {
            display: flex;
            gap: 1rem;
            margin-bottom: 1rem;
            padding: 1rem;
            background: white;
            border-radius: 10px;
            border: 1px solid #e2e8f0;
            transition: all 0.3s ease;
        }

        .step-item:hover {
            border-color: #667eea;
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.15);
        }

        .step-number {
            width: 32px;
            height: 32px;
            background: #e9ecef;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            color: #495057;
            flex-shrink: 0;
        }

        .step-item.pass .step-number {
            background: #d4edda;
            color: #155724;
        }

        .step-item.blocked .step-number {
            background: #f8d7da;
            color: #721c24;
        }

        .step-item.modified .step-number {
            background: #fff3cd;
            color: #856404;
        }

        .step-content {
            flex: 1;
        }

        .step-rule {
            font-weight: 600;
            color: #1a1a2e;
            margin-bottom: 0.25rem;
        }

        .step-detail {
            color: #6c757d;
            font-size: 0.95rem;
        }

        .step-result {
            font-family: 'SF Mono', 'Fira Code', monospace;
            padding: 0.25rem 0.5rem;
            border-radius: 4px;
            font-size: 0.85rem;
            margin-top: 0.5rem;
            display: inline-block;
        }

        .step-result.pass {
            background: #d4edda;
            color: #155724;
        }

        .step-result.blocked {
            background: #f8d7da;
            color: #721c24;
        }

        .step-result.modified {
            background: #fff3cd;
            color: #856404;
        }

        /* Result Box */
        .result-box {
            background: linear-gradient(135deg, #1a1a2e, #16213e);
            color: white;
            border-radius: 12px;
            padding: 1.5rem 2rem;
            margin-top: 1.5rem;
            display: flex;
            align-items: center;
            justify-content: space-between;
            flex-wrap: wrap;
            gap: 1rem;
        }

        .result-label {
            font-size: 1rem;
            opacity: 0.9;
        }

        .result-price {
            font-size: 2rem;
            font-weight: 700;
        }

        .result-tag {
            background: rgba(255,255,255,0.2);
            padding: 0.5rem 1rem;
            border-radius: 20px;
            font-size: 0.85rem;
        }

        /* Rule Reference Cards */
        .rule-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1.5rem;
            margin: 2rem 0;
        }

        .rule-card {
            background: white;
            border-radius: 12px;
            padding: 1.5rem;
            border: 2px solid #e9ecef;
            transition: all 0.3s ease;
        }

        .rule-card:hover {
            border-color: #667eea;
            transform: translateY(-4px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
        }

        .rule-card .rule-num {
            display: inline-block;
            width: 36px;
            height: 36px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border-radius: 50%;
            text-align: center;
            line-height: 36px;
            font-weight: bold;
            margin-bottom: 1rem;
        }

        .rule-card h4 {
            margin-top: 0;
            color: #1a1a2e;
            font-size: 1.1rem;
        }

        .rule-card .rule-action {
            display: inline-block;
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 600;
            margin-top: 0.5rem;
        }

        .rule-action.blocks { background: #f8d7da; color: #721c24; }
        .rule-action.modifies { background: #fff3cd; color: #856404; }
        .rule-action.tags { background: #d1ecf1; color: #0c5460; }

        /* Interaction Matrix */
        .matrix-table {
            width: 100%;
            border-collapse: collapse;
            margin: 2rem 0;
            font-size: 0.9rem;
        }

        .matrix-table th {
            background: linear-gradient(135deg, #1a1a2e, #16213e);
            color: white;
            padding: 1rem;
            text-align: left;
        }

        .matrix-table td {
            padding: 1rem;
            border-bottom: 1px solid #e9ecef;
            vertical-align: top;
        }

        .matrix-table tr:hover {
            background: #f8f9fa;
        }

        .matrix-table .setting-name {
            font-weight: 600;
            color: #1a1a2e;
            white-space: nowrap;
        }

        .matrix-table .affects {
            color: #dc3545;
            font-size: 0.85rem;
        }

        .matrix-table .requires {
            color: #28a745;
            font-size: 0.85rem;
        }

        /* Decision Tree */
        .decision-tree {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 2rem;
            margin: 2rem 0;
            font-family: 'SF Mono', 'Fira Code', monospace;
            font-size: 0.9rem;
            overflow-x: auto;
        }

        .decision-tree pre {
            margin: 0;
            white-space: pre;
            color: #1a1a2e;
        }

        /* Alert Boxes */
        .alert {
            padding: 1.25rem 1.5rem;
            border-radius: 10px;
            margin: 1.5rem 0;
            border-left: 5px solid;
        }

        .alert-insight {
            background: linear-gradient(135deg, #e8f4f8, #d1ecf1);
            border-color: #17a2b8;
        }

        .alert-warning {
            background: linear-gradient(135deg, #fff8e1, #fff3cd);
            border-color: #ffc107;
        }

        .alert-critical {
            background: linear-gradient(135deg, #fce4e4, #f8d7da);
            border-color: #dc3545;
        }

        .alert-success {
            background: linear-gradient(135deg, #e8f5e9, #d4edda);
            border-color: #28a745;
        }

        .alert strong {
            display: block;
            margin-bottom: 0.5rem;
            color: #1a1a2e;
        }

        /* Code Blocks */
        .code-block {
            background: #1a1a2e;
            color: #e9ecef;
            padding: 1.5rem;
            border-radius: 10px;
            overflow-x: auto;
            margin: 1rem 0;
            font-family: 'SF Mono', 'Fira Code', monospace;
            font-size: 0.9rem;
        }

        .code-block .comment {
            color: #6c757d;
        }

        .code-block .keyword {
            color: #f093fb;
        }

        .code-block .value {
            color: #56ab2f;
        }

        .code-block .highlight {
            background: rgba(102, 126, 234, 0.3);
            padding: 0.1rem 0.3rem;
            border-radius: 3px;
        }

        /* Summary Cards */
        .summary-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            margin: 2rem 0;
        }

        .summary-card {
            background: white;
            border-radius: 12px;
            padding: 1.5rem;
            text-align: center;
            border: 2px solid #e9ecef;
            transition: all 0.3s ease;
        }

        .summary-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
        }

        .summary-icon {
            font-size: 2.5rem;
            margin-bottom: 1rem;
        }

        .summary-value {
            font-size: 2rem;
            font-weight: 700;
            color: #1a1a2e;
        }

        .summary-label {
            color: #6c757d;
            font-size: 0.9rem;
        }

        /* Footer */
        footer {
            background: linear-gradient(135deg, #1a1a2e, #16213e);
            color: white;
            padding: 3rem;
            text-align: center;
        }

        footer a {
            color: #667eea;
            text-decoration: none;
        }

        footer a:hover {
            text-decoration: underline;
        }

        /* Responsive */
        @media (max-width: 768px) {
            header {
                padding: 2rem 1.5rem;
            }

            header h1 {
                font-size: 2rem;
            }

            main {
                padding: 1.5rem;
            }

            section {
                padding: 1.5rem;
            }

            h2 {
                font-size: 1.75rem;
            }

            nav ul {
                gap: 0.5rem;
            }

            nav a {
                padding: 0.5rem 0.75rem;
                font-size: 0.85rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>V1 Algorithm Rules Integration Guide</h1>
            <p class="subtitle">A comprehensive deep-dive into how the 24 settings and 12 business rules work together to make pricing decisions. Complete with step-by-step examples and visual decision flows.</p>
            <span class="header-badge">Complete Integration Reference</span>
        </header>

        <nav>
            <h2>Quick Navigation</h2>
            <ul>
                <li><a href="#overview">System Overview</a></li>
                <li><a href="#pipeline">The Pipeline Model</a></li>
                <li><a href="#rules-reference">Rules Reference</a></li>
                <li><a href="#interactions">Setting Interactions</a></li>
                <li><a href="#examples">Complete Examples</a></li>
                <li><a href="#decision-trees">Decision Trees</a></li>
                <li><a href="#edge-cases">Edge Cases</a></li>
                <li><a href="#insights">Key Insights</a></li>
            </ul>
        </nav>

        <main>
            <!-- SECTION: System Overview -->
            <section id="overview">
                <h2>System Overview</h2>

                <p>The V1 repricing algorithm is a <strong>pipeline-based decision engine</strong> that processes pricing decisions through multiple stages. Understanding how these stages interact is crucial for effective configuration.</p>

                <div class="summary-grid">
                    <div class="summary-card">
                        <div class="summary-icon">‚öôÔ∏è</div>
                        <div class="summary-value">24</div>
                        <div class="summary-label">Configuration Settings</div>
                    </div>
                    <div class="summary-card">
                        <div class="summary-icon">üìã</div>
                        <div class="summary-value">13</div>
                        <div class="summary-label">Business Rules</div>
                    </div>
                    <div class="summary-card">
                        <div class="summary-icon">üîÑ</div>
                        <div class="summary-value">5</div>
                        <div class="summary-label">Pipeline Stages</div>
                    </div>
                    <div class="summary-card">
                        <div class="summary-icon">üìÅ</div>
                        <div class="summary-value">5,103</div>
                        <div class="summary-label">Lines of Code</div>
                    </div>
                </div>

                <div class="alert alert-insight">
                    <strong>Core Principle: Rules are Applied Sequentially</strong>
                    The algorithm calculates an initial price, then passes it through 13 rules in order (ApplyMultiPriceBreakRule runs twice). Each rule can APPROVE (pass through), MODIFY (change the price), or BLOCK (prevent the change entirely). Understanding this sequence is the key to mastering V1 configuration.
                </div>

                <h3>The Three Types of Rule Actions</h3>

                <div class="rule-grid">
                    <div class="rule-card">
                        <h4>BLOCKING Rules</h4>
                        <span class="rule-action blocks">BLOCKS</span>
                        <p style="margin-top: 1rem; color: #6c757d;">Completely prevent a price change from happening. The price stays at its current value.</p>
                        <p style="font-size: 0.9rem; color: #495057;"><strong>Examples:</strong> ApplyRule (direction), ApplyFloorCheckRule, ApplyBuyBoxRule, ApplyKeepPositionLogic</p>
                    </div>
                    <div class="rule-card">
                        <h4>MODIFYING Rules</h4>
                        <span class="rule-action modifies">MODIFIES</span>
                        <p style="margin-top: 1rem; color: #6c757d;">Adjust the calculated price to a different value before continuing.</p>
                        <p style="font-size: 0.9rem; color: #495057;"><strong>Examples:</strong> ApplyMultiPriceBreakRule, ApplyRepriceDownBadgeCheckRule, ApplySisterComparisonCheck</p>
                    </div>
                    <div class="rule-card">
                        <h4>TAGGING Rules</h4>
                        <span class="rule-action tags">TAGS</span>
                        <p style="margin-top: 1rem; color: #6c757d;">Add metadata/tags to the execution log without changing the price.</p>
                        <p style="font-size: 0.9rem; color: #495057;"><strong>Examples:</strong> AppendNewPriceBreakActivation</p>
                    </div>
                </div>
            </section>

            <!-- SECTION: Pipeline Model -->
            <section id="pipeline">
                <h2>The Pipeline Model</h2>

                <p>Every pricing decision flows through these five stages in order. Understanding this flow helps you predict exactly what the algorithm will do.</p>

                <div class="pipeline">
                    <div class="pipeline-stage input">
                        <h4><span class="stage-badge">STAGE 1</span> Input Layer</h4>
                        <p>Gather all necessary data for the pricing decision.</p>
                        <div class="data-grid" style="margin-top: 1rem;">
                            <div>
                                <strong>Product Data:</strong> Current prices (Q1, Q5, Q10), your vendor ID, current position
                            </div>
                            <div>
                                <strong>Competitor Data:</strong> All vendor prices, badges, inventory, handling times, shipping costs
                            </div>
                            <div>
                                <strong>Settings:</strong> All 24 configuration fields from the product/vendor settings
                            </div>
                        </div>
                    </div>

                    <div class="pipeline-stage filter">
                        <h4><span class="stage-badge">STAGE 2</span> Filter Layer</h4>
                        <p>Reduce the competitor set based on configuration.</p>
                        <div class="code-block">
<span class="comment">// Filter chain (applied in order)</span>
All Competitors
  ‚Üí <span class="keyword">excludedVendors</span>: Remove sister vendor IDs
  ‚Üí <span class="keyword">badgeIndicator</span>: ALL or BADGE_ONLY filter
  ‚Üí <span class="keyword">inventoryThreshold</span>: Remove low-stock vendors
  ‚Üí <span class="keyword">handlingTimeFilter</span>: Remove slow shippers
  ‚Üí Filtered Competitor Set</div>
                    </div>

                    <div class="pipeline-stage calculate">
                        <h4><span class="stage-badge">STAGE 3</span> Calculation Layer</h4>
                        <p>Determine the raw competitive price.</p>
                        <div class="code-block">
<span class="comment">// Price calculation logic</span>
<span class="keyword">IF</span> competeWithNext = <span class="value">true</span>
  ‚Üí Target = next vendor in rank (not lowest)
<span class="keyword">ELSE</span>
  ‚Üí Target = lowest price competitor

<span class="keyword">IF</span> is_nc_needed = <span class="value">true</span>
  ‚Üí Compare (unit + shipping) totals <span class="comment">// NC Mode</span>
<span class="keyword">ELSE</span>
  ‚Üí Compare unit prices only <span class="comment">// Standard Mode</span>

Raw Price = Target Price - (Target √ó percentageDown)</div>
                    </div>

                    <div class="pipeline-stage rules">
                        <h4><span class="stage-badge">STAGE 4</span> Rules Application Layer</h4>
                        <p>Apply 13 business rules in sequence to refine/block the price. <strong>Note:</strong> ApplyMultiPriceBreakRule is applied twice.</p>
                        <div class="code-block">
<span class="comment">// Rules applied in order (actual algo-v1.ts sequence)</span>
Rule 1: <span class="keyword">ApplyRule()</span> ‚Üí Direction check (UP_ONLY/DOWN_ONLY/BOTH)
Rule 2: <span class="keyword">ApplyDeactivateQPriceBreakRule()</span> ‚Üí Prevent Q break deactivation
Rule 3: <span class="keyword">ApplyMultiPriceBreakRule()</span> ‚Üí Q hierarchy (1st pass)
Rule 4: <span class="keyword">ApplyBeatQPriceRule()</span> ‚Üí Q1 protection
Rule 5: <span class="keyword">ApplyPercentagePriceRule()</span> ‚Üí Increase threshold
Rule 6: <span class="keyword">ApplyBuyBoxRule()</span> ‚Üí Own vendor protection
Rule 7: <span class="keyword">ApplyKeepPositionLogic()</span> ‚Üí Rank maintenance
Rule 8: <span class="keyword">ApplySuppressPriceBreakRule()</span> ‚Üí Q1 only mode
Rule 9: <span class="keyword">ApplyFloorCheckRule()</span> ‚Üí Minimum price BLOCK
Rule 10: <span class="keyword">ApplyRepriceDownBadgeCheckRule()</span> ‚Üí Badge pricing
Rule 11: <span class="keyword">ApplyMultiPriceBreakRule()</span> ‚Üí Q hierarchy (2nd pass)
Rule 12: <span class="keyword">AppendNewPriceBreakActivation()</span> ‚Üí #NEW tagging
Rule 13: <span class="keyword">ApplySisterComparisonCheck()</span> ‚Üí Differentiation</div>
                    </div>

                    <div class="pipeline-stage output">
                        <h4><span class="stage-badge">STAGE 5</span> Output Layer</h4>
                        <p>Final pricing decision and execution logging.</p>
                        <div class="data-grid" style="margin-top: 1rem;">
                            <div>
                                <strong>If APPROVED:</strong> New price is set, execution log records the change
                            </div>
                            <div>
                                <strong>If BLOCKED:</strong> Price stays same, log records "IGNORED_[REASON]"
                            </div>
                            <div>
                                <strong>If MODIFIED:</strong> Adjusted price is set, log records modification reason
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- SECTION: Rules Reference -->
            <section id="rules-reference">
                <h2>Rules Reference</h2>

                <p>Each rule serves a specific purpose in the pricing decision chain. Here's a detailed reference for all 13 rules (including ApplyMultiPriceBreakRule which runs twice).</p>

                <div class="rule-grid">
                    <div class="rule-card">
                        <span class="rule-num">1</span>
                        <h4>ApplyRule()</h4>
                        <span class="rule-action blocks">BLOCKS</span>
                        <p style="margin-top: 0.75rem; color: #6c757d; font-size: 0.9rem;">
                            <strong>Setting:</strong> repricingRule (0/1/2)<br>
                            <strong>Logic:</strong> If rule=0 (Up Only), blocks decreases. If rule=1 (Down Only), blocks increases.<br>
                            <strong>Tag:</strong> "IGNORED_UP_REPRICE_RULE" or "IGNORED_DOWN_REPRICE_RULE"
                        </p>
                    </div>

                    <div class="rule-card">
                        <span class="rule-num">2</span>
                        <h4>ApplyDeactivateQPriceBreakRule()</h4>
                        <span class="rule-action blocks">BLOCKS</span>
                        <p style="margin-top: 0.75rem; color: #6c757d; font-size: 0.9rem;">
                            <strong>Setting:</strong> abortDeactivatingQPriceBreak<br>
                            <strong>Logic:</strong> When true, prevents Q break deactivation from subsequent rules<br>
                            <strong>Tag:</strong> "ABORT_DEACTIVATION"
                        </p>
                    </div>

                    <div class="rule-card">
                        <span class="rule-num">3</span>
                        <h4>ApplyMultiPriceBreakRule() [1st pass]</h4>
                        <span class="rule-action modifies">MODIFIES</span>
                        <p style="margin-top: 0.75rem; color: #6c757d; font-size: 0.9rem;">
                            <strong>Setting:</strong> Automatic (always active)<br>
                            <strong>Logic:</strong> Ensures Q1 &gt; Q5 &gt; Q10 per-unit pricing. Deactivates violating breaks.<br>
                            <strong>Tag:</strong> "DEACTIVATED_Q[X]"
                        </p>
                    </div>

                    <div class="rule-card">
                        <span class="rule-num">4</span>
                        <h4>ApplyBeatQPriceRule()</h4>
                        <span class="rule-action blocks">BLOCKS</span>
                        <p style="margin-top: 0.75rem; color: #6c757d; font-size: 0.9rem;">
                            <strong>Setting:</strong> beatQPrice<br>
                            <strong>Logic:</strong> Protects Q1 from being beaten by competitor Q1 pricing<br>
                            <strong>Tag:</strong> "BEAT_Q_PRICE_PROTECTED"
                        </p>
                    </div>

                    <div class="rule-card">
                        <span class="rule-num">5</span>
                        <h4>ApplyPercentagePriceRule()</h4>
                        <span class="rule-action blocks">BLOCKS</span>
                        <p style="margin-top: 0.75rem; color: #6c757d; font-size: 0.9rem;">
                            <strong>Setting:</strong> percentageIncrease<br>
                            <strong>Logic:</strong> Blocks if price increase doesn't meet percentageIncrease threshold<br>
                            <strong>Tag:</strong> "PERCENTAGE_RULE_BLOCKED"
                        </p>
                    </div>

                    <div class="rule-card">
                        <span class="rule-num">6</span>
                        <h4>ApplyBuyBoxRule()</h4>
                        <span class="rule-action blocks">BLOCKS</span>
                        <p style="margin-top: 0.75rem; color: #6c757d; font-size: 0.9rem;">
                            <strong>Setting:</strong> applyBuyBoxLogic<br>
                            <strong>Logic:</strong> Blocks decrease when first competitor is one of our vendor IDs (17357, 20722, 20755, 20533, 20727, 5)<br>
                            <strong>Tag:</strong> "IGNORED_BUYBOX_RULE"
                        </p>
                    </div>

                    <div class="rule-card">
                        <span class="rule-num">7</span>
                        <h4>ApplyKeepPositionLogic()</h4>
                        <span class="rule-action blocks">BLOCKS</span>
                        <p style="margin-top: 0.75rem; color: #6c757d; font-size: 0.9rem;">
                            <strong>Setting:</strong> keepPosition<br>
                            <strong>Logic:</strong> Won't drop price to beat vendors ranked below you<br>
                            <strong>Tag:</strong> "KEEP_POSITION_APPLIED"
                        </p>
                    </div>

                    <div class="rule-card">
                        <span class="rule-num">8</span>
                        <h4>ApplySuppressPriceBreakRule()</h4>
                        <span class="rule-action blocks">BLOCKS</span>
                        <p style="margin-top: 0.75rem; color: #6c757d; font-size: 0.9rem;">
                            <strong>Setting:</strong> suppressPriceBreakForOne<br>
                            <strong>Logic:</strong> When true, only Q1 changes. Q2+ stay at current values.<br>
                            <strong>Tag:</strong> "SUPPRESS_PRICE_BREAK"
                        </p>
                    </div>

                    <div class="rule-card">
                        <span class="rule-num">9</span>
                        <h4>ApplyFloorCheckRule()</h4>
                        <span class="rule-action blocks">BLOCKS</span>
                        <p style="margin-top: 0.75rem; color: #6c757d; font-size: 0.9rem;">
                            <strong>Setting:</strong> floorPrice<br>
                            <strong>Logic:</strong> If calculated price &lt;= floor, BLOCKS change (sets newPrice = "N/A")<br>
                            <strong>Tag:</strong> "IGNORE_LOGIC_FAULT"
                        </p>
                    </div>

                    <div class="rule-card">
                        <span class="rule-num">10</span>
                        <h4>ApplyRepriceDownBadgeCheckRule()</h4>
                        <span class="rule-action modifies">MODIFIES</span>
                        <p style="margin-top: 0.75rem; color: #6c757d; font-size: 0.9rem;">
                            <strong>Setting:</strong> badgePercentageDown<br>
                            <strong>Logic:</strong> Applies badge-specific undercut percentage<br>
                            <strong>Tag:</strong> "BADGE_PERCENTAGE_APPLIED"
                        </p>
                    </div>

                    <div class="rule-card">
                        <span class="rule-num">11</span>
                        <h4>ApplyMultiPriceBreakRule() [2nd pass]</h4>
                        <span class="rule-action modifies">MODIFIES</span>
                        <p style="margin-top: 0.75rem; color: #6c757d; font-size: 0.9rem;">
                            <strong>Setting:</strong> Automatic (always active)<br>
                            <strong>Logic:</strong> Re-checks Q hierarchy after badge pricing adjustments<br>
                            <strong>Tag:</strong> "DEACTIVATED_Q[X]"
                        </p>
                    </div>

                    <div class="rule-card">
                        <span class="rule-num">12</span>
                        <h4>AppendNewPriceBreakActivation()</h4>
                        <span class="rule-action tags">TAGS</span>
                        <p style="margin-top: 0.75rem; color: #6c757d; font-size: 0.9rem;">
                            <strong>Setting:</strong> Automatic (always active)<br>
                            <strong>Logic:</strong> Adds $NEW tag when activating previously inactive breaks<br>
                            <strong>Tag:</strong> "$NEW"
                        </p>
                    </div>

                    <div class="rule-card">
                        <span class="rule-num">13</span>
                        <h4>ApplySisterComparisonCheck()</h4>
                        <span class="rule-action modifies">MODIFIES</span>
                        <p style="margin-top: 0.75rem; color: #6c757d; font-size: 0.9rem;">
                            <strong>Setting:</strong> competeAll=false + excludedVendors<br>
                            <strong>Logic:</strong> Ensures price differs from sisters by OFFSET ($0.01)<br>
                            <strong>Tag:</strong> "SISTER_DIFFERENTIATION"
                        </p>
                    </div>
                </div>
            </section>

            <!-- SECTION: Setting Interactions -->
            <section id="interactions">
                <h2>Setting Interactions Matrix</h2>

                <p>Some settings work together, others conflict. This matrix shows the key interactions you need to understand.</p>

                <table class="matrix-table">
                    <thead>
                        <tr>
                            <th>Setting</th>
                            <th>Requires</th>
                            <th>Affects / Conflicts With</th>
                            <th>Notes</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td class="setting-name">competeAll = false</td>
                            <td class="requires">excludedVendors must be set</td>
                            <td class="affects">ApplySisterComparisonCheck rule</td>
                            <td>Without excludedVendors, no vendors are excluded</td>
                        </tr>
                        <tr>
                            <td class="setting-name">is_nc_needed = true</td>
                            <td class="requires">ownVendorThreshold should be set</td>
                            <td class="affects">Changes entire price comparison basis</td>
                            <td>Switches to shipping-inclusive calculations</td>
                        </tr>
                        <tr>
                            <td class="setting-name">repricingRule = 0</td>
                            <td class="requires">-</td>
                            <td class="affects">percentageDown is ignored</td>
                            <td>Up Only mode blocks all decreases</td>
                        </tr>
                        <tr>
                            <td class="setting-name">repricingRule = 1</td>
                            <td class="requires">-</td>
                            <td class="affects">percentageIncrease is ignored</td>
                            <td>Down Only mode blocks all increases</td>
                        </tr>
                        <tr>
                            <td class="setting-name">applyBuyBoxLogic = true</td>
                            <td class="requires">-</td>
                            <td class="affects">Conflicts with repricingRule=1</td>
                            <td>Can't maintain position if only decreasing</td>
                        </tr>
                        <tr>
                            <td class="setting-name">suppressPriceBreak = true</td>
                            <td class="requires">-</td>
                            <td class="affects">compareWithQ1, beatQPrice behavior</td>
                            <td>Only Q1 changes, Q2+ frozen</td>
                        </tr>
                        <tr>
                            <td class="setting-name">badgeIndicator = BADGE_ONLY</td>
                            <td class="requires">-</td>
                            <td class="affects">badgePercentageDown becomes relevant</td>
                            <td>Filters out all non-badge competitors</td>
                        </tr>
                        <tr>
                            <td class="setting-name">keepPosition = true</td>
                            <td class="requires">-</td>
                            <td class="affects">Conflicts with aggressive percentageDown</td>
                            <td>Won't drop to beat lower-ranked vendors</td>
                        </tr>
                        <tr>
                            <td class="setting-name">applyNcForBuyBox = true</td>
                            <td class="requires">Usually with is_nc_needed</td>
                            <td class="affects">Triggers NC mode at floor price</td>
                            <td>Last resort to win buy box</td>
                        </tr>
                    </tbody>
                </table>

                <div class="alert alert-warning">
                    <strong>Common Conflict: applyBuyBoxLogic + repricingRule=1</strong>
                    If you set repricingRule to "Down Only" but also enable applyBuyBoxLogic, the buy box protection may never allow prices to change. When you're winning (#1), it blocks decreases. When you're not winning, "Down Only" should allow decreases... but if prices can only go down, you can never recover margins when winning. Use repricingRule=2 (Both) with applyBuyBoxLogic for best results.
                </div>
            </section>

            <!-- SECTION: Complete Examples -->
            <section id="examples">
                <h2>Complete Walkthrough Examples</h2>

                <p>These detailed examples show exactly how the algorithm processes pricing decisions from start to finish.</p>

                <!-- Example 1 -->
                <div class="example-card">
                    <div class="example-header">
                        <span class="example-number">1</span>
                        <div>
                            <div class="example-title">Conservative Strategy - Margin Protection</div>
                            <div class="example-subtitle">When repricingRule blocks a price decrease</div>
                        </div>
                    </div>

                    <div class="scenario-box">
                        <h5>üìä Initial State</h5>
                        <div class="data-grid">
                            <div>
                                <div class="data-item">
                                    <span class="data-label">Current Price</span>
                                    <span class="data-value">$50.00</span>
                                </div>
                                <div class="data-item">
                                    <span class="data-label">Floor Price</span>
                                    <span class="data-value">$45.00</span>
                                </div>
                                <div class="data-item">
                                    <span class="data-label">Max Price</span>
                                    <span class="data-value">$60.00</span>
                                </div>
                            </div>
                            <div>
                                <div class="data-item">
                                    <span class="data-label">repricingRule</span>
                                    <span class="data-value">0 (Up Only)</span>
                                </div>
                                <div class="data-item">
                                    <span class="data-label">percentageDown</span>
                                    <span class="data-value">5%</span>
                                </div>
                                <div class="data-item">
                                    <span class="data-label">Current Position</span>
                                    <span class="data-value">#2</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="scenario-box">
                        <h5>üè™ Competitor Data</h5>
                        <div class="data-grid">
                            <div>
                                <div class="data-item">
                                    <span class="data-label">Competitor A (Position #1)</span>
                                    <span class="data-value">$48.00</span>
                                </div>
                            </div>
                            <div>
                                <div class="data-item">
                                    <span class="data-label">Competitor B (Position #3)</span>
                                    <span class="data-value">$52.00</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <h4>Step-by-Step Processing</h4>

                    <ul class="step-list">
                        <li class="step-item pass">
                            <span class="step-number">1</span>
                            <div class="step-content">
                                <div class="step-rule">Stage 2: Filtering</div>
                                <div class="step-detail">No filters applied (competeAll=true, badgeIndicator=ALL). Both competitors remain.</div>
                                <span class="step-result pass">Competitors: A, B</span>
                            </div>
                        </li>
                        <li class="step-item pass">
                            <span class="step-number">2</span>
                            <div class="step-content">
                                <div class="step-rule">Stage 3: Calculation</div>
                                <div class="step-detail">Target lowest competitor (A at $48.00). Apply 5% undercut: $48.00 √ó 0.95 = $45.60</div>
                                <span class="step-result pass">Calculated Price: $45.60</span>
                            </div>
                        </li>
                        <li class="step-item blocked">
                            <span class="step-number">3</span>
                            <div class="step-content">
                                <div class="step-rule">Rule 1: ApplyRule() - Direction Check</div>
                                <div class="step-detail">Calculated $45.60 < Current $50.00 = <strong>DECREASE</strong><br>repricingRule=0 requires UP ONLY</div>
                                <span class="step-result blocked">BLOCKED: "IGNORED_UP_REPRICE_RULE"</span>
                            </div>
                        </li>
                    </ul>

                    <div class="result-box">
                        <div>
                            <div class="result-label">Final Decision</div>
                            <div class="result-price">$50.00</div>
                        </div>
                        <span class="result-tag">NO CHANGE - Direction Blocked</span>
                    </div>

                    <div class="alert alert-insight" style="margin-top: 1.5rem;">
                        <strong>Why This Matters</strong>
                        The Conservative strategy protected your margins. Even though a competitor is cheaper, your "Up Only" rule prevented a race to the bottom. You'll maintain your #2 position at higher margins.
                    </div>
                </div>

                <!-- Example 2 -->
                <div class="example-card">
                    <div class="example-header">
                        <span class="example-number">2</span>
                        <div>
                            <div class="example-title">Aggressive Strategy - NC Mode Buy Box Win</div>
                            <div class="example-subtitle">When shipping costs flip the competitive landscape</div>
                        </div>
                    </div>

                    <div class="scenario-box">
                        <h5>üìä Initial State</h5>
                        <div class="data-grid">
                            <div>
                                <div class="data-item">
                                    <span class="data-label">Current Price</span>
                                    <span class="data-value">$50.00</span>
                                </div>
                                <div class="data-item">
                                    <span class="data-label">Floor Price</span>
                                    <span class="data-value">$40.00</span>
                                </div>
                                <div class="data-item">
                                    <span class="data-label">is_nc_needed</span>
                                    <span class="data-value">true</span>
                                </div>
                            </div>
                            <div>
                                <div class="data-item">
                                    <span class="data-label">repricingRule</span>
                                    <span class="data-value">1 (Down Only)</span>
                                </div>
                                <div class="data-item">
                                    <span class="data-label">percentageDown</span>
                                    <span class="data-value">5%</span>
                                </div>
                                <div class="data-item">
                                    <span class="data-label">ownVendorThreshold</span>
                                    <span class="data-value">$50 (free shipping)</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="scenario-box">
                        <h5>üè™ Competitor Data (with shipping)</h5>
                        <div class="data-grid">
                            <div>
                                <div class="data-item">
                                    <span class="data-label">Competitor A</span>
                                    <span class="data-value">$45.00 + $5.99 shipping = $50.99 total</span>
                                </div>
                            </div>
                            <div>
                                <div class="data-item">
                                    <span class="data-label">Competitor B</span>
                                    <span class="data-value">$47.00 + free shipping = $47.00 total</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <h4>Step-by-Step Processing</h4>

                    <ul class="step-list">
                        <li class="step-item pass">
                            <span class="step-number">1</span>
                            <div class="step-content">
                                <div class="step-rule">Stage 3: NC Mode Calculation</div>
                                <div class="step-detail">
                                    <strong>NC Mode Active</strong> - comparing total costs, not unit prices<br>
                                    Competitor A total: $50.99<br>
                                    Competitor B total: $47.00 ‚Üê Lowest<br>
                                    Target to beat: $47.00 - 5% = $44.65
                                </div>
                                <span class="step-result pass">Calculated Total: $44.65</span>
                            </div>
                        </li>
                        <li class="step-item pass">
                            <span class="step-number">2</span>
                            <div class="step-content">
                                <div class="step-rule">Rule 1: ApplyRule() - Direction Check</div>
                                <div class="step-detail">$44.65 < $50.00 = DECREASE. repricingRule=1 allows Down Only.</div>
                                <span class="step-result pass">PASSED</span>
                            </div>
                        </li>
                        <li class="step-item pass">
                            <span class="step-number">3</span>
                            <div class="step-content">
                                <div class="step-rule">Rule 9: ApplyFloorCheckRule()</div>
                                <div class="step-detail">$44.65 > $40.00 floor</div>
                                <span class="step-result pass">PASSED - Above Floor</span>
                            </div>
                        </li>
                        <li class="step-item pass">
                            <span class="step-number">4</span>
                            <div class="step-content">
                                <div class="step-rule">Rules 2-8, 10-13: Remaining Rules</div>
                                <div class="step-detail">All remaining rules pass without modification.</div>
                                <span class="step-result pass">ALL PASSED</span>
                            </div>
                        </li>
                    </ul>

                    <div class="result-box">
                        <div>
                            <div class="result-label">Final Decision</div>
                            <div class="result-price">$44.65</div>
                        </div>
                        <span class="result-tag">NC MODE - Total Cost Competition</span>
                    </div>

                    <div class="alert alert-success" style="margin-top: 1.5rem;">
                        <strong>The NC Mode Advantage</strong>
                        In standard mode, Competitor A at $45.00 would be the target. But NC mode revealed that B's free shipping made them the actual threat at $47.00 total. Your $44.65 + free shipping = $44.65 total now beats both competitors!
                    </div>
                </div>

                <!-- Example 3 -->
                <div class="example-card">
                    <div class="example-header">
                        <span class="example-number">3</span>
                        <div>
                            <div class="example-title">Floor Price + NC Fallback</div>
                            <div class="example-subtitle">When hitting floor triggers automatic NC mode</div>
                        </div>
                    </div>

                    <div class="scenario-box">
                        <h5>üìä Initial State</h5>
                        <div class="data-grid">
                            <div>
                                <div class="data-item">
                                    <span class="data-label">Current Price</span>
                                    <span class="data-value">$45.00</span>
                                </div>
                                <div class="data-item">
                                    <span class="data-label">Floor Price</span>
                                    <span class="data-value">$43.00</span>
                                </div>
                            </div>
                            <div>
                                <div class="data-item">
                                    <span class="data-label">percentageDown</span>
                                    <span class="data-value">15%</span>
                                </div>
                                <div class="data-item">
                                    <span class="data-label">applyNcForBuyBox</span>
                                    <span class="data-value">true</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="scenario-box">
                        <h5>üè™ Competitor Data</h5>
                        <div class="data-grid">
                            <div>
                                <div class="data-item">
                                    <span class="data-label">Competitor A (Very Aggressive!)</span>
                                    <span class="data-value">$38.00 unit + $7.99 shipping</span>
                                </div>
                            </div>
                            <div>
                                <div class="data-item">
                                    <span class="data-label">Your Shipping</span>
                                    <span class="data-value">Free (above threshold)</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <h4>Step-by-Step Processing</h4>

                    <ul class="step-list">
                        <li class="step-item pass">
                            <span class="step-number">1</span>
                            <div class="step-content">
                                <div class="step-rule">Stage 3: Standard Calculation</div>
                                <div class="step-detail">Target A at $38.00. Apply 15% undercut: $38.00 √ó 0.85 = $32.30</div>
                                <span class="step-result pass">Calculated: $32.30</span>
                            </div>
                        </li>
                        <li class="step-item pass">
                            <span class="step-number">2</span>
                            <div class="step-content">
                                <div class="step-rule">Rule 1: ApplyRule()</div>
                                <div class="step-detail">$32.30 < $45.00 = DECREASE (allowed with repricingRule=2)</div>
                                <span class="step-result pass">PASSED</span>
                            </div>
                        </li>
                        <li class="step-item blocked">
                            <span class="step-number">3</span>
                            <div class="step-content">
                                <div class="step-rule">Rule 9: ApplyFloorCheckRule()</div>
                                <div class="step-detail">$32.30 <= $43.00 floor<br><strong>BLOCKED:</strong> Price change prevented (would set newPrice = "N/A")</div>
                                <span class="step-result blocked">BLOCKED: "IGNORE_LOGIC_FAULT"</span>
                            </div>
                        </li>
                        <li class="step-item pass">
                            <span class="step-number">4</span>
                            <div class="step-content">
                                <div class="step-rule">applyNcForBuyBox Triggered</div>
                                <div class="step-detail">
                                    Floor reached but still losing. NC fallback activates!<br>
                                    <strong>NC Comparison:</strong><br>
                                    Competitor A total: $38.00 + $7.99 = $45.99<br>
                                    Your total: $43.00 + free = $43.00<br>
                                    <strong>You WIN on total cost!</strong>
                                </div>
                                <span class="step-result pass">NC_BUYBOX_APPLIED</span>
                            </div>
                        </li>
                    </ul>

                    <div class="result-box">
                        <div>
                            <div class="result-label">Final Decision</div>
                            <div class="result-price">$43.00</div>
                        </div>
                        <span class="result-tag">IGNORE_LOGIC_FAULT ‚Üí NC_BUYBOX_WIN</span>
                    </div>

                    <div class="alert alert-insight" style="margin-top: 1.5rem;">
                        <strong>The Power of applyNcForBuyBox</strong>
                        This setting is your secret weapon. When unit price competition fails (you hit floor), NC mode automatically kicks in. Competitor A's "low" $38.00 price becomes $45.99 with shipping, and your "floor" $43.00 with free shipping wins the total cost comparison!
                    </div>
                </div>

                <!-- Example 4 -->
                <div class="example-card">
                    <div class="example-header">
                        <span class="example-number">4</span>
                        <div>
                            <div class="example-title">Buy Box Protection in Action</div>
                            <div class="example-subtitle">When winning the buy box blocks price decreases</div>
                        </div>
                    </div>

                    <div class="scenario-box">
                        <h5>üìä Initial State</h5>
                        <div class="data-grid">
                            <div>
                                <div class="data-item">
                                    <span class="data-label">Current Price</span>
                                    <span class="data-value">$55.00</span>
                                </div>
                                <div class="data-item">
                                    <span class="data-label">Current Position</span>
                                    <span class="data-value">#1 (Buy Box!)</span>
                                </div>
                            </div>
                            <div>
                                <div class="data-item">
                                    <span class="data-label">applyBuyBoxLogic</span>
                                    <span class="data-value">true</span>
                                </div>
                                <div class="data-item">
                                    <span class="data-label">repricingRule</span>
                                    <span class="data-value">2 (Both)</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="scenario-box">
                        <h5>üè™ New Competitor Enters</h5>
                        <div class="data-grid">
                            <div>
                                <div class="data-item">
                                    <span class="data-label">New Competitor X</span>
                                    <span class="data-value">$52.00 (trying to take #1)</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <h4>Step-by-Step Processing</h4>

                    <ul class="step-list">
                        <li class="step-item pass">
                            <span class="step-number">1</span>
                            <div class="step-content">
                                <div class="step-rule">Stage 3: Calculation</div>
                                <div class="step-detail">Target X at $52.00. Calculate competitive price: $51.48</div>
                                <span class="step-result pass">Calculated: $51.48</span>
                            </div>
                        </li>
                        <li class="step-item pass">
                            <span class="step-number">2</span>
                            <div class="step-content">
                                <div class="step-rule">Rule 1: ApplyRule()</div>
                                <div class="step-detail">$51.48 < $55.00 = DECREASE (allowed with repricingRule=2)</div>
                                <span class="step-result pass">PASSED</span>
                            </div>
                        </li>
                        <li class="step-item blocked">
                            <span class="step-number">3</span>
                            <div class="step-content">
                                <div class="step-rule">Rule 6: ApplyBuyBoxRule()</div>
                                <div class="step-detail">
                                    applyBuyBoxLogic = true<br>
                                    First competitor's vendorId matches our vendor IDs (17357, 20722, 20755, 20533, 20727, 5)<br>
                                    Calculated price < Current price = DECREASE<br>
                                    <strong>BLOCKED:</strong> "Our vendor is winning the buy box!"
                                </div>
                                <span class="step-result blocked">BLOCKED: "IGNORED_BUYBOX_RULE"</span>
                            </div>
                        </li>
                    </ul>

                    <div class="result-box">
                        <div>
                            <div class="result-label">Final Decision</div>
                            <div class="result-price">$55.00</div>
                        </div>
                        <span class="result-tag">BUY BOX PROTECTED - Margins Maintained</span>
                    </div>

                    <div class="alert alert-critical" style="margin-top: 1.5rem;">
                        <strong>Critical Understanding: Buy Box Rule Checks Vendor IDs, Not Position</strong>
                        The ApplyBuyBoxRule checks if the FIRST vendor in the net32Result matches one of our hardcoded vendor IDs (17357, 20722, 20755, 20533, 20727, 5). If any of our vendors are in the buy box position, it blocks price decreases to protect that win. This is checking if "we" are winning, not a generic position #1 check.
                    </div>
                </div>

                <!-- Example 5 -->
                <div class="example-card">
                    <div class="example-header">
                        <span class="example-number">5</span>
                        <div>
                            <div class="example-title">Sister Vendor Differentiation</div>
                            <div class="example-subtitle">Managing multiple seller accounts without self-competition</div>
                        </div>
                    </div>

                    <div class="scenario-box">
                        <h5>üìä Initial State</h5>
                        <div class="data-grid">
                            <div>
                                <div class="data-item">
                                    <span class="data-label">Your Vendor ID</span>
                                    <span class="data-value">17358</span>
                                </div>
                                <div class="data-item">
                                    <span class="data-label">competeAll</span>
                                    <span class="data-value">false</span>
                                </div>
                            </div>
                            <div>
                                <div class="data-item">
                                    <span class="data-label">excludedVendors</span>
                                    <span class="data-value">17357;20722</span>
                                </div>
                                <div class="data-item">
                                    <span class="data-label">Current Price</span>
                                    <span class="data-value">$50.00</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="scenario-box">
                        <h5>üè™ Competitor Data</h5>
                        <div class="data-grid">
                            <div>
                                <div class="data-item">
                                    <span class="data-label">Vendor 17357 (Sister)</span>
                                    <span class="data-value">$49.50</span>
                                </div>
                                <div class="data-item">
                                    <span class="data-label">Vendor 20722 (Sister)</span>
                                    <span class="data-value">$49.00</span>
                                </div>
                            </div>
                            <div>
                                <div class="data-item">
                                    <span class="data-label">Vendor 30000 (Real Competitor)</span>
                                    <span class="data-value">$48.00</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <h4>Step-by-Step Processing</h4>

                    <ul class="step-list">
                        <li class="step-item pass">
                            <span class="step-number">1</span>
                            <div class="step-content">
                                <div class="step-rule">Stage 2: Filtering</div>
                                <div class="step-detail">
                                    competeAll = false ‚Üí Apply excludedVendors filter<br>
                                    Remove: 17357, 20722<br>
                                    <strong>Remaining:</strong> Vendor 30000 only
                                </div>
                                <span class="step-result pass">Filtered to: Vendor 30000 ($48.00)</span>
                            </div>
                        </li>
                        <li class="step-item pass">
                            <span class="step-number">2</span>
                            <div class="step-content">
                                <div class="step-rule">Stage 3: Calculation</div>
                                <div class="step-detail">Target Vendor 30000 at $48.00. Apply 5% undercut: $47.52</div>
                                <span class="step-result pass">Calculated: $47.52</span>
                            </div>
                        </li>
                        <li class="step-item pass">
                            <span class="step-number">3</span>
                            <div class="step-content">
                                <div class="step-rule">Rules 1-12: Standard Rules</div>
                                <div class="step-detail">All pass without modification</div>
                                <span class="step-result pass">ALL PASSED</span>
                            </div>
                        </li>
                        <li class="step-item pass">
                            <span class="step-number">4</span>
                            <div class="step-content">
                                <div class="step-rule">Rule 13: ApplySisterComparisonCheck()</div>
                                <div class="step-detail">
                                    Check if $47.52 matches any sister price:<br>
                                    Sister 17357: $49.50 ‚â† $47.52 ‚úì<br>
                                    Sister 20722: $49.00 ‚â† $47.52 ‚úì<br>
                                    No match - no OFFSET needed
                                </div>
                                <span class="step-result pass">PASSED - No Sister Conflict</span>
                            </div>
                        </li>
                    </ul>

                    <div class="result-box">
                        <div>
                            <div class="result-label">Final Decision</div>
                            <div class="result-price">$47.52</div>
                        </div>
                        <span class="result-tag">SISTER ACCOUNTS PROTECTED</span>
                    </div>

                    <div class="alert alert-insight" style="margin-top: 1.5rem;">
                        <strong>What if the calculated price matched a sister?</strong>
                        If your calculation resulted in $49.50 (same as sister 17357), Rule 11 would apply a small OFFSET (typically $0.01) to differentiate: $49.50 ‚Üí $49.49. This ensures your accounts never have identical prices.
                    </div>
                </div>

                <!-- Example 6 -->
                <div class="example-card">
                    <div class="example-header">
                        <span class="example-number">6</span>
                        <div>
                            <div class="example-title">Quantity Break Hierarchy Enforcement</div>
                            <div class="example-subtitle">When bulk pricing violates the Q1 > Q5 > Q10 rule</div>
                        </div>
                    </div>

                    <div class="scenario-box">
                        <h5>üìä Current Quantity Pricing</h5>
                        <div class="data-grid">
                            <div>
                                <div class="data-item">
                                    <span class="data-label">Q1 (1 unit)</span>
                                    <span class="data-value">$10.00/unit</span>
                                </div>
                                <div class="data-item">
                                    <span class="data-label">Q5 (5+ units)</span>
                                    <span class="data-value">$9.00/unit</span>
                                </div>
                            </div>
                            <div>
                                <div class="data-item">
                                    <span class="data-label">Q10 (10+ units)</span>
                                    <span class="data-value">$8.00/unit</span>
                                </div>
                                <div class="data-item">
                                    <span class="data-label">suppressPriceBreak</span>
                                    <span class="data-value">false</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="scenario-box">
                        <h5>üìà Algorithm Calculates New Prices</h5>
                        <div class="data-grid">
                            <div>
                                <div class="data-item">
                                    <span class="data-label">New Q1</span>
                                    <span class="data-value">$9.50/unit</span>
                                </div>
                                <div class="data-item">
                                    <span class="data-label">New Q5</span>
                                    <span class="data-value" style="color: #dc3545;">$9.75/unit ‚Üê Problem!</span>
                                </div>
                            </div>
                            <div>
                                <div class="data-item">
                                    <span class="data-label">New Q10</span>
                                    <span class="data-value">$7.50/unit</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <h4>Step-by-Step Processing</h4>

                    <ul class="step-list">
                        <li class="step-item modified">
                            <span class="step-number">1</span>
                            <div class="step-content">
                                <div class="step-rule">Rule 3: ApplyMultiPriceBreakRule()</div>
                                <div class="step-detail">
                                    <strong>Hierarchy Check:</strong><br>
                                    Q1 ($9.50) should be > Q5 ‚Üí Q5 is $9.75<br>
                                    <strong>VIOLATION!</strong> Q5 ($9.75) > Q1 ($9.50)<br>
                                    Customers would pay MORE for bulk!
                                </div>
                                <span class="step-result modified">VIOLATION DETECTED</span>
                            </div>
                        </li>
                        <li class="step-item modified">
                            <span class="step-number">2</span>
                            <div class="step-content">
                                <div class="step-rule">Rule 3: Resolution</div>
                                <div class="step-detail">
                                    abortDeactivatingQPriceBreak = false<br>
                                    <strong>Action:</strong> DEACTIVATE Q5 break entirely
                                </div>
                                <span class="step-result modified">Q5 DEACTIVATED</span>
                            </div>
                        </li>
                    </ul>

                    <div class="result-box">
                        <div>
                            <div class="result-label">Final Pricing</div>
                            <div class="result-price">Q1: $9.50 | Q5: INACTIVE | Q10: $7.50</div>
                        </div>
                        <span class="result-tag">HIERARCHY ENFORCED</span>
                    </div>

                    <div class="alert alert-warning" style="margin-top: 1.5rem;">
                        <strong>Alternative: Keep All Breaks Active</strong>
                        If you set <code>abortDeactivatingQPriceBreak = true</code>, Rule 2 (ApplyDeactivateQPriceBreakRule) runs first and prevents Rule 3's deactivation. The Q5 break would stay active even though it violates hierarchy. Use this if you have contractual obligations to maintain all quantity breaks.
                    </div>
                </div>

                <!-- Example 7 -->
                <div class="example-card">
                    <div class="example-header">
                        <span class="example-number">7</span>
                        <div>
                            <div class="example-title">Percentage Increase Limiter</div>
                            <div class="example-subtitle">Preventing sudden price jumps when competition leaves</div>
                        </div>
                    </div>

                    <div class="scenario-box">
                        <h5>üìä Initial State</h5>
                        <div class="data-grid">
                            <div>
                                <div class="data-item">
                                    <span class="data-label">Current Price</span>
                                    <span class="data-value">$30.00</span>
                                </div>
                                <div class="data-item">
                                    <span class="data-label">Max Price</span>
                                    <span class="data-value">$100.00</span>
                                </div>
                            </div>
                            <div>
                                <div class="data-item">
                                    <span class="data-label">percentageIncrease</span>
                                    <span class="data-value">15%</span>
                                </div>
                                <div class="data-item">
                                    <span class="data-label">repricingRule</span>
                                    <span class="data-value">0 (Up Only)</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="scenario-box">
                        <h5>üè™ Market Change</h5>
                        <p style="color: #dc3545; font-weight: 600;">All competitors have left the market! You're the only seller.</p>
                    </div>

                    <h4>Step-by-Step Processing</h4>

                    <ul class="step-list">
                        <li class="step-item pass">
                            <span class="step-number">1</span>
                            <div class="step-content">
                                <div class="step-rule">Stage 3: Calculation</div>
                                <div class="step-detail">No competitors ‚Üí Algorithm wants to go to maxPrice: $100.00</div>
                                <span class="step-result pass">Calculated: $100.00</span>
                            </div>
                        </li>
                        <li class="step-item pass">
                            <span class="step-number">2</span>
                            <div class="step-content">
                                <div class="step-rule">Rule 1: ApplyRule()</div>
                                <div class="step-detail">$100.00 > $30.00 = INCREASE (allowed with Up Only)</div>
                                <span class="step-result pass">PASSED</span>
                            </div>
                        </li>
                        <li class="step-item blocked">
                            <span class="step-number">3</span>
                            <div class="step-content">
                                <div class="step-rule">Rule 5: ApplyPercentagePriceRule()</div>
                                <div class="step-detail">
                                    Current: $30.00<br>
                                    Calculated: $100.00 (233% increase!)<br>
                                    percentageIncrease limit: 15%<br>
                                    Max allowed: $30.00 √ó 1.15 = $34.50<br>
                                    <strong>BLOCKED:</strong> Increase doesn't meet threshold, capped at $34.50
                                </div>
                                <span class="step-result blocked">BLOCKED ‚Üí CAPPED: $100.00 ‚Üí $34.50</span>
                            </div>
                        </li>
                    </ul>

                    <div class="result-box">
                        <div>
                            <div class="result-label">Final Decision</div>
                            <div class="result-price">$34.50</div>
                        </div>
                        <span class="result-tag">PERCENTAGE_INCREASE_CAPPED</span>
                    </div>

                    <div class="alert alert-success" style="margin-top: 1.5rem;">
                        <strong>Gradual Price Recovery</strong>
                        Instead of shocking customers with a $30 ‚Üí $100 jump, the algorithm takes multiple cycles:
                        <br><br>
                        Cycle 1: $30.00 ‚Üí $34.50<br>
                        Cycle 2: $34.50 ‚Üí $39.68<br>
                        Cycle 3: $39.68 ‚Üí $45.63<br>
                        Cycle 4: $45.63 ‚Üí $52.47<br>
                        ... and so on until reaching maxPrice
                    </div>
                </div>

                <!-- Example 8 -->
                <div class="example-card">
                    <div class="example-header">
                        <span class="example-number">8</span>
                        <div>
                            <div class="example-title">Badge-Based Competition</div>
                            <div class="example-subtitle">Filtering to compete only within your badge tier</div>
                        </div>
                    </div>

                    <div class="scenario-box">
                        <h5>üìä Initial State</h5>
                        <div class="data-grid">
                            <div>
                                <div class="data-item">
                                    <span class="data-label">Current Price</span>
                                    <span class="data-value">$55.00</span>
                                </div>
                                <div class="data-item">
                                    <span class="data-label">Your Badge Level</span>
                                    <span class="data-value">Level 3 (Premium)</span>
                                </div>
                            </div>
                            <div>
                                <div class="data-item">
                                    <span class="data-label">badgeIndicator</span>
                                    <span class="data-value">BADGE_ONLY</span>
                                </div>
                                <div class="data-item">
                                    <span class="data-label">badgePercentageDown</span>
                                    <span class="data-value">10%</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="scenario-box">
                        <h5>üè™ Competitor Data</h5>
                        <div class="data-grid">
                            <div>
                                <div class="data-item">
                                    <span class="data-label">Competitor A</span>
                                    <span class="data-value">$45.00, No Badge</span>
                                </div>
                                <div class="data-item">
                                    <span class="data-label">Competitor B</span>
                                    <span class="data-value">$48.00, Badge Level 2</span>
                                </div>
                            </div>
                            <div>
                                <div class="data-item">
                                    <span class="data-label">Competitor C</span>
                                    <span class="data-value">$52.00, Badge Level 3</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <h4>Step-by-Step Processing</h4>

                    <ul class="step-list">
                        <li class="step-item pass">
                            <span class="step-number">1</span>
                            <div class="step-content">
                                <div class="step-rule">Stage 2: Badge Filtering</div>
                                <div class="step-detail">
                                    badgeIndicator = BADGE_ONLY<br>
                                    Filter out: Competitor A (no badge)<br>
                                    <strong>Remaining:</strong> B (Badge 2), C (Badge 3)
                                </div>
                                <span class="step-result pass">Filtered to Badge Sellers Only</span>
                            </div>
                        </li>
                        <li class="step-item pass">
                            <span class="step-number">2</span>
                            <div class="step-content">
                                <div class="step-rule">Stage 3: Calculation</div>
                                <div class="step-detail">
                                    Lowest badge seller: B at $48.00<br>
                                    Apply badgePercentageDown (10%): $48.00 √ó 0.90 = $43.20
                                </div>
                                <span class="step-result pass">Calculated: $43.20</span>
                            </div>
                        </li>
                        <li class="step-item pass">
                            <span class="step-number">3</span>
                            <div class="step-content">
                                <div class="step-rule">Rule 10: ApplyRepriceDownBadgeCheckRule()</div>
                                <div class="step-detail">Badge-specific pricing confirmed and applied</div>
                                <span class="step-result pass">BADGE_PERCENTAGE_APPLIED</span>
                            </div>
                        </li>
                    </ul>

                    <div class="result-box">
                        <div>
                            <div class="result-label">Final Decision</div>
                            <div class="result-price">$43.20</div>
                        </div>
                        <span class="result-tag">BADGE TIER COMPETITION</span>
                    </div>

                    <div class="alert alert-insight" style="margin-top: 1.5rem;">
                        <strong>Why Ignore Non-Badge Sellers?</strong>
                        Badge holders have earned customer trust. Competitor A at $45.00 (no badge) might seem cheaper, but customers often prefer badge sellers even at slightly higher prices. By competing only with badge sellers, you maintain premium positioning while staying competitive within your tier.
                    </div>
                </div>

                <!-- Example 9 -->
                <div class="example-card">
                    <div class="example-header">
                        <span class="example-number">9</span>
                        <div>
                            <div class="example-title">Keep Position Logic</div>
                            <div class="example-subtitle">Avoiding the race to the bottom with lower-ranked vendors</div>
                        </div>
                    </div>

                    <div class="scenario-box">
                        <h5>üìä Initial State</h5>
                        <div class="data-grid">
                            <div>
                                <div class="data-item">
                                    <span class="data-label">Current Price</span>
                                    <span class="data-value">$50.00</span>
                                </div>
                                <div class="data-item">
                                    <span class="data-label">Current Position</span>
                                    <span class="data-value">#2</span>
                                </div>
                            </div>
                            <div>
                                <div class="data-item">
                                    <span class="data-label">keepPosition</span>
                                    <span class="data-value">true</span>
                                </div>
                                <div class="data-item">
                                    <span class="data-label">repricingRule</span>
                                    <span class="data-value">2 (Both)</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="scenario-box">
                        <h5>üè™ Competitor Positions</h5>
                        <div class="data-grid">
                            <div>
                                <div class="data-item">
                                    <span class="data-label">Position #1</span>
                                    <span class="data-value">$48.00 (above you)</span>
                                </div>
                                <div class="data-item">
                                    <span class="data-label">Position #2</span>
                                    <span class="data-value">$50.00 (YOU)</span>
                                </div>
                            </div>
                            <div>
                                <div class="data-item">
                                    <span class="data-label">Position #3</span>
                                    <span class="data-value">$52.00</span>
                                </div>
                                <div class="data-item">
                                    <span class="data-label">Position #4</span>
                                    <span class="data-value" style="color: #dc3545;">$45.00 (aggressive new entry!)</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <h4>Step-by-Step Processing</h4>

                    <ul class="step-list">
                        <li class="step-item pass">
                            <span class="step-number">1</span>
                            <div class="step-content">
                                <div class="step-rule">Stage 3: Calculation</div>
                                <div class="step-detail">Target lowest: Position #4 at $45.00. Calculate: $44.55</div>
                                <span class="step-result pass">Calculated: $44.55</span>
                            </div>
                        </li>
                        <li class="step-item pass">
                            <span class="step-number">2</span>
                            <div class="step-content">
                                <div class="step-rule">Rule 1: ApplyRule()</div>
                                <div class="step-detail">$44.55 < $50.00 = DECREASE (allowed)</div>
                                <span class="step-result pass">PASSED</span>
                            </div>
                        </li>
                        <li class="step-item blocked">
                            <span class="step-number">3</span>
                            <div class="step-content">
                                <div class="step-rule">Rule 7: ApplyKeepPositionLogic()</div>
                                <div class="step-detail">
                                    keepPosition = true<br>
                                    Your position: #2<br>
                                    Target competitor: Position #4 (ranked BELOW you)<br>
                                    <strong>BLOCKED:</strong> Won't drop to beat lower-ranked vendors
                                </div>
                                <span class="step-result blocked">BLOCKED: "KEEP_POSITION_APPLIED"</span>
                            </div>
                        </li>
                    </ul>

                    <div class="result-box">
                        <div>
                            <div class="result-label">Final Decision</div>
                            <div class="result-price">$50.00</div>
                        </div>
                        <span class="result-tag">POSITION MAINTAINED</span>
                    </div>

                    <div class="alert alert-insight" style="margin-top: 1.5rem;">
                        <strong>Strategic Positioning Over Price Wars</strong>
                        Position #4's aggressive $45.00 pricing is likely unsustainable or they have different cost structures. By keeping position, you:
                        <ul style="margin-top: 0.5rem; margin-left: 1rem;">
                            <li>Maintain your #2 rank (unchanged)</li>
                            <li>Preserve your profit margins</li>
                            <li>Wait for #4 to potentially exit or raise prices</li>
                            <li>Avoid a destructive price war with an outlier</li>
                        </ul>
                    </div>
                </div>
            </section>

            <!-- SECTION: Decision Trees -->
            <section id="decision-trees">
                <h2>Decision Trees</h2>

                <p>These decision trees help you quickly understand how the algorithm will behave in different scenarios.</p>

                <h3>Price Change Decision Flow</h3>

                <div class="decision-tree">
<pre>
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                    PRICE CHANGE DECISION                        ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                              ‚îÇ
                              ‚ñº
        ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
        ‚îÇ  Is calculated price different from     ‚îÇ
        ‚îÇ  current price?                         ‚îÇ
        ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                    ‚îÇ                ‚îÇ
                   NO               YES
                    ‚îÇ                ‚îÇ
                    ‚ñº                ‚ñº
            ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê   ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
            ‚îÇ NO ACTION ‚îÇ   ‚îÇ Is it an INCREASE   ‚îÇ
            ‚îÇ           ‚îÇ   ‚îÇ or DECREASE?        ‚îÇ
            ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò   ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                                   ‚îÇ
                    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
                INCREASE                      DECREASE
                    ‚îÇ                             ‚îÇ
                    ‚ñº                             ‚ñº
    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê   ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
    ‚îÇ repricingRule allows UP?  ‚îÇ   ‚îÇ repricingRule allows DOWN?‚îÇ
    ‚îÇ (rule 0 or 2)             ‚îÇ   ‚îÇ (rule 1 or 2)             ‚îÇ
    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò   ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚îÇ           ‚îÇ                   ‚îÇ           ‚îÇ
        YES         NO                  YES         NO
         ‚îÇ           ‚îÇ                   ‚îÇ           ‚îÇ
         ‚ñº           ‚ñº                   ‚ñº           ‚ñº
    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê     ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
    ‚îÇ Check   ‚îÇ  ‚îÇ BLOCKED  ‚îÇ     ‚îÇ Check if     ‚îÇ  ‚îÇ BLOCKED  ‚îÇ
    ‚îÇ % limit ‚îÇ  ‚îÇ          ‚îÇ     ‚îÇ above floor  ‚îÇ  ‚îÇ          ‚îÇ
    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò     ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚îÇ                              ‚îÇ
         ‚ñº                              ‚ñº
    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê         ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
    ‚îÇ Within          ‚îÇ         ‚îÇ Above floor?     ‚îÇ
    ‚îÇ percentageInc?  ‚îÇ         ‚îÇ                  ‚îÇ
    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò         ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
      ‚îÇ          ‚îÇ                  ‚îÇ          ‚îÇ
     YES        NO                 YES        NO
      ‚îÇ          ‚îÇ                  ‚îÇ          ‚îÇ
      ‚ñº          ‚ñº                  ‚ñº          ‚ñº
  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê   ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
  ‚îÇ APPLY ‚îÇ ‚îÇ CAP AT MAX ‚îÇ   ‚îÇ Continue  ‚îÇ ‚îÇ SET TO     ‚îÇ
  ‚îÇ       ‚îÇ ‚îÇ PERCENTAGE ‚îÇ   ‚îÇ to other  ‚îÇ ‚îÇ FLOOR      ‚îÇ
  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò   ‚îÇ rules...  ‚îÇ ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                             ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
</pre>
                </div>

                <h3>Buy Box Protection Decision</h3>

                <div class="decision-tree">
<pre>
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                   BUY BOX RULE DECISION                         ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                              ‚îÇ
                              ‚ñº
                ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
                ‚îÇ applyBuyBoxLogic      ‚îÇ
                ‚îÇ enabled?              ‚îÇ
                ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                        ‚îÇ
            ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
           YES                      NO
            ‚îÇ                       ‚îÇ
            ‚ñº                       ‚ñº
    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê       ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
    ‚îÇ Current       ‚îÇ       ‚îÇ SKIP RULE     ‚îÇ
    ‚îÇ position = 1? ‚îÇ       ‚îÇ (continue)    ‚îÇ
    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò       ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
            ‚îÇ
     ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
    YES           NO
     ‚îÇ             ‚îÇ
     ‚ñº             ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ Is change a  ‚îÇ  ‚îÇ SKIP RULE     ‚îÇ
‚îÇ DECREASE?    ‚îÇ  ‚îÇ (not winning) ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
      ‚îÇ
   ‚îå‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îê
  YES    NO
   ‚îÇ      ‚îÇ
   ‚ñº      ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇBLOCK ‚îÇ ‚îÇ ALLOW     ‚îÇ
‚îÇ"Why  ‚îÇ ‚îÇ (increase ‚îÇ
‚îÇlower ‚îÇ ‚îÇ  is OK)   ‚îÇ
‚îÇwhen  ‚îÇ ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
‚îÇwin?" ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
</pre>
                </div>

                <h3>NC Mode Activation Decision</h3>

                <div class="decision-tree">
<pre>
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                    NC MODE DECISION                             ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                              ‚îÇ
                              ‚ñº
                ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
                ‚îÇ is_nc_needed = true?  ‚îÇ
                ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                        ‚îÇ
            ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
           YES                      NO
            ‚îÇ                       ‚îÇ
            ‚ñº                       ‚ñº
    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê   ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
    ‚îÇ USE NC MODE:      ‚îÇ   ‚îÇ applyNcForBuyBox    ‚îÇ
    ‚îÇ Compare total     ‚îÇ   ‚îÇ = true AND at floor?‚îÇ
    ‚îÇ costs (unit +     ‚îÇ   ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
    ‚îÇ shipping)         ‚îÇ           ‚îÇ
    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
                            YES           NO
                             ‚îÇ             ‚îÇ
                             ‚ñº             ‚ñº
                     ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
                     ‚îÇ SWITCH TO NC  ‚îÇ ‚îÇ STANDARD MODE ‚îÇ
                     ‚îÇ as fallback   ‚îÇ ‚îÇ Compare unit  ‚îÇ
                     ‚îÇ for buy box   ‚îÇ ‚îÇ prices only   ‚îÇ
                     ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
</pre>
                </div>
            </section>

            <!-- SECTION: Edge Cases -->
            <section id="edge-cases">
                <h2>Edge Cases & Special Scenarios</h2>

                <h3>What happens when...</h3>

                <div class="rule-grid">
                    <div class="rule-card">
                        <h4>No Competitors Remain After Filtering?</h4>
                        <p style="color: #6c757d; margin-top: 0.5rem;">
                            The algorithm targets your <strong>maxPrice</strong>, but Rule 5 (ApplyPercentagePriceRule) limits how fast you can get there. You'll gradually increase over multiple cycles.
                        </p>
                    </div>

                    <div class="rule-card">
                        <h4>All Competitors Below Your Floor?</h4>
                        <p style="color: #6c757d; margin-top: 0.5rem;">
                            Price change is <strong>BLOCKED</strong> (newPrice = "N/A") with "IGNORE_LOGIC_FAULT" tag. If <code>applyNcForBuyBox=true</code>, NC mode activates to compete on total cost instead.
                        </p>
                    </div>

                    <div class="rule-card">
                        <h4>Floor Price > Max Price?</h4>
                        <p style="color: #6c757d; margin-top: 0.5rem;">
                            <strong>Configuration error!</strong> The algorithm will be stuck. Always ensure floor < max before saving settings.
                        </p>
                    </div>

                    <div class="rule-card">
                        <h4>Sister Vendor Has Exact Same Calculated Price?</h4>
                        <p style="color: #6c757d; margin-top: 0.5rem;">
                            Rule 13 (ApplySisterComparisonCheck) applies <strong>OFFSET</strong> (typically $0.01) to differentiate: if calculated = $49.50 and sister = $49.50, you become $49.49.
                        </p>
                    </div>

                    <div class="rule-card">
                        <h4>Multiple Rules Want to Block?</h4>
                        <p style="color: #6c757d; margin-top: 0.5rem;">
                            The <strong>first blocking rule wins</strong>. Once blocked, subsequent rules don't evaluate. Check execution log for which rule blocked.
                        </p>
                    </div>

                    <div class="rule-card">
                        <h4>percentageIncrease = 0?</h4>
                        <p style="color: #6c757d; margin-top: 0.5rem;">
                            Prices can <strong>never increase</strong>. Equivalent to repricingRule=1 (Down Only) for the increase cap.
                        </p>
                    </div>

                    <div class="rule-card">
                        <h4>Winning Buy Box But Competitor is Lower?</h4>
                        <p style="color: #6c757d; margin-top: 0.5rem;">
                            If <code>applyBuyBoxLogic=true</code>, you <strong>stay at current price</strong>. The algorithm trusts that you're winning despite the price difference (perhaps due to badge, seller metrics, etc.).
                        </p>
                    </div>

                    <div class="rule-card">
                        <h4>suppressPriceBreak + compareWithQ1?</h4>
                        <p style="color: #6c757d; margin-top: 0.5rem;">
                            <code>suppressPriceBreak=true</code> takes precedence. Q1 updates, but Q2+ stay frozen regardless of compareWithQ1 setting.
                        </p>
                    </div>
                </div>
            </section>

            <!-- SECTION: Key Insights -->
            <section id="insights">
                <h2>Key Insights Summary</h2>

                <div class="alert alert-critical">
                    <strong>1. ORDER MATTERS: Rules Execute Sequentially</strong>
                    Rules 1-13 run in order. An early blocking rule (like Rule 1: ApplyRule) prevents all later rules from ever evaluating. If your price isn't changing, check which rule blocked first.
                </div>

                <div class="alert alert-warning">
                    <strong>2. FLOOR IS KING (Almost)</strong>
                    Rule 9 (ApplyFloorCheckRule) BLOCKS any price change at or below floor (sets newPrice = "N/A")... except when <code>applyNcForBuyBox=true</code> provides an NC mode fallback. The floor protects your profitability at all costs.
                </div>

                <div class="alert alert-insight">
                    <strong>3. BUY BOX PROTECTION CHECKS OUR VENDOR IDs</strong>
                    The ApplyBuyBoxRule doesn't check for generic "position #1". It checks if the first vendor in the list matches one of our hardcoded vendor IDs (17357, 20722, 20755, 20533, 20727, 5). When any of our vendors holds the buy box, it blocks price decreases.
                </div>

                <div class="alert alert-success">
                    <strong>4. NC MODE CHANGES EVERYTHING</strong>
                    Switching from unit price to total cost comparison can completely reverse competitive positions. A "higher" unit price with free shipping beats a "lower" unit price with expensive shipping.
                </div>

                <div class="alert alert-insight">
                    <strong>5. PERCENTAGE LIMITS CREATE GRADUAL MOVEMENT</strong>
                    Both percentageIncrease and percentageDown prevent sudden jumps. Large price changes require multiple repricing cycles, protecting customer trust.
                </div>

                <div class="alert alert-warning">
                    <strong>6. SISTER DIFFERENTIATION IS SUBTLE</strong>
                    ApplySisterComparisonCheck doesn't block pricing - it just ensures a tiny OFFSET ($0.01) to differentiate from sister accounts. Your accounts will never have identical prices.
                </div>

                <div class="alert alert-critical">
                    <strong>7. QUANTITY HIERARCHY IS ENFORCED</strong>
                    The system will deactivate quantity breaks rather than allow Q5 to be more expensive than Q1. Use <code>abortDeactivatingQPriceBreak=true</code> to override this.
                </div>

                <div class="alert alert-success">
                    <strong>8. FILTERING HAPPENS FIRST</strong>
                    Before any calculation, competitors are filtered by: excludedVendors ‚Üí badgeIndicator ‚Üí inventoryThreshold ‚Üí handlingTimeFilter. An "invisible" competitor might be filtered out before pricing even begins.
                </div>

                <h3>Quick Reference: Most Common Issues</h3>

                <table class="matrix-table">
                    <thead>
                        <tr>
                            <th>Symptom</th>
                            <th>Likely Cause</th>
                            <th>Solution</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>Price never decreases</td>
                            <td>repricingRule = 0 (Up Only)</td>
                            <td>Change to repricingRule = 2 (Both)</td>
                        </tr>
                        <tr>
                            <td>Price never increases</td>
                            <td>repricingRule = 1 (Down Only) or percentageIncrease = 0</td>
                            <td>Change to repricingRule = 2 and set percentageIncrease > 0</td>
                        </tr>
                        <tr>
                            <td>Stuck at floor price</td>
                            <td>Competitors below floor, normal behavior</td>
                            <td>Enable applyNcForBuyBox for NC fallback</td>
                        </tr>
                        <tr>
                            <td>Not competing with some vendors</td>
                            <td>Vendor filtered out</td>
                            <td>Check badgeIndicator, inventoryThreshold, handlingTimeFilter</td>
                        </tr>
                        <tr>
                            <td>Buy box protected unexpectedly</td>
                            <td>applyBuyBoxLogic = true and position = 1</td>
                            <td>Disable applyBuyBoxLogic if unwanted</td>
                        </tr>
                        <tr>
                            <td>Q2+ prices not updating</td>
                            <td>suppressPriceBreak = true</td>
                            <td>Set suppressPriceBreak = false</td>
                        </tr>
                        <tr>
                            <td>Competing with sister accounts</td>
                            <td>competeAll = true or excludedVendors not set</td>
                            <td>Set competeAll = false and add sister IDs</td>
                        </tr>
                    </tbody>
                </table>
            </section>
        </main>

        <footer>
            <p><strong>V1 Algorithm Rules Integration Guide</strong></p>
            <p>Last Updated: November 2024 | Version 1.0</p>
            <p style="margin-top: 1rem;">
                Related Documentation:<br>
                <a href="v1-algorithm-field-guide.html">V1 Algorithm Field Guide</a> |
                <a href="v2-algorithm-field-guide.html">V2 Algorithm Field Guide</a> |
                <a href="../api-core/v1-algorithm-detailed-documentation.html">Technical Documentation</a>
            </p>
        </footer>
    </div>
</body>
</html>
